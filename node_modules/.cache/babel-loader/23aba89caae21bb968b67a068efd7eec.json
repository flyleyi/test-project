{"remainingRequest":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/babel-loader/lib/index.js!/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/eslint-loader/index.js??ref--13-0!/Users/fuyueyi/Desktop/practice/mutilwap/src/pages/catering-h5/plugins/core/permission.js","dependencies":[{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/src/pages/catering-h5/plugins/core/permission.js","mtime":1645178321122},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IFZ1ZSBmcm9tICd2dWUnOwppbXBvcnQgTlByb2dyZXNzIGZyb20gJ25wcm9ncmVzcyc7IC8vIFByb2dyZXNzIOi/m+W6puadoQoKaW1wb3J0IHJvdXRlciBmcm9tICcuLi8uLi9yb3V0ZXIvaW5kZXgnOyAvLyDot6/nlLEKCmltcG9ydCB7IGdldFRva2VuIH0gZnJvbSAnLi4vLi4vLi4vLi4vcGx1Z2lucy9jb3JlL2F1dGgnOyAvLyBnZXQgdG9rZW4gZnJvbSBjb29raWUKCmltcG9ydCBzdG9yZSBmcm9tICcuLi8uLi9zdG9yZSc7IC8vIOeKtuaAgeeuoeeQhgoKLy8g57uE5Lu2Ci8vIOeZveWQjeWNlQp2YXIgV0hJVEVfTElTVCA9IFsnL2RpbmctbG9naW4nLCAnL21hbnVhbC1sb2dpbicsICcvd2Vla2x5JywgJy93ZWVrbHktZm9vZHMnLCAnL3dlZWtseS1mb29kcy1kZXRhaWwnXTsgLy8g5p2D6ZmQ5oum5oiq5ZmoCgpyb3V0ZXIuYmVmb3JlRWFjaChmdW5jdGlvbiAodG8sIGZyb20sIG5leHQpIHsKICAvLyBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdkZXZlbG9wbWVudCcgJiYgIVZ1ZS5kZC52ZXJzaW9uKSB7CiAgLy8gICBUb2FzdCgn6K+35L2/55So6ZKJ6ZKJ5omT5byAJyk7CiAgLy8gICByZXR1cm47CiAgLy8gfQogIC8v5piv5ZCm5Li65raI5oGv6Lez6L2s77yM6Lez6L2s6ZqQ6JeP5YiH5o2i6KeS6ImyCiAgaWYgKHRvLnF1ZXJ5LnJlZGlyZWN0KSB7CiAgICBzdG9yZS5jb21taXQoJ1NFVF9SRURJUkVDVCcpOwogIH0KCiAgaWYgKFdISVRFX0xJU1QuaW5kZXhPZih0by5wYXRoKSAhPT0gLTEpIHsKICAgIC8vIOi/h+a7pOeZveWQjeWNlQogICAgTlByb2dyZXNzLnN0YXJ0KCk7CiAgICBuZXh0KCk7CiAgICByZXR1cm47CiAgfQoKICBpZiAoZ2V0VG9rZW4oKSkgewogICAgaWYgKHN0b3JlLnN0YXRlLnVzZXIuaGFzVXNlckluZm8pIHsKICAgICAgc2V0RERSaWdodEJ0bigpOwogICAgICBuZXh0KCk7CiAgICB9IGVsc2UgewogICAgICBzdG9yZS5kaXNwYXRjaCgndXNlci9nZXRVc2VySW5mbycpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgIHNldEREUmlnaHRCdG4oKTsKICAgICAgICBuZXh0KCk7CiAgICAgIH0pOwogICAgfQogIH0gZWxzZSB7CiAgICAvLyBuZXh0KCcvZGluZy1sb2dpbicpOwogICAgbmV4dCgiL2RpbmctbG9naW4/cmVkaXJlY3Q9Ii5jb25jYXQodG8uZnVsbFBhdGgpKTsKICB9IC8vIGlmIChnZXRUb2tlbigpKSB7CiAgLy8gICAvLyDlt7LnmbvlvZUKICAvLyAgIGlmICh0by5wYXRoID09PSAnL2RpbmctbG9naW4nKSB7CiAgLy8gICAgIC8vIOWmguaenOaYr+eZu+W9lemhtemdouiHquWKqOi3s+i9rOWIsOmmlumhtQogIC8vICAgICBuZXh0KCcvJyk7CiAgLy8gICB9IGVsc2UgaWYgKHN0b3JlLnN0YXRlLmhhc1VzZXJJbmZvKSB7CiAgLy8gICAgIC8vIOaYr+WQpuacieeUqOaIt+S/oeaBrwogIC8vICAgICBOUHJvZ3Jlc3Muc3RhcnQoKTsKICAvLyAgICAgaWYgKHRvLm1ldGEudGl0bGUpIHsKICAvLyAgICAgICBkb2N1bWVudC50aXRsZSA9IHRvLm1ldGEudGl0bGU7CiAgLy8gICAgIH0KICAvLyAgICAgbmV4dCgpOwogIC8vICAgfSBlbHNlIHsKICAvLyAgICAgLy8g6I635Y+W55So5oi35L+h5oGvCiAgLy8gICAgIGNvbnN0IGxvYWRpbmcgPSBUb2FzdC5sb2FkaW5nKHsKICAvLyAgICAgICBtZXNzYWdlOiAn5Yqg6L295pWw5o2uJwogIC8vICAgICB9KTsKICAvLyAgICAgc3RvcmUKICAvLyAgICAgICAuZGlzcGF0Y2goJ2xvYWREYXRhJykKICAvLyAgICAgICAudGhlbigoKSA9PiB7CiAgLy8gICAgICAgICBOUHJvZ3Jlc3Muc3RhcnQoKTsKICAvLyAgICAgICAgIG5leHQoKTsKICAvLyAgICAgICB9KQogIC8vICAgICAgIC5jYXRjaChlcnJvciA9PiB7CiAgLy8gICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTsKICAvLyAgICAgICAgIC8vIOaVsOaNruWKoOi9veWksei0pQogIC8vICAgICAgICAgRGlhbG9nLmFsZXJ0KHsKICAvLyAgICAgICAgICAgdGl0bGU6ICfmj5DnpLonLAogIC8vICAgICAgICAgICBtZXNzYWdlOiAn5pWw5o2u5Yqg6L295aSx6LSlJywKICAvLyAgICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICfph43mlrDliqDovb0nCiAgLy8gICAgICAgICB9KS50aGVuKCgpID0+IHsKICAvLyAgICAgICAgICAgLy8g6YeN5paw6L+b5YWl6aG16Z2i5Yqg6L295pWw5o2uCiAgLy8gICAgICAgICAgIG5leHQoewogIC8vICAgICAgICAgICAgIC4uLnRvCiAgLy8gICAgICAgICAgIH0pOwogIC8vICAgICAgICAgfSk7CiAgLy8gICAgICAgfSkKICAvLyAgICAgICAuZmluYWxseSgoKSA9PiB7CiAgLy8gICAgICAgICBsb2FkaW5nLmNsZWFyKCk7CiAgLy8gICAgICAgfSk7CiAgLy8gICB9CiAgLy8gfSBlbHNlIHsKICAvLyAgIC8vIOacqueZu+W9lQogIC8vICAgbmV4dChgL2RpbmctbG9naW4/cmVkaXJlY3Q9JHt0by5mdWxsUGF0aH1gKTsgLy8g6Lez6L2s6ZKJ6ZKJ5YWN55m76aG16Z2iCiAgLy8gfQoKfSk7CnJvdXRlci5hZnRlckVhY2goZnVuY3Rpb24gKHRvKSB7CiAgdmFyIHRpdGxlID0gdG8ubWV0YSAmJiB0by5tZXRhLnRpdGxlIHx8ICcnOwoKICBpZiAoVnVlLmRkLnZlcnNpb24pIHsKICAgIC8vIOmSiemSieeOr+Wig++8jOiuvue9rnRpdGxl5Lya5bu26L+f77yM5Y+q6IO96LCD55So6ZKJ6ZKJ55qEanNzZGsKICAgIFZ1ZS5kZC5iaXoubmF2aWdhdGlvbi5zZXRUaXRsZSh7CiAgICAgIHRpdGxlOiB0aXRsZSwKICAgICAgb25GYWlsOiBmdW5jdGlvbiBvbkZhaWwoZXJyKSB7CiAgICAgICAgY29uc29sZS5lcnJvcign6K6+572u5a+86Iiq5qCP5qCH6aKY6ZSZ6K+vJywgZXJyKTsKICAgICAgICBkb2N1bWVudC50aXRsZSA9IHRpdGxlOwogICAgICB9CiAgICB9KTsKICB9IGVsc2UgewogICAgLy8g5pmu6YCa5rWP6KeI5ZmoCiAgICBkb2N1bWVudC50aXRsZSA9IHRpdGxlOwogIH0KCiAgTlByb2dyZXNzLmRvbmUoKTsgLy8g57uT5p2fUHJvZ3Jlc3MKfSk7IC8v6K6+572u6ZKJ6ZKJ5Y+z5LiK6KeS5oyJ6ZKu77yM6Lez6L2s6ZqQ6JeP5YiH5o2i6KeS6ImyCgpmdW5jdGlvbiBzZXRERFJpZ2h0QnRuKCkgewogIHZhciByb2xlVHlwZSA9IHN0b3JlLnN0YXRlLnVzZXIucm9sZVR5cGVJbml0OwogIHZhciBpc1JlZGlyZWN0ID0gc3RvcmUuc3RhdGUuaXNSZWRpcmVjdDsKCiAgaWYgKFZ1ZS5kZC52ZXJzaW9uKSB7CiAgICBWdWUuZGQuYml6Lm5hdmlnYXRpb24uc2V0UmlnaHQoewogICAgICBzaG93OiByb2xlVHlwZS5sZW5ndGggPiAxICYmICFpc1JlZGlyZWN0ID8gdHJ1ZSA6IGZhbHNlLAogICAgICAvL+aOp+WItuaMiemSruaYvuekuu+8jCB0cnVlIOaYvuekuu+8jCBmYWxzZSDpmpDol4/vvIwg6buY6K6kdHJ1ZQogICAgICBjb250cm9sOiB0cnVlLAogICAgICAvL+aYr+WQpuaOp+WItueCueWHu+S6i+S7tu+8jHRydWUg5o6n5Yi277yMZmFsc2Ug5LiN5o6n5Yi277yMIOm7mOiupGZhbHNlCiAgICAgIHRleHQ6ICfliIfmjaLop5LoibInLAogICAgICAvL+aOp+WItuaYvuekuuaWh+acrO+8jOepuuWtl+espuS4suihqOekuuaYvuekuum7mOiupOaWh+acrAogICAgICBvblN1Y2Nlc3M6IGZ1bmN0aW9uIG9uU3VjY2VzcyhyZXN1bHQpIHsKICAgICAgICAvL+WmguaenGNvbnRyb2zkuLp0cnVl77yM5YiZb25TdWNjZXNz5bCG5Zyo5Y+R55Sf5oyJ6ZKu54K55Ye75LqL5Lu26KKr5Zue6LCDCgogICAgICAgIC8qCiAgICAgICAgICB7fQogICAgICAgICAgKi8KICAgICAgICByb3V0ZXIucHVzaCh7CiAgICAgICAgICBwYXRoOiAnL2Nob29zZS1pZGVudGl0eScKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgb25GYWlsOiBmdW5jdGlvbiBvbkZhaWwoZXJyKSB7fQogICAgfSk7CiAgfQp9"},{"version":3,"sources":["/Users/fuyueyi/Desktop/practice/mutilwap/src/pages/catering-h5/plugins/core/permission.js"],"names":["Vue","NProgress","router","getToken","store","WHITE_LIST","beforeEach","to","from","next","query","redirect","commit","indexOf","path","start","state","user","hasUserInfo","setDDRightBtn","dispatch","then","fullPath","afterEach","title","meta","dd","version","biz","navigation","setTitle","onFail","err","console","error","document","done","roleType","roleTypeInit","isRedirect","setRight","show","length","control","text","onSuccess","result","push"],"mappings":"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","sourcesContent":["import Vue from 'vue';\nimport NProgress from 'nprogress'; // Progress 进度条\nimport router from '../../router/index'; // 路由\nimport { getToken } from '../../../../plugins/core/auth'; // get token from cookie\nimport store from '../../store'; // 状态管理\nimport { Dialog, Toast } from 'vant'; // 组件\n\n// 白名单\nconst WHITE_LIST = [\n  '/ding-login',\n  '/manual-login',\n  '/weekly',\n  '/weekly-foods',\n  '/weekly-foods-detail'\n];\n\n// 权限拦截器\nrouter.beforeEach((to, from, next) => {\n  // if (process.env.NODE_ENV !== 'development' && !Vue.dd.version) {\n  //   Toast('请使用钉钉打开');\n  //   return;\n  // }\n  //是否为消息跳转，跳转隐藏切换角色\n  if (to.query.redirect) {\n    store.commit('SET_REDIRECT');\n  }\n  if (WHITE_LIST.indexOf(to.path) !== -1) {\n    // 过滤白名单\n    NProgress.start();\n    next();\n    return;\n  }\n  if (getToken()) {\n    if (store.state.user.hasUserInfo) {\n      setDDRightBtn();\n      next();\n    } else {\n      store.dispatch('user/getUserInfo').then(() => {\n        setDDRightBtn();\n        next();\n      });\n    }\n  } else {\n    // next('/ding-login');\n    next(`/ding-login?redirect=${to.fullPath}`);\n  }\n\n  // if (getToken()) {\n  //   // 已登录\n  //   if (to.path === '/ding-login') {\n  //     // 如果是登录页面自动跳转到首页\n  //     next('/');\n  //   } else if (store.state.hasUserInfo) {\n  //     // 是否有用户信息\n  //     NProgress.start();\n  //     if (to.meta.title) {\n  //       document.title = to.meta.title;\n  //     }\n  //     next();\n  //   } else {\n  //     // 获取用户信息\n  //     const loading = Toast.loading({\n  //       message: '加载数据'\n  //     });\n  //     store\n  //       .dispatch('loadData')\n  //       .then(() => {\n  //         NProgress.start();\n  //         next();\n  //       })\n  //       .catch(error => {\n  //         console.error(error);\n  //         // 数据加载失败\n  //         Dialog.alert({\n  //           title: '提示',\n  //           message: '数据加载失败',\n  //           confirmButtonText: '重新加载'\n  //         }).then(() => {\n  //           // 重新进入页面加载数据\n  //           next({\n  //             ...to\n  //           });\n  //         });\n  //       })\n  //       .finally(() => {\n  //         loading.clear();\n  //       });\n  //   }\n  // } else {\n  //   // 未登录\n  //   next(`/ding-login?redirect=${to.fullPath}`); // 跳转钉钉免登页面\n  // }\n});\n\nrouter.afterEach(to => {\n  const title = (to.meta && to.meta.title) || '';\n  if (Vue.dd.version) {\n    // 钉钉环境，设置title会延迟，只能调用钉钉的jssdk\n    Vue.dd.biz.navigation.setTitle({\n      title,\n      onFail: err => {\n        console.error('设置导航栏标题错误', err);\n        document.title = title;\n      }\n    });\n  } else {\n    // 普通浏览器\n    document.title = title;\n  }\n  NProgress.done(); // 结束Progress\n});\n//设置钉钉右上角按钮，跳转隐藏切换角色\nfunction setDDRightBtn() {\n  const roleType = store.state.user.roleTypeInit;\n  const isRedirect = store.state.isRedirect;\n  if (Vue.dd.version) {\n    Vue.dd.biz.navigation.setRight({\n      show: roleType.length > 1 && !isRedirect ? true : false, //控制按钮显示， true 显示， false 隐藏， 默认true\n      control: true, //是否控制点击事件，true 控制，false 不控制， 默认false\n      text: '切换角色', //控制显示文本，空字符串表示显示默认文本\n      onSuccess: result => {\n        //如果control为true，则onSuccess将在发生按钮点击事件被回调\n        /*\n          {}\n          */\n        router.push({\n          path: '/choose-identity'\n        });\n      },\n      onFail: function(err) {}\n    });\n  }\n}\n"]}]}