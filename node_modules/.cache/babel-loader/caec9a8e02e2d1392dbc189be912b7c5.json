{"remainingRequest":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/babel-loader/lib/index.js!/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/eslint-loader/index.js??ref--13-0!/Users/fuyueyi/Desktop/practice/mutilwap/src/pages/teaching-points-h5-pre/plugins/core/permission.js","dependencies":[{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/src/pages/teaching-points-h5-pre/plugins/core/permission.js","mtime":1645176309870},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9vYmplY3RTcHJlYWQgZnJvbSAiL1VzZXJzL2Z1eXVleWkvRGVza3RvcC9wcmFjdGljZS9tdXRpbHdhcC9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vb2JqZWN0U3ByZWFkMiI7CmltcG9ydCAidmFudC9lcy9kaWFsb2cvc3R5bGUiOwppbXBvcnQgX0RpYWxvZyBmcm9tICJ2YW50L2VzL2RpYWxvZyI7CmltcG9ydCAidmFudC9lcy90b2FzdC9zdHlsZSI7CmltcG9ydCBfVG9hc3QgZnJvbSAidmFudC9lcy90b2FzdCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmcuanMiOwppbXBvcnQgVnVlIGZyb20gJ3Z1ZSc7CmltcG9ydCBOUHJvZ3Jlc3MgZnJvbSAnbnByb2dyZXNzJzsgLy8gUHJvZ3Jlc3Mg6L+b5bqm5p2hCgppbXBvcnQgcm91dGVyIGZyb20gJy4uLy4uL3JvdXRlci9pbmRleCc7IC8vIOi3r+eUsQoKaW1wb3J0IHsgZ2V0VG9rZW4gfSBmcm9tICcuL2F1dGgnOyAvLyDmnYPpmZAKCmltcG9ydCBzdG9yZSBmcm9tICcuLi8uLi9zdG9yZSc7IC8vIOeKtuaAgeeuoeeQhgoKLy8g57uE5Lu2Ci8vIOeZveWQjeWNlQp2YXIgV0hJVEVfTElTVCA9IFsnL2RpbmctbG9naW4nLCAnL3Rlc3QtbG9naW4nXTsgLy8g5p2D6ZmQ5oum5oiq5ZmoCgpyb3V0ZXIuYmVmb3JlRWFjaChmdW5jdGlvbiAodG8sIGZyb20sIG5leHQpIHsKICBpZiAoV0hJVEVfTElTVC5pbmRleE9mKHRvLnBhdGgpICE9PSAtMSkgewogICAgLy8g6L+H5ruk55m95ZCN5Y2VCiAgICBOUHJvZ3Jlc3Muc3RhcnQoKTsKICAgIG5leHQoKTsKICAgIHJldHVybjsKICB9CgogIGlmIChnZXRUb2tlbigpKSB7CiAgICAvLyDlt7LnmbvlvZUKICAgIGlmICh0by5wYXRoID09PSAnL2RpbmctbG9naW4nKSB7CiAgICAgIC8vIOWmguaenOaYr+eZu+W9lemhtemdouiHquWKqOi3s+i9rOWIsOmmlumhtQogICAgICBuZXh0KCcvJyk7CiAgICB9IGVsc2UgaWYgKHN0b3JlLnN0YXRlLmhhc1VzZXJJbmZvKSB7CiAgICAgIC8vIOaYr+WQpuacieeUqOaIt+S/oeaBrwogICAgICBOUHJvZ3Jlc3Muc3RhcnQoKTsKCiAgICAgIGlmICh0by5tZXRhLnRpdGxlKSB7CiAgICAgICAgZG9jdW1lbnQudGl0bGUgPSB0by5tZXRhLnRpdGxlOwogICAgICB9CgogICAgICBuZXh0KCk7CiAgICB9IGVsc2UgewogICAgICAvLyDojrflj5bnlKjmiLfkv6Hmga8KICAgICAgdmFyIGxvYWRpbmcgPSBfVG9hc3QubG9hZGluZyh7CiAgICAgICAgbWVzc2FnZTogJ+WKoOi9veaVsOaNricKICAgICAgfSk7CgogICAgICBzdG9yZS5kaXNwYXRjaCgnbG9hZERhdGEnKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICBOUHJvZ3Jlc3Muc3RhcnQoKTsKICAgICAgICBuZXh0KCk7CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpOyAvLyDmlbDmja7liqDovb3lpLHotKUKCiAgICAgICAgX0RpYWxvZy5hbGVydCh7CiAgICAgICAgICB0aXRsZTogJ+aPkOekuicsCiAgICAgICAgICBtZXNzYWdlOiAn5pWw5o2u5Yqg6L295aSx6LSlJywKICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAn6YeN5paw5Yqg6L29JwogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgLy8g6YeN5paw6L+b5YWl6aG16Z2i5Yqg6L295pWw5o2uCiAgICAgICAgICBuZXh0KF9vYmplY3RTcHJlYWQoe30sIHRvKSk7CiAgICAgICAgfSk7CiAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkgewogICAgICAgIGxvYWRpbmcuY2xlYXIoKTsKICAgICAgfSk7CiAgICB9CiAgfSBlbHNlIHsKICAgIC8vIOacqueZu+W9lQogICAgbmV4dCgiL2RpbmctbG9naW4/cmVkaXJlY3Q9Ii5jb25jYXQodG8uZnVsbFBhdGgpKTsgLy8g6Lez6L2s6ZKJ6ZKJ5YWN55m76aG16Z2iCiAgfQp9KTsKcm91dGVyLmFmdGVyRWFjaChmdW5jdGlvbiAodG8pIHsKICB2YXIgdGl0bGUgPSB0by5tZXRhICYmIHRvLm1ldGEudGl0bGUgfHwgJyc7CgogIGlmIChWdWUuZGQudmVyc2lvbikgewogICAgLy8g6ZKJ6ZKJ546v5aKD77yM6K6+572udGl0bGXkvJrlu7bov5/vvIzlj6rog73osIPnlKjpkonpkonnmoRqc3NkawogICAgVnVlLmRkLmJpei5uYXZpZ2F0aW9uLnNldFRpdGxlKHsKICAgICAgdGl0bGU6IHRpdGxlLAogICAgICBvbkZhaWw6IGZ1bmN0aW9uIG9uRmFpbChlcnIpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCforr7nva7lr7zoiKrmoI/moIfpopjplJnor68nLCBlcnIpOwogICAgICAgIGRvY3VtZW50LnRpdGxlID0gdGl0bGU7CiAgICAgIH0KICAgIH0pOwogIH0gZWxzZSB7CiAgICAvLyDmma7pgJrmtY/op4jlmagKICAgIGRvY3VtZW50LnRpdGxlID0gdGl0bGU7CiAgfQoKICBOUHJvZ3Jlc3MuZG9uZSgpOyAvLyDnu5PmnZ9Qcm9ncmVzcwp9KTs="},{"version":3,"sources":["/Users/fuyueyi/Desktop/practice/mutilwap/src/pages/teaching-points-h5-pre/plugins/core/permission.js"],"names":["Vue","NProgress","router","getToken","store","WHITE_LIST","beforeEach","to","from","next","indexOf","path","start","state","hasUserInfo","meta","title","document","loading","message","dispatch","then","catch","error","console","alert","confirmButtonText","finally","clear","fullPath","afterEach","dd","version","biz","navigation","setTitle","onFail","err","done"],"mappings":"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","sourcesContent":["import Vue from 'vue';\r\nimport NProgress from 'nprogress'; // Progress 进度条\r\nimport router from '../../router/index'; // 路由\r\nimport { getToken } from './auth'; // 权限\r\nimport store from '../../store'; // 状态管理\r\nimport { Dialog, Toast } from 'vant'; // 组件\r\n\r\n// 白名单\r\nconst WHITE_LIST = ['/ding-login', '/test-login'];\r\n\r\n// 权限拦截器\r\nrouter.beforeEach((to, from, next) => {\r\n  if (WHITE_LIST.indexOf(to.path) !== -1) {\r\n    // 过滤白名单\r\n    NProgress.start();\r\n    next();\r\n    return;\r\n  }\r\n  if (getToken()) {\r\n    // 已登录\r\n    if (to.path === '/ding-login') {\r\n      // 如果是登录页面自动跳转到首页\r\n      next('/');\r\n    } else if (store.state.hasUserInfo) {\r\n      // 是否有用户信息\r\n      NProgress.start();\r\n      if (to.meta.title) {\r\n        document.title = to.meta.title;\r\n      }\r\n      next();\r\n    } else {\r\n      // 获取用户信息\r\n      const loading = Toast.loading({\r\n        message: '加载数据'\r\n      });\r\n      store\r\n        .dispatch('loadData')\r\n        .then(() => {\r\n          NProgress.start();\r\n          next();\r\n        })\r\n        .catch(error => {\r\n          console.error(error);\r\n          // 数据加载失败\r\n          Dialog.alert({\r\n            title: '提示',\r\n            message: '数据加载失败',\r\n            confirmButtonText: '重新加载'\r\n          }).then(() => {\r\n            // 重新进入页面加载数据\r\n            next({\r\n              ...to\r\n            });\r\n          });\r\n        })\r\n        .finally(() => {\r\n          loading.clear();\r\n        });\r\n    }\r\n  } else {\r\n    // 未登录\r\n    next(`/ding-login?redirect=${to.fullPath}`); // 跳转钉钉免登页面\r\n  }\r\n});\r\n\r\nrouter.afterEach(to => {\r\n  const title = (to.meta && to.meta.title) || '';\r\n  if (Vue.dd.version) {\r\n    // 钉钉环境，设置title会延迟，只能调用钉钉的jssdk\r\n    Vue.dd.biz.navigation.setTitle({\r\n      title,\r\n      onFail: err => {\r\n        console.error('设置导航栏标题错误', err);\r\n        document.title = title;\r\n      }\r\n    });\r\n  } else {\r\n    // 普通浏览器\r\n    document.title = title;\r\n  }\r\n  NProgress.done(); // 结束Progress\r\n});\r\n"]}]}