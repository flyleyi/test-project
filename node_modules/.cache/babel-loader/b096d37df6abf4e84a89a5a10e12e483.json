{"remainingRequest":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/babel-loader/lib/index.js!/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/eslint-loader/index.js??ref--13-0!/Users/fuyueyi/Desktop/practice/mutilwap/src/pages/teaching-points-h5/plugins/core/permission.js","dependencies":[{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/src/pages/teaching-points-h5/plugins/core/permission.js","mtime":1645176309875},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9vYmplY3RTcHJlYWQgZnJvbSAiL1VzZXJzL2Z1eXVleWkvRGVza3RvcC9wcmFjdGljZS9tdXRpbHdhcC9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vb2JqZWN0U3ByZWFkMiI7CmltcG9ydCAidmFudC9lcy9kaWFsb2cvc3R5bGUiOwppbXBvcnQgX0RpYWxvZyBmcm9tICJ2YW50L2VzL2RpYWxvZyI7CmltcG9ydCAidmFudC9lcy90b2FzdC9zdHlsZSI7CmltcG9ydCBfVG9hc3QgZnJvbSAidmFudC9lcy90b2FzdCI7CmltcG9ydCBWdWUgZnJvbSAndnVlJzsKaW1wb3J0IE5Qcm9ncmVzcyBmcm9tICducHJvZ3Jlc3MnOyAvLyBQcm9ncmVzcyDov5vluqbmnaEKCmltcG9ydCByb3V0ZXIgZnJvbSAnLi4vLi4vcm91dGVyL2luZGV4JzsgLy8g6Lev55SxCgppbXBvcnQgeyBnZXRUb2tlbiB9IGZyb20gJy4vYXV0aCc7IC8vIOadg+mZkAoKaW1wb3J0IHN0b3JlIGZyb20gJy4uLy4uL3N0b3JlJzsgLy8g54q25oCB566h55CGCgovLyDnu4Tku7YKLy8g55m95ZCN5Y2VCnZhciBXSElURV9MSVNUID0gWycvZGluZy1sb2dpbicsICcvdGVzdC1sb2dpbiddOyAvLyDmnYPpmZDmi6bmiKrlmagKCnJvdXRlci5iZWZvcmVFYWNoKGZ1bmN0aW9uICh0bywgZnJvbSwgbmV4dCkgewogIGlmIChXSElURV9MSVNULmluZGV4T2YodG8ucGF0aCkgIT09IC0xKSB7CiAgICAvLyDov4fmu6Tnmb3lkI3ljZUKICAgIE5Qcm9ncmVzcy5zdGFydCgpOwogICAgbmV4dCgpOwogICAgcmV0dXJuOwogIH0KCiAgaWYgKGdldFRva2VuKCkpIHsKICAgIC8vIOW3sueZu+W9lQogICAgaWYgKHRvLnBhdGggPT09ICcvZGluZy1sb2dpbicpIHsKICAgICAgLy8g5aaC5p6c5piv55m75b2V6aG16Z2i6Ieq5Yqo6Lez6L2s5Yiw6aaW6aG1CiAgICAgIG5leHQoJy8nKTsKICAgIH0gZWxzZSBpZiAoc3RvcmUuc3RhdGUuaGFzVXNlckluZm8pIHsKICAgICAgLy8g5piv5ZCm5pyJ55So5oi35L+h5oGvCiAgICAgIE5Qcm9ncmVzcy5zdGFydCgpOwoKICAgICAgaWYgKHRvLm1ldGEudGl0bGUpIHsKICAgICAgICBkb2N1bWVudC50aXRsZSA9IHRvLm1ldGEudGl0bGU7CiAgICAgIH0KCiAgICAgIG5leHQoKTsKICAgIH0gZWxzZSB7CiAgICAgIC8vIOiOt+WPlueUqOaIt+S/oeaBrwogICAgICB2YXIgbG9hZGluZyA9IF9Ub2FzdC5sb2FkaW5nKHsKICAgICAgICBtZXNzYWdlOiAn5Yqg6L295pWw5o2uJwogICAgICB9KTsKCiAgICAgIHN0b3JlLmRpc3BhdGNoKCdsb2FkRGF0YScpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgIE5Qcm9ncmVzcy5zdGFydCgpOwogICAgICAgIG5leHQoKTsKICAgICAgICBsb2FkaW5nLmNsZWFyKCk7CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpOyAvLyDmlbDmja7liqDovb3lpLHotKUKCiAgICAgICAgX0RpYWxvZy5hbGVydCh7CiAgICAgICAgICB0aXRsZTogJ+aPkOekuicsCiAgICAgICAgICBtZXNzYWdlOiAn5pWw5o2u5Yqg6L295aSx6LSlJywKICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAn6YeN5paw5Yqg6L29JwogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgLy8g6YeN5paw6L+b5YWl6aG16Z2i5Yqg6L295pWw5o2uCiAgICAgICAgICBuZXh0KF9vYmplY3RTcHJlYWQoe30sIHRvKSk7CiAgICAgICAgfSk7CgogICAgICAgIGxvYWRpbmcuY2xlYXIoKTsKICAgICAgfSk7CiAgICB9CiAgfSBlbHNlIHsKICAgIC8vIOacqueZu+W9lQogICAgbmV4dCgiL2RpbmctbG9naW4/cmVkaXJlY3Q9Ii5jb25jYXQodG8uZnVsbFBhdGgpKTsgLy8g6Lez6L2s6ZKJ6ZKJ5YWN55m76aG16Z2iCiAgfQp9KTsKcm91dGVyLmFmdGVyRWFjaChmdW5jdGlvbiAodG8pIHsKICB2YXIgdGl0bGUgPSB0by5tZXRhICYmIHRvLm1ldGEudGl0bGUgfHwgJyc7CgogIGlmIChWdWUuZGQudmVyc2lvbikgewogICAgLy8g6ZKJ6ZKJ546v5aKD77yM6K6+572udGl0bGXkvJrlu7bov5/vvIzlj6rog73osIPnlKjpkonpkonnmoRqc3NkawogICAgVnVlLmRkLmJpei5uYXZpZ2F0aW9uLnNldFRpdGxlKHsKICAgICAgdGl0bGU6IHRpdGxlLAogICAgICBvbkZhaWw6IGZ1bmN0aW9uIG9uRmFpbChlcnIpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCforr7nva7lr7zoiKrmoI/moIfpopjplJnor68nLCBlcnIpOwogICAgICAgIGRvY3VtZW50LnRpdGxlID0gdGl0bGU7CiAgICAgIH0KICAgIH0pOwogIH0gZWxzZSB7CiAgICAvLyDmma7pgJrmtY/op4jlmagKICAgIGRvY3VtZW50LnRpdGxlID0gdGl0bGU7CiAgfQoKICBOUHJvZ3Jlc3MuZG9uZSgpOyAvLyDnu5PmnZ9Qcm9ncmVzcwp9KTs="},{"version":3,"sources":["/Users/fuyueyi/Desktop/practice/mutilwap/src/pages/teaching-points-h5/plugins/core/permission.js"],"names":["Vue","NProgress","router","getToken","store","WHITE_LIST","beforeEach","to","from","next","indexOf","path","start","state","hasUserInfo","meta","title","document","loading","message","dispatch","then","clear","catch","error","console","alert","confirmButtonText","fullPath","afterEach","dd","version","biz","navigation","setTitle","onFail","err","done"],"mappings":";;;;;AAAA,OAAOA,GAAP,MAAgB,KAAhB;AACA,OAAOC,SAAP,MAAsB,WAAtB,C,CAAmC;;AACnC,OAAOC,MAAP,MAAmB,oBAAnB,C,CAAyC;;AACzC,SAASC,QAAT,QAAyB,QAAzB,C,CAAmC;;AACnC,OAAOC,KAAP,MAAkB,aAAlB,C,CAAiC;;AACK;AAEtC;AACA,IAAMC,UAAU,GAAG,CAAC,aAAD,EAAgB,aAAhB,CAAnB,C,CAEA;;AACAH,MAAM,CAACI,UAAP,CAAkB,UAACC,EAAD,EAAKC,IAAL,EAAWC,IAAX,EAAoB;AACpC,MAAIJ,UAAU,CAACK,OAAX,CAAmBH,EAAE,CAACI,IAAtB,MAAgC,CAAC,CAArC,EAAwC;AACtC;AACAV,IAAAA,SAAS,CAACW,KAAV;AACAH,IAAAA,IAAI;AACJ;AACD;;AACD,MAAIN,QAAQ,EAAZ,EAAgB;AACd;AACA,QAAII,EAAE,CAACI,IAAH,KAAY,aAAhB,EAA+B;AAC7B;AACAF,MAAAA,IAAI,CAAC,GAAD,CAAJ;AACD,KAHD,MAGO,IAAIL,KAAK,CAACS,KAAN,CAAYC,WAAhB,EAA6B;AAClC;AACAb,MAAAA,SAAS,CAACW,KAAV;;AACA,UAAIL,EAAE,CAACQ,IAAH,CAAQC,KAAZ,EAAmB;AACjBC,QAAAA,QAAQ,CAACD,KAAT,GAAiBT,EAAE,CAACQ,IAAH,CAAQC,KAAzB;AACD;;AACDP,MAAAA,IAAI;AACL,KAPM,MAOA;AACL;AACA,UAAMS,OAAO,GAAG,OAAMA,OAAN,CAAc;AAC5BC,QAAAA,OAAO,EAAE;AADmB,OAAd,CAAhB;;AAGAf,MAAAA,KAAK,CACFgB,QADH,CACY,UADZ,EAEGC,IAFH,CAEQ,YAAM;AACVpB,QAAAA,SAAS,CAACW,KAAV;AACAH,QAAAA,IAAI;AACJS,QAAAA,OAAO,CAACI,KAAR;AACD,OANH,EAOGC,KAPH,CAOS,UAAAC,KAAK,EAAI;AACdC,QAAAA,OAAO,CAACD,KAAR,CAAcA,KAAd,EADc,CAEd;;AACA,gBAAOE,KAAP,CAAa;AACXV,UAAAA,KAAK,EAAE,IADI;AAEXG,UAAAA,OAAO,EAAE,QAFE;AAGXQ,UAAAA,iBAAiB,EAAE;AAHR,SAAb,EAIGN,IAJH,CAIQ,YAAM;AACZ;AACAZ,UAAAA,IAAI,mBACCF,EADD,EAAJ;AAGD,SATD;;AAUAW,QAAAA,OAAO,CAACI,KAAR;AACD,OArBH;AAsBD;AACF,GAxCD,MAwCO;AACL;AACAb,IAAAA,IAAI,gCAAyBF,EAAE,CAACqB,QAA5B,EAAJ,CAFK,CAEwC;AAC9C;AACF,CAnDD;AAqDA1B,MAAM,CAAC2B,SAAP,CAAiB,UAAAtB,EAAE,EAAI;AACrB,MAAMS,KAAK,GAAIT,EAAE,CAACQ,IAAH,IAAWR,EAAE,CAACQ,IAAH,CAAQC,KAApB,IAA8B,EAA5C;;AACA,MAAIhB,GAAG,CAAC8B,EAAJ,CAAOC,OAAX,EAAoB;AAClB;AACA/B,IAAAA,GAAG,CAAC8B,EAAJ,CAAOE,GAAP,CAAWC,UAAX,CAAsBC,QAAtB,CAA+B;AAC7BlB,MAAAA,KAAK,EAALA,KAD6B;AAE7BmB,MAAAA,MAAM,EAAE,gBAAAC,GAAG,EAAI;AACbX,QAAAA,OAAO,CAACD,KAAR,CAAc,WAAd,EAA2BY,GAA3B;AACAnB,QAAAA,QAAQ,CAACD,KAAT,GAAiBA,KAAjB;AACD;AAL4B,KAA/B;AAOD,GATD,MASO;AACL;AACAC,IAAAA,QAAQ,CAACD,KAAT,GAAiBA,KAAjB;AACD;;AACDf,EAAAA,SAAS,CAACoC,IAAV,GAfqB,CAeH;AACnB,CAhBD","sourcesContent":["import Vue from 'vue';\r\nimport NProgress from 'nprogress'; // Progress 进度条\r\nimport router from '../../router/index'; // 路由\r\nimport { getToken } from './auth'; // 权限\r\nimport store from '../../store'; // 状态管理\r\nimport { Dialog, Toast } from 'vant'; // 组件\r\n\r\n// 白名单\r\nconst WHITE_LIST = ['/ding-login', '/test-login'];\r\n\r\n// 权限拦截器\r\nrouter.beforeEach((to, from, next) => {\r\n  if (WHITE_LIST.indexOf(to.path) !== -1) {\r\n    // 过滤白名单\r\n    NProgress.start();\r\n    next();\r\n    return;\r\n  }\r\n  if (getToken()) {\r\n    // 已登录\r\n    if (to.path === '/ding-login') {\r\n      // 如果是登录页面自动跳转到首页\r\n      next('/');\r\n    } else if (store.state.hasUserInfo) {\r\n      // 是否有用户信息\r\n      NProgress.start();\r\n      if (to.meta.title) {\r\n        document.title = to.meta.title;\r\n      }\r\n      next();\r\n    } else {\r\n      // 获取用户信息\r\n      const loading = Toast.loading({\r\n        message: '加载数据'\r\n      });\r\n      store\r\n        .dispatch('loadData')\r\n        .then(() => {\r\n          NProgress.start();\r\n          next();\r\n          loading.clear();\r\n        })\r\n        .catch(error => {\r\n          console.error(error);\r\n          // 数据加载失败\r\n          Dialog.alert({\r\n            title: '提示',\r\n            message: '数据加载失败',\r\n            confirmButtonText: '重新加载'\r\n          }).then(() => {\r\n            // 重新进入页面加载数据\r\n            next({\r\n              ...to\r\n            });\r\n          });\r\n          loading.clear();\r\n        });\r\n    }\r\n  } else {\r\n    // 未登录\r\n    next(`/ding-login?redirect=${to.fullPath}`); // 跳转钉钉免登页面\r\n  }\r\n});\r\n\r\nrouter.afterEach(to => {\r\n  const title = (to.meta && to.meta.title) || '';\r\n  if (Vue.dd.version) {\r\n    // 钉钉环境，设置title会延迟，只能调用钉钉的jssdk\r\n    Vue.dd.biz.navigation.setTitle({\r\n      title,\r\n      onFail: err => {\r\n        console.error('设置导航栏标题错误', err);\r\n        document.title = title;\r\n      }\r\n    });\r\n  } else {\r\n    // 普通浏览器\r\n    document.title = title;\r\n  }\r\n  NProgress.done(); // 结束Progress\r\n});\r\n"]}]}