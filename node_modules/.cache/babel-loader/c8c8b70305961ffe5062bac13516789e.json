{"remainingRequest":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/babel-loader/lib/index.js!/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/eslint-loader/index.js??ref--13-0!/Users/fuyueyi/Desktop/practice/mutilwap/src/pages/visitor-h5/plugins/core/permission.js","dependencies":[{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/src/pages/visitor-h5/plugins/core/permission.js","mtime":1645178321199},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IFZ1ZSBmcm9tICd2dWUnOwppbXBvcnQgTlByb2dyZXNzIGZyb20gJ25wcm9ncmVzcyc7IC8vIFByb2dyZXNzIOi/m+W6puadoQoKaW1wb3J0IHJvdXRlciBmcm9tICcuLi8uLi9yb3V0ZXIvaW5kZXgnOyAvLyDot6/nlLEKCmltcG9ydCB7IGdldFRva2VuLCByZW1vdmVUb2tlbiB9IGZyb20gJy4uLy4uLy4uLy4uL3BsdWdpbnMvY29yZS9hdXRoJzsgLy8gZ2V0IHRva2VuIGZyb20gY29va2llCgppbXBvcnQgc3RvcmUgZnJvbSAnLi4vLi4vc3RvcmUnOyAvLyDnirbmgIHnrqHnkIYKCi8vIOe7hOS7tgovLyDnmb3lkI3ljZUKdmFyIFdISVRFX0xJU1QgPSBbJy9kaW5nLWxvZ2luJywgJy9tYW51YWwtbG9naW4nLCAnL3Zpc2l0b3ItdmVyaWZ5L292ZXJkdWUtbGluaycsICcvdmlzaXRvci12ZXJpZnkvZG8tc3VjY2VzcyddOyAvLyDmnYPpmZDmi6bmiKrlmagKCnJvdXRlci5iZWZvcmVFYWNoKGZ1bmN0aW9uICh0bywgZnJvbSwgbmV4dCkgewogIC8vIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ2RldmVsb3BtZW50JyAmJiAhVnVlLmRkLnZlcnNpb24pIHsKICAvLyAgIFRvYXN0KCfor7fkvb/nlKjpkonpkonmiZPlvIAnKTsKICAvLyAgIHJldHVybjsKICAvLyB9CiAgLy/mmK/lkKbkuLrmtojmga/ot7PovazvvIzot7PovazpmpDol4/liIfmjaLop5LoibIKICBpZiAodG8ucXVlcnkucmVkaXJlY3QpIHsKICAgIHN0b3JlLmNvbW1pdCgnU0VUX1JFRElSRUNUJyk7CiAgfQoKICBpZiAoV0hJVEVfTElTVC5pbmRleE9mKHRvLnBhdGgpICE9PSAtMSkgewogICAgLy8g6L+H5ruk55m95ZCN5Y2VCiAgICBOUHJvZ3Jlc3Muc3RhcnQoKTsKICAgIG5leHQoKTsKICAgIHJldHVybjsKICB9CgogIGlmIChnZXRUb2tlbigpKSB7CiAgICBpZiAoc3RvcmUuc3RhdGUudXNlci5oYXNVc2VySW5mbykgewogICAgICBzZXRERFJpZ2h0QnRuKCk7CiAgICAgIG5leHQoKTsKICAgIH0gZWxzZSB7CiAgICAgIHN0b3JlLmRpc3BhdGNoKCd1c2VyL2dldFVzZXJJbmZvJykudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgc2V0RERSaWdodEJ0bigpOwogICAgICAgIG5leHQoKTsKICAgICAgfSk7CiAgICB9CiAgfSBlbHNlIHsKICAgIC8vIG5leHQoJy9kaW5nLWxvZ2luJyk7CiAgICBuZXh0KCIvZGluZy1sb2dpbj9yZWRpcmVjdD0iLmNvbmNhdCh0by5mdWxsUGF0aCkpOwogIH0gLy8gaWYgKGdldFRva2VuKCkpIHsKICAvLyAgIC8vIOW3sueZu+W9lQogIC8vICAgaWYgKHRvLnBhdGggPT09ICcvZGluZy1sb2dpbicpIHsKICAvLyAgICAgLy8g5aaC5p6c5piv55m75b2V6aG16Z2i6Ieq5Yqo6Lez6L2s5Yiw6aaW6aG1CiAgLy8gICAgIG5leHQoJy8nKTsKICAvLyAgIH0gZWxzZSBpZiAoc3RvcmUuc3RhdGUuaGFzVXNlckluZm8pIHsKICAvLyAgICAgLy8g5piv5ZCm5pyJ55So5oi35L+h5oGvCiAgLy8gICAgIE5Qcm9ncmVzcy5zdGFydCgpOwogIC8vICAgICBpZiAodG8ubWV0YS50aXRsZSkgewogIC8vICAgICAgIGRvY3VtZW50LnRpdGxlID0gdG8ubWV0YS50aXRsZTsKICAvLyAgICAgfQogIC8vICAgICBuZXh0KCk7CiAgLy8gICB9IGVsc2UgewogIC8vICAgICAvLyDojrflj5bnlKjmiLfkv6Hmga8KICAvLyAgICAgY29uc3QgbG9hZGluZyA9IFRvYXN0LmxvYWRpbmcoewogIC8vICAgICAgIG1lc3NhZ2U6ICfliqDovb3mlbDmja4nCiAgLy8gICAgIH0pOwogIC8vICAgICBzdG9yZQogIC8vICAgICAgIC5kaXNwYXRjaCgnbG9hZERhdGEnKQogIC8vICAgICAgIC50aGVuKCgpID0+IHsKICAvLyAgICAgICAgIE5Qcm9ncmVzcy5zdGFydCgpOwogIC8vICAgICAgICAgbmV4dCgpOwogIC8vICAgICAgIH0pCiAgLy8gICAgICAgLmNhdGNoKGVycm9yID0+IHsKICAvLyAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpOwogIC8vICAgICAgICAgLy8g5pWw5o2u5Yqg6L295aSx6LSlCiAgLy8gICAgICAgICBEaWFsb2cuYWxlcnQoewogIC8vICAgICAgICAgICB0aXRsZTogJ+aPkOekuicsCiAgLy8gICAgICAgICAgIG1lc3NhZ2U6ICfmlbDmja7liqDovb3lpLHotKUnLAogIC8vICAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogJ+mHjeaWsOWKoOi9vScKICAvLyAgICAgICAgIH0pLnRoZW4oKCkgPT4gewogIC8vICAgICAgICAgICAvLyDph43mlrDov5vlhaXpobXpnaLliqDovb3mlbDmja4KICAvLyAgICAgICAgICAgbmV4dCh7CiAgLy8gICAgICAgICAgICAgLi4udG8KICAvLyAgICAgICAgICAgfSk7CiAgLy8gICAgICAgICB9KTsKICAvLyAgICAgICB9KQogIC8vICAgICAgIC5maW5hbGx5KCgpID0+IHsKICAvLyAgICAgICAgIGxvYWRpbmcuY2xlYXIoKTsKICAvLyAgICAgICB9KTsKICAvLyAgIH0KICAvLyB9IGVsc2UgewogIC8vICAgLy8g5pyq55m75b2VCiAgLy8gICBuZXh0KGAvZGluZy1sb2dpbj9yZWRpcmVjdD0ke3RvLmZ1bGxQYXRofWApOyAvLyDot7PovazpkonpkonlhY3nmbvpobXpnaIKICAvLyB9Cgp9KTsKcm91dGVyLmFmdGVyRWFjaChmdW5jdGlvbiAodG8pIHsKICB2YXIgdGl0bGUgPSB0by5tZXRhICYmIHRvLm1ldGEudGl0bGUgfHwgJyc7CgogIGlmIChWdWUuZGQudmVyc2lvbikgewogICAgLy8g6ZKJ6ZKJ546v5aKD77yM6K6+572udGl0bGXkvJrlu7bov5/vvIzlj6rog73osIPnlKjpkonpkonnmoRqc3NkawogICAgVnVlLmRkLmJpei5uYXZpZ2F0aW9uLnNldFRpdGxlKHsKICAgICAgdGl0bGU6IHRpdGxlLAogICAgICBvbkZhaWw6IGZ1bmN0aW9uIG9uRmFpbChlcnIpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCforr7nva7lr7zoiKrmoI/moIfpopjplJnor68nLCBlcnIpOwogICAgICAgIGRvY3VtZW50LnRpdGxlID0gdGl0bGU7CiAgICAgIH0KICAgIH0pOwogIH0gZWxzZSB7CiAgICAvLyDmma7pgJrmtY/op4jlmagKICAgIGRvY3VtZW50LnRpdGxlID0gdGl0bGU7CiAgfQoKICBOUHJvZ3Jlc3MuZG9uZSgpOyAvLyDnu5PmnZ9Qcm9ncmVzcwp9KTsgLy/orr7nva7pkonpkonlj7PkuIrop5LmjInpkq7vvIzot7PovazpmpDol4/liIfmjaLop5LoibIKCmZ1bmN0aW9uIHNldEREUmlnaHRCdG4oKSB7CiAgdmFyIHJvbGVUeXBlID0gc3RvcmUuc3RhdGUudXNlci5yb2xlVHlwZUluaXQ7CiAgdmFyIGlzUmVkaXJlY3QgPSBzdG9yZS5zdGF0ZS5pc1JlZGlyZWN0OwoKICBpZiAoVnVlLmRkLnZlcnNpb24pIHsKICAgIFZ1ZS5kZC5iaXoubmF2aWdhdGlvbi5zZXRSaWdodCh7CiAgICAgIHNob3c6IHJvbGVUeXBlLmxlbmd0aCA+IDAgJiYgIWlzUmVkaXJlY3QgPyB0cnVlIDogZmFsc2UsCiAgICAgIC8v5o6n5Yi25oyJ6ZKu5pi+56S677yMIHRydWUg5pi+56S677yMIGZhbHNlIOmakOiXj++8jCDpu5jorqR0cnVlCiAgICAgIGNvbnRyb2w6IHRydWUsCiAgICAgIC8v5piv5ZCm5o6n5Yi254K55Ye75LqL5Lu277yMdHJ1ZSDmjqfliLbvvIxmYWxzZSDkuI3mjqfliLbvvIwg6buY6K6kZmFsc2UKICAgICAgdGV4dDogJ+WIh+aNouinkuiJsicsCiAgICAgIC8v5o6n5Yi25pi+56S65paH5pys77yM56m65a2X56ym5Liy6KGo56S65pi+56S66buY6K6k5paH5pysCiAgICAgIG9uU3VjY2VzczogZnVuY3Rpb24gb25TdWNjZXNzKHJlc3VsdCkgewogICAgICAgIC8v5aaC5p6cY29udHJvbOS4unRydWXvvIzliJlvblN1Y2Nlc3PlsIblnKjlj5HnlJ/mjInpkq7ngrnlh7vkuovku7booqvlm57osIMKCiAgICAgICAgLyoKICAgICAgICAgIHt9CiAgICAgICAgICAqLwogICAgICAgIHJvdXRlci5wdXNoKHsKICAgICAgICAgIHBhdGg6ICcvY2hvb3NlLWlkZW50aXR5JwogICAgICAgIH0pOwogICAgICB9LAogICAgICBvbkZhaWw6IGZ1bmN0aW9uIG9uRmFpbChlcnIpIHt9CiAgICB9KTsKICB9Cn0="},{"version":3,"sources":["/Users/fuyueyi/Desktop/practice/mutilwap/src/pages/visitor-h5/plugins/core/permission.js"],"names":["Vue","NProgress","router","getToken","removeToken","store","WHITE_LIST","beforeEach","to","from","next","query","redirect","commit","indexOf","path","start","state","user","hasUserInfo","setDDRightBtn","dispatch","then","fullPath","afterEach","title","meta","dd","version","biz","navigation","setTitle","onFail","err","console","error","document","done","roleType","roleTypeInit","isRedirect","setRight","show","length","control","text","onSuccess","result","push"],"mappings":"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","sourcesContent":["import Vue from 'vue';\nimport NProgress from 'nprogress'; // Progress 进度条\nimport router from '../../router/index'; // 路由\nimport { getToken, removeToken } from '../../../../plugins/core/auth'; // get token from cookie\nimport store from '../../store'; // 状态管理\nimport { Dialog, Toast } from 'vant'; // 组件\n\n// 白名单\nconst WHITE_LIST = [\n  '/ding-login',\n  '/manual-login',\n  '/visitor-verify/overdue-link',\n  '/visitor-verify/do-success'\n];\n\n// 权限拦截器\nrouter.beforeEach((to, from, next) => {\n  // if (process.env.NODE_ENV !== 'development' && !Vue.dd.version) {\n  //   Toast('请使用钉钉打开');\n  //   return;\n  // }\n  //是否为消息跳转，跳转隐藏切换角色\n  if (to.query.redirect) {\n    store.commit('SET_REDIRECT');\n  }\n  if (WHITE_LIST.indexOf(to.path) !== -1) {\n    // 过滤白名单\n    NProgress.start();\n    next();\n    return;\n  }\n  if (getToken()) {\n    if (store.state.user.hasUserInfo) {\n      setDDRightBtn();\n      next();\n    } else {\n      store.dispatch('user/getUserInfo').then(() => {\n        setDDRightBtn();\n        next();\n      });\n    }\n  } else {\n    // next('/ding-login');\n    next(`/ding-login?redirect=${to.fullPath}`);\n  }\n\n  // if (getToken()) {\n  //   // 已登录\n  //   if (to.path === '/ding-login') {\n  //     // 如果是登录页面自动跳转到首页\n  //     next('/');\n  //   } else if (store.state.hasUserInfo) {\n  //     // 是否有用户信息\n  //     NProgress.start();\n  //     if (to.meta.title) {\n  //       document.title = to.meta.title;\n  //     }\n  //     next();\n  //   } else {\n  //     // 获取用户信息\n  //     const loading = Toast.loading({\n  //       message: '加载数据'\n  //     });\n  //     store\n  //       .dispatch('loadData')\n  //       .then(() => {\n  //         NProgress.start();\n  //         next();\n  //       })\n  //       .catch(error => {\n  //         console.error(error);\n  //         // 数据加载失败\n  //         Dialog.alert({\n  //           title: '提示',\n  //           message: '数据加载失败',\n  //           confirmButtonText: '重新加载'\n  //         }).then(() => {\n  //           // 重新进入页面加载数据\n  //           next({\n  //             ...to\n  //           });\n  //         });\n  //       })\n  //       .finally(() => {\n  //         loading.clear();\n  //       });\n  //   }\n  // } else {\n  //   // 未登录\n  //   next(`/ding-login?redirect=${to.fullPath}`); // 跳转钉钉免登页面\n  // }\n});\n\nrouter.afterEach(to => {\n  const title = (to.meta && to.meta.title) || '';\n  if (Vue.dd.version) {\n    // 钉钉环境，设置title会延迟，只能调用钉钉的jssdk\n    Vue.dd.biz.navigation.setTitle({\n      title,\n      onFail: err => {\n        console.error('设置导航栏标题错误', err);\n        document.title = title;\n      }\n    });\n  } else {\n    // 普通浏览器\n    document.title = title;\n  }\n  NProgress.done(); // 结束Progress\n});\n//设置钉钉右上角按钮，跳转隐藏切换角色\nfunction setDDRightBtn() {\n  const roleType = store.state.user.roleTypeInit;\n  const isRedirect = store.state.isRedirect;\n  if (Vue.dd.version) {\n    Vue.dd.biz.navigation.setRight({\n      show: roleType.length > 0 && !isRedirect ? true : false, //控制按钮显示， true 显示， false 隐藏， 默认true\n      control: true, //是否控制点击事件，true 控制，false 不控制， 默认false\n      text: '切换角色', //控制显示文本，空字符串表示显示默认文本\n      onSuccess: result => {\n        //如果control为true，则onSuccess将在发生按钮点击事件被回调\n        /*\n          {}\n          */\n        router.push({\n          path: '/choose-identity'\n        });\n      },\n      onFail: function(err) {}\n    });\n  }\n}\n"]}]}