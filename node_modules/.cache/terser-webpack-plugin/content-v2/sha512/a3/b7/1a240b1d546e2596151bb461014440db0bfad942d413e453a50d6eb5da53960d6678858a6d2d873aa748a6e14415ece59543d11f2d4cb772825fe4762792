{"code":"(window[\"webpackJsonp\"]=window[\"webpackJsonp\"]||[]).push([[\"catering-order-management\"],{\"8bac\":function(e,t,r){\"use strict\";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r(\"div\",{staticClass:\"app-container\"},[r(\"b-table\",{ref:\"bTable\",attrs:{loading:\"\",\"empty-text\":\"供应商订单-暂无数据\",headers:e.headers,\"highlight-current-row\":!1,\"form-items\":e.formItems,pageLimit:10,\"ajax-get-data\":e.fetchTableData,initialFormData:e.initFormData,\"show-column\":!1,showRefresh:!1,\"row-key\":\"orderId\",\"row-class-name\":e.getRowCustomName,\"expand-row-keys\":e.expands,\"tree-props\":{children:\"children\",hasChildren:\"hasChildren\"}},on:{select:e.handleSelect,\"select-all\":function(t){return e.handleSelectAll(t,e.$refs.bTable.$refs.table.$refs.table)},\"table-data-change\":e.onChangeTableData},scopedSlots:e._u([{key:\"column|type\",fn:function(t){var n=t.row;return r(\"div\",{class:2===n.type?\"type red\":3===n.type?\"type yellow\":\"type\"},[e._v(\" \"+e._s(1===n.type?\"常规\":2===n.type?\"紧急\":\"补单\")+\" \")])}},{key:\"column|status\",fn:function(t){var r=t.row;return[e._v(\" \"+e._s(e.$D(\"SUPPLIER_ORDER_STATUS\",\"\"+r.status))+\" \")]}},{key:\"column|confirmTime\",fn:function(t){var r=t.row;return[e._v(\" \"+e._s(r.confirmTime?r.confirmTime.replace(/\\./g,\"-\"):\"\")+\" \")]}},{key:\"column|arrivalTime\",fn:function(t){var r=t.row;return[e._v(\" \"+e._s(r.arrivalTime?r.arrivalTime.replace(/\\./g,\"-\"):\"\")+\" \")]}},{key:\"column|operation\",fn:function(t){var n=t.row;return r(\"div\",{staticClass:\"operation\"},[n.parentId?r(\"span\",{on:{click:function(t){return e.onManagement(n)}}},[e._v(\"管理\")]):r(\"span\",{on:{click:function(t){return e.onManagement(n)}}},[e._v(\"查看\")])])}}])},[r(\"template\",{slot:\"table-before\"},[r(\"div\",{staticClass:\"tab-total-wrapper\"},[e._v(\" 售价\"),r(\"span\",{staticClass:\"tab-pane-num\"},[e._v(e._s(e.sumData.sumCostPrice||0))]),e._v(\"元 \"),r(\"div\",{staticClass:\"export-btn\"},[r(\"el-button\",{attrs:{type:\"primary\",size:\"small\"},on:{click:e.batchExport}},[e._v(\"批量导出\")])],1)])])],2)],1)},a=[],o=r(\"5530\"),i=(r(\"d3b7\"),r(\"25f0\"),r(\"159b\"),r(\"7db0\"),r(\"c740\"),r(\"a434\"),r(\"4de4\"),r(\"caad\"),r(\"2532\"),r(\"a15b\"),r(\"3ca3\"),r(\"ddb0\"),r(\"2b3d\"),r(\"b64b\"),r(\"2f62\")),c=r(\"9f27\"),s=r(\"d643\"),l={provideIngredients:s[\"D\"],ingredients:s[\"D\"]},u={30100:\"采购申请\",30200:\"退单申请\",40100:\"已发货\",40200:\"退单申请\",40110:\"已收货\"},d={name:\"OrderManagement\",components:{BTable:c[\"a\"]},props:{},data:function(){return{role:1,areaList:[],cityList:[],queryParams:{},districtList:[],schoolList:[],initFormData:{provinceCode:null,cityCode:null,districtCode:null,parentDeptId:null,deptId:null,confirmTime:[],arrivalTime:[],status:null,buyerName:null},tabsLabel:{provideIngredients:\"供应商\",ingredients:\"采购方\"},statisticsInfo:{contentNum:0,cleanVegetableWeight:0,originalVegetableWeight:0,costPrice:0,sellingPrice:0},statusObj:u,sumData:{},queryApi:l,pickerOptions:{disabledDate:function(e){return e.getTime()>Date.now()}},expands:[],isFirstInit:!0,selection:[],multipleSelection:[]}},computed:Object(o[\"a\"])(Object(o[\"a\"])({},Object(i[\"mapGetters\"])([\"roleType\"])),{},{headers:function(){var e=[{type:\"selection\",selectable:this.selectable},{label:\"订单编号\",prop:\"orderNo\",width:180},{label:\"下单日期\",prop:\"confirmTime\",width:100,colType:\"column\"},{label:\"到货日期\",prop:\"arrivalTime\",width:100,colType:\"column\"},{label:\"省份\",width:80,prop:\"provinceName\"},{label:\"地级市\",width:80,prop:\"cityName\"},{label:\"区/县\",width:80,prop:\"districtName\",\"show-overflow-tooltip\":!0},{label:\"学校\",minWidth:120,prop:\"parentDeptName\",\"show-overflow-tooltip\":!0},{label:\"学部\",minWidth:120,prop:\"deptName\",\"show-overflow-tooltip\":!0},{label:\"价格（元）\",prop:\"costPrice\",width:100},{label:\"采购人\",width:80,prop:\"creatorName\"},{label:\"性质\",prop:\"type\",width:60,colType:\"column\",slotName:\"type\"},{label:\"状态\",width:100,prop:\"status\",fixed:\"right\",colType:\"column\"},{label:\"操作\",colType:\"column\",slotName:\"operation\",fixed:\"right\",width:60}];return e},formItems:function(){var e=this,t=[{type:\"select\",prop:\"provinceCode\",valueKey:\"code\",labelKey:\"name\",options:this.areaList,attrs:{placeholder:\"省份\"}},{type:\"select\",prop:\"cityCode\",parentProp:\"provinceCode\",valueKey:\"code\",labelKey:\"name\",attrs:{placeholder:\"地级市\"},ajax:function(t){var r=e.getCityList(t.provinceCode);return e.$has([\"order-sale-manage-default-first\"])&&r&&r.length&&e.isFirstInit&&e.$refs.bTable.$refs.cDynamicForm.setModelData(\"cityCode\",r[0].code),new Promise((function(e){e(r)}))}},{type:\"select\",prop:\"districtCode\",parentProp:\"cityCode\",attrs:{placeholder:\"区/县\"},valueKey:\"code\",labelKey:\"name\",ajax:function(t){var r=e.getCountyList(t.cityCode);return e.$has([\"order-sale-manage-default-first\"])&&r&&r.length&&e.isFirstInit&&e.$refs.bTable.$refs.cDynamicForm.setModelData(\"districtCode\",r[0].code),new Promise((function(e){e(r)}))}},{type:\"select\",prop:\"parentDeptId\",parentProp:\"districtCode\",attrs:{placeholder:\"学校\"},valueKey:\"id\",labelKey:\"name\",ajax:function(t){var r=e.getSchoolList(t.districtCode);return e.$has([\"order-sale-manage-default-first\"])&&r&&r.length&&e.isFirstInit&&e.$refs.bTable.$refs.cDynamicForm.setModelData(\"parentDeptId\",r[0].id),new Promise((function(e){console.log(r),e(r)}))}},{type:\"select\",prop:\"deptId\",parentProp:\"parentDeptId\",attrs:{placeholder:\"学部\"},valueKey:\"id\",labelKey:\"name\",ajax:function(t){var r=e.getSchoolBranchList(t.parentDeptId);return e.$has([\"order-sale-manage-default-first\"])&&r&&r.length&&e.isFirstInit&&(e.isFirstInit=!1,e.$refs.bTable.$refs.cDynamicForm.setModelData(\"deptId\",r[0].id),e.$nextTick((function(){e.$refs.bTable&&e.$refs.bTable.ajaxGetTableDataByPage()}))),new Promise((function(e){e(r)}))}},{label:\"下单日期\",prop:\"confirmTime\",type:\"datePicker\",attrs:{type:\"daterange\",\"value-format\":\"yyyy-MM-dd\",\"range-separator\":\"至\",\"start-placeholder\":\"开始日期\",\"end-placeholder\":\"结束日期\",\"picker-options\":this.pickerOptions}},{label:\"到货日期\",prop:\"arrivalTime\",type:\"datePicker\",attrs:{type:\"daterange\",\"value-format\":\"yyyy-MM-dd\",\"range-separator\":\"至\",\"start-placeholder\":\"开始日期\",\"end-placeholder\":\"结束日期\"}},{label:\"状态\",prop:\"status\",type:\"select\",labelKey:\"key\",valueKey:\"value\",ajax:function(){return Object(s[\"g\"])({type:\"SUPPLIER_ORDER_STATUS\"}).then((function(e){return new Promise((function(t){return t(e.data)}))}))}},{type:\"input\",prop:\"buyerName\",attrs:{placeholder:\"采购人姓名、订单编号\"}}];return t}}),watch:{},methods:{baseTreeWithPowerSchool:function(){var e=this;return Object(s[\"c\"])().then((function(t){e.areaList=t.data||[],e.$has([\"order-sale-manage-default-first\"])&&e.areaList.length&&e.$refs.bTable.$refs.cDynamicForm.setModelData(\"provinceCode\",e.areaList[0].code)}))},fetchTableData:function(e){var t=this;return this.queryParams=Object.assign({},Object(o[\"a\"])({},e)),e.confirmTimeStart=e.confirmTime&&e.confirmTime[0]||\"\",e.confirmTimeEnd=e.confirmTime&&e.confirmTime[1]||\"\",e.arrivalTimeStart=e.arrivalTime&&e.arrivalTime[0]||\"\",e.arrivalTimeEnd=e.arrivalTime&&e.arrivalTime[1]||\"\",e.districtCode=e.districtCode||e.cityCode||e.provinceCode,e.status=e.status&&e.status.toString(),this.getSupplierOrderGlobal(e),Object(s[\"D\"])(e).then((function(e){return new Promise((function(r){e.data.records.forEach((function(e){\"-20100\"!=e.status&&\"40110\"!=e.status&&t.expands.push(e.orderId+\"\")})),r(e)}))}))},getSupplierOrderGlobal:function(e){var t=this;Object(s[\"o\"])(e).then((function(e){var r=e.data||{};t.sumData=r}))},getCityList:function(e){var t=[];return e?(t=this.areaList.find((function(t){return t.code===e})).childList,this.cityList=t,t):t},getCountyList:function(e){var t=[];return e?(t=this.cityList.find((function(t){return t.code===e})).childList,this.districtList=t,t):t},getSchoolList:function(e){var t=[];return e?(t=this.districtList.find((function(t){return t.code===e})).schoolList,this.schoolList=t,t):t},getSchoolBranchList:function(e){var t=[];return e?(t=this.schoolList.find((function(t){return t.id===e})).schoolBranchRespDtoList,t):t},onManagement:function(e){this.$router.push({path:\"/order/order-management-supplier\",query:{orderId:e.orderId,orderFlag:e.status,isParent:!e.parentId}})},getRowCustomName:function(e){var t=e.row;return t.parentId||0!=t.children.length?\"\":\"table-no-expand\"},setchildtobeselect:function(e,t){var r=this,n=this.$refs.bTable.$refs.table.$refs.table;t?e.forEach((function(e,t){var a=r.selection.findIndex((function(t){return t===e.orderId}));-1===a&&r.selection.push(e.orderId),r.$nextTick((function(){n.toggleRowSelection(e,!0)}))})):e.forEach((function(e,t){var a=r.selection.findIndex((function(t){return t===e.orderId}));r.selection.splice(a,1),r.$nextTick((function(){n.toggleRowSelection(e,!1)}))}))},toggleRowSelected:function(e,t){var r=this,n=this.$refs.bTable.$refs.table.$refs.table,a=this.selection.findIndex((function(t){return t===e.orderId}));if(t){if(-1===a)if(e.children.length>0)this.setchildtobeselect(e.children,!0);else{this.selection.push(e.orderId);var o=this.getParentNode(e.parentId),i=o.children,c=i.filter((function(e){return r.selection.includes(e.orderId)}));c.length===i.length&&n.toggleRowSelection(o,!0)}}else if(e.children.length>0)this.setchildtobeselect(e.children,!1);else{var s=this.getParentNode(e.parentId);n.toggleRowSelection(s,!1),this.selection.splice(a,1),console.log(3333,this.selection)}},getParentNode:function(e){var t=this.$refs.bTable.$refs.table.$refs.table,r=t.tableData,n=r.filter((function(t){return t.orderId===e}));return n.length>0?n[0]:null},handleSelect:function(e,t){var r=e.indexOf(t)>=0;this.toggleRowSelected(t,r)},handleSelectAll:function(e,t){var r=this,n=e.filter((function(e){return 0==e.parentId})),a=!!n.length;a||(n=t.tableData),n.forEach((function(e){return r.toggleRowSelected(e,a)}))},onChangeTableData:function(){this.selection=[]},batchExport:function(){var e=this;0!=this.selection.length?Object(s[\"C\"])({orderIds:this.selection.join(\",\")}).then((function(t){var r=new Blob([t],{type:\"application/vnd.ms-excel\"}),n=document.createElement(\"a\");n.href=URL.createObjectURL(r),n.setAttribute(\"download\",\"销售订单列表.xlsx\"),n.click(),n=null,e.$message.success(\"导出成功\")})):this.$message(\"请先选择需要导出的数据！\")}},created:function(){this.baseTreeWithPowerSchool()},activated:function(){var e=this,t=Object.keys(this.initFormData);t.forEach((function(t){e.$refs.bTable.$refs.cDynamicForm.setModelData(t,e.queryParams[t])})),this.$nextTick((function(){e.$refs.bTable&&e.$refs.bTable.ajaxGetTableDataByPage()}))},mounted:function(){}},p=d,f=(r(\"8bc2\"),r(\"2877\")),h=Object(f[\"a\"])(p,n,a,!1,null,\"a1aa3d8e\",null);t[\"default\"]=h.exports},\"8bc2\":function(e,t,r){\"use strict\";var n=r(\"dda5\"),a=r.n(n);a.a},d643:function(e,t,r){\"use strict\";r.d(t,\"c\",(function(){return a})),r.d(t,\"z\",(function(){return o})),r.d(t,\"a\",(function(){return i})),r.d(t,\"x\",(function(){return c})),r.d(t,\"f\",(function(){return s})),r.d(t,\"q\",(function(){return l})),r.d(t,\"r\",(function(){return u})),r.d(t,\"i\",(function(){return d})),r.d(t,\"s\",(function(){return p})),r.d(t,\"p\",(function(){return f})),r.d(t,\"e\",(function(){return h})),r.d(t,\"y\",(function(){return b})),r.d(t,\"A\",(function(){return m})),r.d(t,\"D\",(function(){return g})),r.d(t,\"B\",(function(){return y})),r.d(t,\"m\",(function(){return T})),r.d(t,\"n\",(function(){return v})),r.d(t,\"l\",(function(){return O})),r.d(t,\"o\",(function(){return w})),r.d(t,\"t\",(function(){return j})),r.d(t,\"v\",(function(){return D})),r.d(t,\"u\",(function(){return C})),r.d(t,\"w\",(function(){return I})),r.d(t,\"g\",(function(){return P})),r.d(t,\"h\",(function(){return S})),r.d(t,\"b\",(function(){return x})),r.d(t,\"d\",(function(){return E})),r.d(t,\"j\",(function(){return $})),r.d(t,\"k\",(function(){return L})),r.d(t,\"C\",(function(){return G}));var n=r(\"be3b\");function a(){return Object(n[\"b\"])({url:\"/provinceCityDistrict/baseTreeWithPowerSchool\",method:\"GET\",params:{}},\"cater\")}function o(){return Object(n[\"b\"])({url:\"/provinceCityDistrict/schoolTree\",method:\"GET\",params:{}},\"cater\")}function i(e){return Object(n[\"b\"])({url:\"/approve/order\",method:\"POST\",data:e},\"cater\")}function c(e){return Object(n[\"b\"])({url:\"/order/saveOrderAndContent\",method:\"POST\",data:e},\"cater\")}function s(e){return Object(n[\"b\"])({url:\"/order/deleteOrder/\".concat(e.orderId),method:\"POST\",data:{}},\"cater\")}function l(e){return Object(n[\"b\"])({url:\"/order/orderContentForSelect\",method:\"GET\",params:e},\"cater\")}function u(e){return Object(n[\"b\"])({url:\"/order/orderContentForSelectIngredient\",method:\"GET\",params:e},\"cater\")}function d(e){return Object(n[\"b\"])({url:\"/order/orderBase/\".concat(e.orderId),method:\"GET\",params:{}},\"cater\")}function p(e){return Object(n[\"b\"])({url:\"/order/orderStatistics\",method:\"GET\",params:e},\"cater\")}function f(e){return Object(n[\"b\"])({url:\"/order/orderContentForPage\",method:\"GET\",params:e},\"cater\")}function h(e){return Object(n[\"b\"])({url:\"/order/commonOrderContentForPage\",method:\"GET\",params:e},\"cater\")}function b(e){return Object(n[\"b\"])({url:\"/order/saveOrderBase\",method:\"POST\",data:e},\"cater\")}function m(e){return Object(n[\"b\"])({responseType:\"blob\",url:\"/export/supplierOrderContentExcel\",method:\"GET\",params:e},\"cater\")}function g(e){return Object(n[\"b\"])({url:\"/supplierOrder/supplierOrderPage\",method:\"GET\",params:e},\"cater\")}function y(e){return Object(n[\"b\"])({url:\"/supplierOrder/supplierOrderContentPage\",method:\"GET\",params:e},\"cater\")}function T(e){return Object(n[\"b\"])({url:\"/purchaseOrder/getPurchaseOrderList\",method:\"POST\",data:e},\"cater\")}function v(e){return Object(n[\"b\"])({url:\"/orderOperationRecord/getRecord\",method:\"GET\",params:e},\"cater\")}function O(e){return Object(n[\"b\"])({url:\"/purchaseOrder/getPurchaseOrderGlobal\",method:\"POST\",data:e},\"cater\")}function w(e){return Object(n[\"b\"])({url:\"/supplierOrder/supplierOrderGlobal\",method:\"GET\",params:e},\"cater\")}function j(e){return Object(n[\"b\"])({responseType:\"blob\",url:\"/purchaseOrder/purchaseExport\",method:\"POST\",data:e},\"cater\")}function D(e){return Object(n[\"b\"])({responseType:\"blob\",url:\"/export/purchaseOrderExcel\",method:\"GET\",params:e},\"cater\")}function C(e){return Object(n[\"b\"])({responseType:\"blob\",url:\"/export/purchaseOrderDetailExcel\",method:\"GET\",params:e},\"cater\")}function I(e){return Object(n[\"b\"])({responseType:\"blob\",url:\"/export/purchasePreviewExcel\",method:\"GET\",params:e},\"cater\")}function P(e){return Object(n[\"b\"])({url:\"/dictionary/getStatusInfo\",method:\"GET\",params:e},\"cater\")}function S(e){return Object(n[\"b\"])({url:\"/order/getOrderContentArrivalDateList\",method:\"GET\",params:e},\"cater\")}function x(e){return Object(n[\"b\"])({url:\"/approve/orderDetail\",method:\"POST\",data:e},\"cater\")}function E(e){return Object(n[\"b\"])({url:\"/approve/batchReceived\",method:\"POST\",data:e},\"cater\")}function $(e){return Object(n[\"b\"])({url:\"/orderContentDetail/getOrderDetailInfo\",method:\"GET\",params:e},\"cater\")}function L(e){return Object(n[\"b\"])({url:\"/order/getOrderIsWithdrawn\",method:\"GET\",params:e},\"cater\")}function G(e){return Object(n[\"b\"])({url:\"/export/supplierOrderListContentExcel\",method:\"GET\",responseType:\"blob\",params:e},\"cater\")}},dda5:function(e,t,r){}}]);","extractedComments":[]}