{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[\"chunk-8254407a\"],{\"72c9\":function(t,e,a){\"use strict\";a.r(e);var r=a(\"ade3\"),n=a(\"5530\"),i=(a(\"d3b7\"),a(\"99af\"),a(\"ac1f\"),a(\"5319\"),a(\"b0c0\"),a(\"7db0\"),a(\"159b\"),a(\"b680\"),a(\"b64b\"),a(\"d95c\")),o=a(\"dc9f\"),c=a(\"d643\"),s=a(\"6fac\"),d=a(\"d996\"),l=a(\"f9e7\"),u=a(\"638f\"),p=a(\"c292\"),m=a(\"6162\"),f=a(\"04cf\"),b=a(\"eaf5\"),h=a(\"6a3d\"),D=Object(i.a)(new Date((new Date).getTime()-864e5),4),g=Object(i.a)(new Date(new Date(D).getFullYear()+\"-\"+(new Date(D).getMonth()+1)+\"-01\"),4),y=[\"星期日\",\"星期一\",\"星期二\",\"星期三\",\"星期四\",\"星期五\",\"星期六\"],O={name:\"RecipeReportAdmin\",components:{MatericalTable:d.a,CatergoryTable:l.a,PerCapitaTable:u.a,TabName:p.a,PerCapitaImage:m.a,CatergoryImage:f.a,CDynamicForm:s.a,RecipeEvaluation:b.a},data:function(){return{orderId:null,orderInfo:{},formData:{provinceCode:\"\",cityCode:\"\",districtCode:\"\",parentDeptId:\"\",deptId:\"\",mealDate:[g,D]},areaList:[],cityList:[],districtList:[],schoolList:[],schoolBranchList:[],formAttrs:{inline:!0,size:\"small\"},initMealData:JSON.parse(JSON.stringify(h.b)),initCategoryData:JSON.parse(JSON.stringify(h.a)),initPerCapitaData:JSON.parse(JSON.stringify(h.c)),mealData:h.b,categoryData:h.a,perCapitaData:h.c,showType:\"table\",evaluationData:[],showMealTable:!1}},computed:{formItems:function(){var t=this;return[{type:\"select\",label:\"\",prop:\"provinceCode\",valueKey:\"code\",labelKey:\"name\",options:this.areaList,attrs:{placeholder:\"省份\",clearable:!1}},{type:\"select\",prop:\"cityCode\",parentProp:\"provinceCode\",valueKey:\"code\",labelKey:\"name\",attrs:{placeholder:\"地级市\",clearable:!1},ajax:function(e){var a=t.getCityList(e.provinceCode);return a&&a.length&&setTimeout((function(){t.$refs.cDynamicForm.setModelData(\"cityCode\",a[0].code)})),new Promise((function(t){t(a)}))}},{type:\"select\",prop:\"districtCode\",parentProp:\"cityCode\",attrs:{placeholder:\"区/县\",clearable:!1},valueKey:\"code\",labelKey:\"name\",ajax:function(e){var a=t.getCountyList(e.cityCode);return a&&a.length&&setTimeout((function(){t.$refs.cDynamicForm.setModelData(\"districtCode\",a[0].code)})),new Promise((function(t){t(a)}))}},{type:\"select\",prop:\"parentDeptId\",parentProp:\"districtCode\",attrs:{placeholder:\"学校\",clearable:!1},valueKey:\"id\",labelKey:\"name\",ajax:function(e){var a=t.getSchoolList(e.districtCode);return a&&a.length&&setTimeout((function(){t.$refs.cDynamicForm.setModelData(\"parentDeptId\",a[0].id)})),new Promise((function(t){t(a)}))}},{type:\"select\",prop:\"deptId\",parentProp:\"parentDeptId\",attrs:{placeholder:\"学部\",clearable:!1},valueKey:\"id\",labelKey:\"name\",ajax:function(e){var a=t.getSchoolBranchList(e.parentDeptId);return a&&a.length&&setTimeout((function(){t.$refs.cDynamicForm.setModelData(\"deptId\",a[0].id)})),new Promise((function(t){t(a)}))}},{type:\"date-picker\",prop:\"mealDate\",label:\"\",attrs:{placeholder:\"开始配送日期\",clearable:!1,type:\"daterange\",\"range-separator\":\"至\",\"value-format\":\"yyyy-MM-dd\",\"default-time\":[\"00:00:00\",\"00:00:00\"]}}]}},watch:{\"formData.mealDate\":{handler:function(t,e){this.getPageData()}},\"formData.deptId\":{handler:function(t,e){t&&this.getPageData()}}},created:function(){this.baseTreeWithPowerSchool()},methods:{onExport:function(){var t=this;Object(o.h)({deptId:this.formData.deptId,startDate:this.formData.mealDate[0],endDate:this.formData.mealDate[1]}).then((function(e){var a=t.formData,r=a.provinceCode,n=a.cityCode,i=a.districtCode,o=a.parentDeptId,c=a.deptId,s=a.mealDate,d=t.findNameBycode(r,t.areaList,\"code\"),l=t.findNameBycode(n,t.cityList,\"code\"),u=t.findNameBycode(i,t.districtList,\"code\"),p=t.findNameBycode(o,t.schoolList,\"id\"),m=t.findNameBycode(c,t.schoolBranchList,\"id\"),f=\"\".concat(s[0].replace(/-/g,\"\"),\"-\").concat(s[1].replace(/-/g,\"\")).concat(d).concat(l).concat(u).concat(p).concat(m,\"人均摄入营养报表\");t.$util.downLoadBlob(e,f)}))},findNameBycode:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2?arguments[2]:void 0;return e.find((function(e){return e[a]==t})).name},getPageData:function(){this.nutritionContentMealDate(),this.nutritionPerCapitaIntakeForTimeSlot(),this.categoryPerCapitaIntakeForTimeSlot()},toggleShowType:function(t){this.showType=t},baseTreeWithPowerSchool:function(){var t=this;return Object(c.c)().then((function(e){t.areaList=e.data||[],t.areaList.length&&t.$refs.cDynamicForm.setModelData(\"provinceCode\",t.areaList[0].code)}))},nutritionContentMealDate:function(){var t=this;Object(o.d)({deptId:this.formData.deptId,startDate:this.formData.mealDate[0],endDate:this.formData.mealDate[1]}).then((function(e){var a=e.data,r=a||[];t.orderInfo=a||{},t.mealData=t.handleMealList(r)}))},nutritionPerCapitaIntakeForTimeSlot:function(){var t=this;Object(o.f)({deptId:this.formData.deptId,startDate:this.formData.mealDate[0],endDate:this.formData.mealDate[1]}).then((function(e){var a=e.data,i=void 0===a?[]:a;t.evaluationData=i,t.perCapitaData=JSON.parse(JSON.stringify(t.initPerCapitaData)),i.forEach((function(e){t.perCapitaData.perCapitaHeader.push({label:e.nutrientName,prop:e.nutrientName,nutrientUnitName:e.nutrientStatisticalUnitName||e.nutrientUnitName}),t.perCapitaData.perCapitaTableData[1]=Object.assign(Object(n.a)({},t.perCapitaData.perCapitaTableData[1]),Object(r.a)({},e.nutrientName,1===e.nutrientStatisticalType?e.intakeValue:(100*e.intakeValue).toFixed(2)+\"%\")),t.perCapitaData.perCapitaTableData[0]=Object.assign({},Object(n.a)({},t.perCapitaData.perCapitaTableData[0]),Object(r.a)({},e.nutrientName,1===e.nutrientStatisticalType?e.referenceIntakeValue:100*e.lowerLimitValue+\"%-\"+100*e.upperLimitValue+\"%\")),t.perCapitaData.perCapitaTableData[2]=Object.assign({},Object(n.a)({},t.perCapitaData.perCapitaTableData[2]),Object(r.a)({},e.nutrientName,e.diffValue?(100*e.diffValue).toFixed(2)+\"%\":\"\")),t.perCapitaData.perCapitaTableData[3]=Object.assign({},Object(n.a)({},t.perCapitaData.perCapitaTableData[3]),Object(r.a)({},e.nutrientName,e.grade))}))}))},categoryPerCapitaIntakeForTimeSlot:function(){var t=this;Object(o.b)({deptId:this.formData.deptId,startDate:this.formData.mealDate[0],endDate:this.formData.mealDate[1]}).then((function(e){var a=e.data,i=void 0===a?[]:a;t.categoryData=JSON.parse(JSON.stringify(t.initCategoryData)),i.forEach((function(e){t.categoryData.categoryHeader.push({label:e.ingredientTypeName,prop:e.ingredientTypeName}),t.categoryData.categoryTableData[0]=Object.assign(Object(n.a)({},t.categoryData.categoryTableData[0]),Object(r.a)({},e.ingredientTypeName,e.referenceIntakeValue)),t.categoryData.categoryTableData[1]=Object.assign({},Object(n.a)({},t.categoryData.categoryTableData[1]),Object(r.a)({},e.ingredientTypeName,e.intakeValue))}))}))},handleMealList:function(t){for(var e={},a={},n={},i={},o=1,c=0;c<t.length;c++){var s=t[c],d=new Date(s.mealDate),l=y[d.getDay()],u=d.getDate(),p=d.getFullYear();s.weekStr=l,s.dayNum=u<10?\"0\"+u:u,c>0&&!this.isSameWeek(s.mealDate,t[c-1].mealDate)&&o++;var m=p+\"\"+o;e[m]||(e[m]=[],a[m]=[],n[m]=[{rowName:\"早餐\"},{rowName:\"午餐\"},{rowName:\"晚餐\"},{rowName:\"食材\"}],i[m]=!1),e[m].push(t[c]),a[m].push({dayNum:t[c].dayNum,weekStr:t[c].weekStr})}for(var f=Object.keys(e),b=0;b<f.length;b++)for(var h=0;h<e[f[b]].length;h++){for(var D=e[f[b]][h].mealTypeRespDtoList,g=0;g<4;g++){var O;n[f[b]][g]=Object.assign({},n[f[b]][g],(O={},Object(r.a)(O,a[f[b]][h].dayNum+\"dishesRespDtoList\",3===g?D[g].ingredientRespDtoList:D[g].dishesRespDtoList),Object(r.a)(O,a[f[b]][h].dayNum+\"ingredientRespDtoList\",D[g].ingredientRespDtoList),O))}D[3].ingredientRespDtoList.length&&(i[f[b]]=!0),i[f[b]]||delete n[f[b]][3]}return{mealObj:e,mealHeader:a,mealTableData:n,mealHasIngredient:i}},initData:function(){this.mealData=JSON.parse(JSON.stringify(this.initMealData)),this.perCapitaData=JSON.parse(JSON.stringify(this.initPerCapitaData)),this.mealData=JSON.parse(JSON.stringify(this.initMealData))},isSameWeek:function(t,e){var a=new Date(t),r=new Date(e),n=a.getDay(),i=new Date(\"\".concat(a.getFullYear(),\"/\").concat(a.getMonth()+1,\"/\").concat(a.getDate(),\" 00:00:00\")),o=new Date(i).getTime(),c=o-24*[6,0,1,2,3,4,5][n]*60*60*1e3,s=o+24*[1,7,6,5,4,3,2][n]*60*59*1e3;return r.getTime()>=c&&r.getTime()<=s},getCityList:function(t){var e=[];return t?(e=this.areaList.find((function(e){return e.code===t})).childList,this.cityList=e,e):e},getCountyList:function(t){var e=[];return t?(e=this.cityList.find((function(e){return e.code===t})).childList,this.districtList=e,e):e},getSchoolList:function(t){var e=[];return t?(e=this.districtList.find((function(e){return e.code===t})).schoolList,this.schoolList=e,e):e},getSchoolBranchList:function(t){var e=[];return t?(e=this.schoolList.find((function(e){return e.id===t})).schoolBranchRespDtoList,this.schoolBranchList=e,e):e}}},C=(a(\"aa51\"),a(\"2877\")),v=Object(C.a)(O,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a(\"div\",{staticClass:\"recipe-report-admin\"},[a(\"div\",{staticClass:\"title\"}),a(\"div\",{staticClass:\"form-select\"},[a(\"c-dynamic-form\",{ref:\"cDynamicForm\",attrs:{\"form-data\":t.formData,\"form-items\":t.formItems,\"form-attrs\":t.formAttrs},on:{\"change-model\":function(e){return t.formData=e}}},[a(\"el-form-item\",{attrs:{slot:\"form-after\"},slot:\"form-after\"},[a(\"el-button\",{attrs:{type:\"primary\"},on:{click:t.onExport}},[t._v(\"导出\")])],1)],1)],1),a(\"div\",{directives:[{name:\"show\",rawName:\"v-show\",value:\"table\"===t.showType,expression:\"showType === 'table'\"}],staticClass:\"table-item\"},[a(\"div\",{staticClass:\"catergory\"},[a(\"tab-name\",{attrs:{titleName:\"食物人均每日摄入量\"}}),a(\"span\",{staticClass:\"change-show-type\",on:{click:function(e){return t.toggleShowType(\"image\")}}},[t._v(\"图表查看\")])],1),a(\"div\",[a(\"catergory-table\",{attrs:{categoryData:t.categoryData}})],1)]),a(\"div\",{directives:[{name:\"show\",rawName:\"v-show\",value:\"table\"===t.showType,expression:\"showType === 'table'\"}],staticClass:\"table-item\"},[a(\"div\",{staticClass:\"catergory\"},[a(\"tab-name\",{attrs:{titleName:\"营养素人均每日摄入量\"}})],1),a(\"per-capita-table\",{attrs:{perCapitaData:t.perCapitaData}})],1),a(\"div\",{directives:[{name:\"show\",rawName:\"v-show\",value:\"image\"===t.showType,expression:\"showType === 'image'\"}],staticClass:\"image-show\"},[a(\"div\",{staticClass:\"table-item catergory-image\"},[a(\"div\",{staticClass:\"catergory\"},[a(\"tab-name\",{attrs:{titleName:\"食物人均每日摄入量\"}})],1),a(\"catergory-image\",{attrs:{categoryData:t.categoryData}})],1),a(\"div\",{staticClass:\"table-item per-capita-image\"},[a(\"div\",{staticClass:\"catergory\"},[a(\"tab-name\",{attrs:{titleName:\"营养素人均每日摄入量\"}}),a(\"span\",{staticClass:\"changeShowType\",on:{click:function(e){return t.toggleShowType(\"table\")}}},[t._v(\"表格查看\")])],1),a(\"per-capita-image\",{attrs:{perCapitaData:t.perCapitaData}})],1)]),a(\"div\",{staticClass:\"table-item\"},[a(\"div\",{staticClass:\"catergory\"},[a(\"tab-name\",{attrs:{titleName:\"食谱评价\"}})],1),a(\"recipe-evaluation\",{attrs:{list:t.evaluationData}})],1),a(\"div\",{staticClass:\"table-item\"},[a(\"div\",{staticClass:\"show-detail\",on:{click:function(e){t.showMealTable=!t.showMealTable}}},[t._v(\" 查看每日用餐详情 \")]),t.showMealTable?a(\"materical-table\",{attrs:{mealData:t.mealData}}):t._e()],1)])}),[],!1,null,\"3ad071b1\",null);e.default=v.exports},aa51:function(t,e,a){\"use strict\";var r=a(\"d575\");a.n(r).a},d575:function(t,e,a){},d643:function(t,e,a){\"use strict\";a.d(e,\"c\",(function(){return n})),a.d(e,\"z\",(function(){return i})),a.d(e,\"a\",(function(){return o})),a.d(e,\"x\",(function(){return c})),a.d(e,\"f\",(function(){return s})),a.d(e,\"q\",(function(){return d})),a.d(e,\"r\",(function(){return l})),a.d(e,\"i\",(function(){return u})),a.d(e,\"s\",(function(){return p})),a.d(e,\"p\",(function(){return m})),a.d(e,\"e\",(function(){return f})),a.d(e,\"y\",(function(){return b})),a.d(e,\"A\",(function(){return h})),a.d(e,\"D\",(function(){return D})),a.d(e,\"B\",(function(){return g})),a.d(e,\"m\",(function(){return y})),a.d(e,\"n\",(function(){return O})),a.d(e,\"l\",(function(){return C})),a.d(e,\"o\",(function(){return v})),a.d(e,\"t\",(function(){return T})),a.d(e,\"v\",(function(){return j})),a.d(e,\"u\",(function(){return w})),a.d(e,\"w\",(function(){return N})),a.d(e,\"g\",(function(){return S})),a.d(e,\"h\",(function(){return L})),a.d(e,\"b\",(function(){return I})),a.d(e,\"d\",(function(){return P})),a.d(e,\"j\",(function(){return E})),a.d(e,\"k\",(function(){return k})),a.d(e,\"C\",(function(){return x}));var r=a(\"be3b\");function n(){return Object(r.b)({url:\"/provinceCityDistrict/baseTreeWithPowerSchool\",method:\"GET\",params:{}},\"cater\")}function i(){return Object(r.b)({url:\"/provinceCityDistrict/schoolTree\",method:\"GET\",params:{}},\"cater\")}function o(t){return Object(r.b)({url:\"/approve/order\",method:\"POST\",data:t},\"cater\")}function c(t){return Object(r.b)({url:\"/order/saveOrderAndContent\",method:\"POST\",data:t},\"cater\")}function s(t){return Object(r.b)({url:\"/order/deleteOrder/\".concat(t.orderId),method:\"POST\",data:{}},\"cater\")}function d(t){return Object(r.b)({url:\"/order/orderContentForSelect\",method:\"GET\",params:t},\"cater\")}function l(t){return Object(r.b)({url:\"/order/orderContentForSelectIngredient\",method:\"GET\",params:t},\"cater\")}function u(t){return Object(r.b)({url:\"/order/orderBase/\".concat(t.orderId),method:\"GET\",params:{}},\"cater\")}function p(t){return Object(r.b)({url:\"/order/orderStatistics\",method:\"GET\",params:t},\"cater\")}function m(t){return Object(r.b)({url:\"/order/orderContentForPage\",method:\"GET\",params:t},\"cater\")}function f(t){return Object(r.b)({url:\"/order/commonOrderContentForPage\",method:\"GET\",params:t},\"cater\")}function b(t){return Object(r.b)({url:\"/order/saveOrderBase\",method:\"POST\",data:t},\"cater\")}function h(t){return Object(r.b)({responseType:\"blob\",url:\"/export/supplierOrderContentExcel\",method:\"GET\",params:t},\"cater\")}function D(t){return Object(r.b)({url:\"/supplierOrder/supplierOrderPage\",method:\"GET\",params:t},\"cater\")}function g(t){return Object(r.b)({url:\"/supplierOrder/supplierOrderContentPage\",method:\"GET\",params:t},\"cater\")}function y(t){return Object(r.b)({url:\"/purchaseOrder/getPurchaseOrderList\",method:\"POST\",data:t},\"cater\")}function O(t){return Object(r.b)({url:\"/orderOperationRecord/getRecord\",method:\"GET\",params:t},\"cater\")}function C(t){return Object(r.b)({url:\"/purchaseOrder/getPurchaseOrderGlobal\",method:\"POST\",data:t},\"cater\")}function v(t){return Object(r.b)({url:\"/supplierOrder/supplierOrderGlobal\",method:\"GET\",params:t},\"cater\")}function T(t){return Object(r.b)({responseType:\"blob\",url:\"/purchaseOrder/purchaseExport\",method:\"POST\",data:t},\"cater\")}function j(t){return Object(r.b)({responseType:\"blob\",url:\"/export/purchaseOrderExcel\",method:\"GET\",params:t},\"cater\")}function w(t){return Object(r.b)({responseType:\"blob\",url:\"/export/purchaseOrderDetailExcel\",method:\"GET\",params:t},\"cater\")}function N(t){return Object(r.b)({responseType:\"blob\",url:\"/export/purchasePreviewExcel\",method:\"GET\",params:t},\"cater\")}function S(t){return Object(r.b)({url:\"/dictionary/getStatusInfo\",method:\"GET\",params:t},\"cater\")}function L(t){return Object(r.b)({url:\"/order/getOrderContentArrivalDateList\",method:\"GET\",params:t},\"cater\")}function I(t){return Object(r.b)({url:\"/approve/orderDetail\",method:\"POST\",data:t},\"cater\")}function P(t){return Object(r.b)({url:\"/approve/batchReceived\",method:\"POST\",data:t},\"cater\")}function E(t){return Object(r.b)({url:\"/orderContentDetail/getOrderDetailInfo\",method:\"GET\",params:t},\"cater\")}function k(t){return Object(r.b)({url:\"/order/getOrderIsWithdrawn\",method:\"GET\",params:t},\"cater\")}function x(t){return Object(r.b)({url:\"/export/supplierOrderListContentExcel\",method:\"GET\",responseType:\"blob\",params:t},\"cater\")}}}]);","extractedComments":[]}