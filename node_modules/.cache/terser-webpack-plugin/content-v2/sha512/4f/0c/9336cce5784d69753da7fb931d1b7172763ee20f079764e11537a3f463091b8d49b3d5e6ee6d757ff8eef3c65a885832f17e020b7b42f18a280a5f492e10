{"code":"(window[\"webpackJsonp\"]=window[\"webpackJsonp\"]||[]).push([[\"catering-order-management-purchase\"],{\"0ccb\":function(e,t,r){var a=r(\"50c4\"),n=r(\"1148\"),o=r(\"1d80\"),i=Math.ceil,c=function(e){return function(t,r,c){var s,u,d=String(o(t)),l=d.length,p=void 0===c?\" \":String(c),f=a(r);return f<=l||\"\"==p?d:(s=f-l,u=n.call(p,i(s/p.length)),u.length>s&&(u=u.slice(0,s)),e?d+u:u+d)}};e.exports={start:c(!1),end:c(!0)}},1148:function(e,t,r){\"use strict\";var a=r(\"a691\"),n=r(\"1d80\");e.exports=\"\".repeat||function(e){var t=String(n(this)),r=\"\",o=a(e);if(o<0||o==1/0)throw RangeError(\"Wrong number of repetitions\");for(;o>0;(o>>>=1)&&(t+=t))1&o&&(r+=t);return r}},\"11f2\":function(e,t,r){},\"4d90\":function(e,t,r){\"use strict\";var a=r(\"23e7\"),n=r(\"0ccb\").start,o=r(\"9a0c\");a({target:\"String\",proto:!0,forced:o},{padStart:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}})},\"5e68\":function(e,t,r){\"use strict\";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r(\"div\",{staticClass:\"order-manage-purchase\"},[r(\"div\",{staticClass:\"order-manage-top clearfix\"},[e._v(\" 订单管理 \"),r(\"div\",{staticClass:\"order-manage-btn\"},[r(\"el-button\",{staticClass:\"order-btn-item\",attrs:{type:\"primary\",plain:\"\",disabled:e.disabledExport},on:{click:e.exportOrder}},[e._v(\" 导出 \")])],1)]),r(\"b-table\",{ref:\"bTable\",attrs:{loading:\"\",headers:e.headers,pageLimit:10,\"row-class-name\":e.getRowCustomName,\"highlight-current-row\":!1,initialFormData:e.initFormData,\"form-items\":e.formItems,\"show-column\":!1,showRefresh:!1,\"row-key\":\"orderId\",\"expand-row-keys\":e.expands,\"tree-props\":{children:\"children\",hasChildren:\"hasChildren\"},\"ajax-get-data\":e.fetchTableData},scopedSlots:e._u([{key:\"column|createTime\",fn:function(t){var r=t.row;return[e._v(\" \"+e._s(e.formateDate(r.createTime))+\" \")]}},{key:\"column|confirmTime\",fn:function(t){var r=t.row;return[e._v(\" \"+e._s(e.formateDate(r.confirmTime))+\" \")]}},{key:\"column|arrivalTime\",fn:function(t){var r=t.row;return[e._v(\" \"+e._s(e.formateDate(r.arrivalTime))+\" \")]}},{key:\"column|status\",fn:function(t){var r=t.row;return[e._v(\" \"+e._s(e.$D(\"BUYER_ORDER_STATUS\",\"\"+r.status))+\" \")]}},{key:\"column|type\",fn:function(t){var a=t.row;return r(\"div\",{class:2===a.type?\"type red\":3===a.type?\"type yellow\":\"type\"},[e._v(\" \"+e._s(1===a.type?\"常规\":2===a.type?\"紧急\":\"补单\")+\" \")])}},{key:\"column|outOfStock\",fn:function(t){var r=t.row;return[e._v(\" \"+e._s(r.outOfStock?\"缺货\":\"有货\")+\" \")]}},{key:\"column|operation\",fn:function(t){var a=t.row;return r(\"div\",{staticClass:\"operation\"},[a.parentId||\"10100\"==a.status||\"20100\"==a.status||\"-10200\"==a.status||\"-20100\"==a.status?r(\"span\",{on:{click:function(t){return e.manageOrder(a)}}},[e._v(\"管理\")]):r(\"span\",{on:{click:function(t){return e.manageOrder(a)}}},[e._v(\"查看\")])])}}])},[r(\"template\",{slot:\"table-before\"},[r(\"div\",{staticClass:\"tab-total-wrapper\"},[e._v(\" 成本参考价\"),r(\"span\",{staticClass:\"tab-pane-num\"},[e._v(e._s(e.sumData.sumCostPrice||0))]),e._v(\"元 \")]),r(\"div\",{staticClass:\"tab-btn-wrapper\"},[e._v(\" 排序： \"),r(\"span\",{staticClass:\"tab-btn\",class:e.isOrdered?\"active\":\"\",on:{click:e.descendingOrder}},[e._v(\"到货日期 \"),r(\"i\",{staticClass:\"el-icon-bottom\"})])])])],2)],1)},n=[],o=r(\"5530\"),i=(r(\"d3b7\"),r(\"b64b\"),r(\"159b\"),r(\"25f0\"),r(\"7db0\"),r(\"4d90\"),r(\"9f27\")),c=r(\"d643\"),s={10100:\"草稿\",20100:\"待审批\",30100:\"已审批未收货\",30200:\"退单申请中\",40100:\"已审批未收货\",40200:\"退单申请中\",40110:\"已收货\",\"-10200\":\"审批未通过\",\"-20100\":\"已退单\"},u={name:\"OrderManagePurchase\",components:{BTable:i[\"a\"]},data:function(){return{areaList:[],cityList:[],districtList:[],schoolList:[],queryParams:{},initFormData:{provinceCode:null,cityCode:null,districtCode:null,parentDeptId:null,deptId:null,careateDate:[],orderDate:[],arrivalTime:null,status:null,creatorAndAuditName:null},formParams:{},disabledExport:!0,statusObj:s,sumData:{},headers:[{label:\"订单编号\",prop:\"orderNo\",width:200},{label:\"下单日期\",prop:\"confirmTime\",colType:\"column\",width:100},{label:\"到货日期\",prop:\"arrivalTime\",colType:\"column\",width:100},{label:\"学校\",prop:\"parentDeptName\",minWidth:120,\"show-overflow-tooltip\":!0},{label:\"学部\",prop:\"deptName\",minWidth:120,\"show-overflow-tooltip\":!0},{label:\"成本参考价（元）\",prop:\"costPrice\",width:120},{label:\"采购人\",width:80,prop:\"creatorName\"},{label:\"审批人\",width:80,prop:\"auditName\"},{label:\"性质\",width:60,prop:\"type\",colType:\"column\"},{label:\"状态\",width:100,prop:\"status\",colType:\"column\",fixed:\"right\"},{label:\"操作\",colType:\"column\",slotName:\"operation\",fixed:\"right\",width:\"60px\"}],pickerOptions:{},expands:[],orderOptions:[{value:\"\",label:\"默认排序\"},{value:\"asc\",label:\"到货时间升序\"},{value:\"desc\",label:\"到货时间降序\"}],sortModel:\"\",isOrdered:!1}},computed:{formItems:function(){var e=this,t=[{type:\"select\",prop:\"provinceCode\",valueKey:\"code\",labelKey:\"name\",options:this.areaList,attrs:{placeholder:\"省份\"}},{type:\"select\",prop:\"cityCode\",parentProp:\"provinceCode\",valueKey:\"code\",labelKey:\"name\",attrs:{placeholder:\"地级市\"},ajax:function(t){var r=e.getCityList(t.provinceCode);return e.$has([\"order-purchase-manage-default-first\"])&&r&&r.length&&e.$refs.bTable.$refs.cDynamicForm.setModelData(\"cityCode\",r[0].code),new Promise((function(e){e(r)}))}},{type:\"select\",prop:\"districtCode\",parentProp:\"cityCode\",attrs:{placeholder:\"区/县\"},valueKey:\"code\",labelKey:\"name\",ajax:function(t){var r=e.getCountyList(t.cityCode);return e.$has([\"order-purchase-manage-default-first\"])&&r&&r.length&&e.$refs.bTable.$refs.cDynamicForm.setModelData(\"districtCode\",r[0].code),new Promise((function(e){e(r)}))}},{type:\"select\",prop:\"parentDeptId\",parentProp:\"districtCode\",attrs:{placeholder:\"学校\"},valueKey:\"id\",labelKey:\"name\",ajax:function(t){var r=e.getSchoolList(t.districtCode);return e.$has([\"order-purchase-manage-default-first\"])&&r&&r.length&&e.$refs.bTable.$refs.cDynamicForm.setModelData(\"parentDeptId\",r[0].id),new Promise((function(e){e(r)}))}},{type:\"select\",prop:\"deptId\",parentProp:\"parentDeptId\",attrs:{placeholder:\"学部\"},valueKey:\"id\",labelKey:\"name\",ajax:function(t){var r=e.getSchoolBranchList(t.parentDeptId);return e.$has([\"order-purchase-manage-default-first\"])&&r&&r.length&&(e.$refs.bTable.$refs.cDynamicForm.setModelData(\"deptId\",r[0].id),e.$nextTick((function(){e.$refs.bTable&&e.$refs.bTable.ajaxGetTableDataByPage()}))),new Promise((function(e){e(r)}))}},{type:\"date-picker\",prop:\"careateDate\",label:\"创建日期\",attrs:{\"start-placeholder\":\"开始日期\",\"range-separator\":\"-\",\"end-placeholder\":\"结束日期\",type:\"daterange\",\"value-format\":\"yyyy-MM-dd\",\"picker-options\":this.pickerOptions}},{type:\"date-picker\",prop:\"orderDate\",label:\"下单日期\",attrs:{\"start-placeholder\":\"开始日期\",\"end-placeholder\":\"结束日期\",\"range-separator\":\"-\",type:\"daterange\",\"value-format\":\"yyyy-MM-dd\",\"picker-options\":this.pickerOptions}},{type:\"date-picker\",prop:\"arrivalTime\",label:\"到货日期\",attrs:{placeholder:\"到货日期\",\"value-format\":\"yyyy-MM-dd\"}},{type:\"select\",prop:\"status\",label:\"订单状态\",labelKey:\"key\",valueKey:\"value\",attrs:{placeholder:\"订单状态\"},ajax:function(){return Object(c[\"g\"])({type:\"BUYER_ORDER_STATUS\"}).then((function(e){return new Promise((function(t){return t(e.data)}))}))}},{type:\"input\",prop:\"creatorAndAuditName\",attrs:{placeholder:\"采购人、审批人姓名、订单编号\"}}];return t}},created:function(){this.baseTreeWithPowerSchool()},activated:function(){var e=this,t=Object.keys(this.initFormData);console.log(this.queryParams),t.forEach((function(t){e.$refs.bTable.$refs.cDynamicForm.setModelData(t,e.queryParams[t])})),this.$nextTick((function(){e.$refs.bTable&&e.$refs.bTable.ajaxGetTableDataByPage()}))},methods:{baseTreeWithPowerSchool:function(){var e=this;return Object(c[\"c\"])().then((function(t){e.areaList=t.data||[],e.$has([\"order-purchase-manage-default-first\"])&&e.areaList.length&&e.$refs.bTable.$refs.cDynamicForm.setModelData(\"provinceCode\",e.areaList[0].code)}))},fetchTableData:function(e){var t=this;this.queryParams=Object.assign({},Object(o[\"a\"])({},e));var r=e.orderDate,a=e.careateDate,n=e.status,i=Object.assign({},e,{createStartDate:a&&a[0],createEndDate:a&&a[1],orderStartDate:r&&r[0],orderEndDate:r&&r[1],status:n&&n.toString()});return delete i.orderDate,delete i.careateDate,this.isOrdered?this.formParams=Object(o[\"a\"])(Object(o[\"a\"])({},i),{},{sortColumn:\"arrivalTime\"}):(this.formParams=i,delete this.formParams.sortColumn),this.getPurchaseOrderGlobal(this.formParams),this.expands=[],Object(c[\"m\"])(this.formParams).then((function(e){var r=e.data&&e.data.total||0;return t.disabledExport=!r,new Promise((function(r){e.data.records.forEach((function(e){\"-20100\"!=e.status&&\"40110\"!=e.status&&t.expands.push(String(e.orderId))})),r(e)}))})).catch((function(e){t.disabledExport=!0}))},getCityList:function(e){var t=[];return e?(t=this.areaList.find((function(t){return t.code===e})).childList,this.cityList=t,t):t},getCountyList:function(e){var t=[];return e?(t=this.cityList.find((function(t){return t.code===e})).childList,this.districtList=t,t):t},getSchoolList:function(e){var t=[];return e?(t=this.districtList.find((function(t){return t.code===e})).schoolList,this.schoolList=t,t):t},getSchoolBranchList:function(e){var t=[];return e?(t=this.schoolList.find((function(t){return t.id===e})).schoolBranchRespDtoList,t):t},getRowCustomName:function(e){var t=e.row;return t.parentId||0!=t.children.length?\"\":\"table-no-expand\"},getPurchaseOrderGlobal:function(e){var t=this;Object(c[\"l\"])(e).then((function(e){var r=e.data||{};t.sumData=r}))},manageOrder:function(e){this.$router.push({path:\"/order/order-opera-purchase\",query:{operaType:\"orderManage\",orderFlag:e.status,orderId:e.orderId,isParent:!e.parentId}})},exportOrder:function(){var e=this,t=this.formParams;delete t.limit,delete t.offset,delete t.pageNum,delete t.pageSize,Object(c[\"t\"])(t).then((function(t){e.$util.downLoadBlob(t,\"采购订单汇总导出_\".concat(e.formateDate(Date.now(),3)))}))},formateDate:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4;if(!e)return\"-\";var r=new Date(e),a=r.getFullYear(),n=(r.getMonth()+1).toString().padStart(2,\"0\"),o=r.getDate().toString().padStart(2,\"0\"),i=r.getHours().toString().padStart(2,\"0\"),c=r.getMinutes().toString().padStart(2,\"0\"),s=r.getSeconds().toString().padStart(2,\"0\");return 1==t?a+\"年\"+n+\"月\"+o+\"日\":2==t?a+\"-\"+n+\"-\"+o+\" \"+i+\":\"+c+\":\"+s:3==t?a+\"_\"+n+\"_\"+o+\"_\"+i+\"_\"+c+\"_\"+s:4==t?a+\"-\"+n+\"-\"+o:void 0},changeSortModel:function(e){var t={sortModel:e,sortColumn:e?\"arrivalTime\":\"\"};this.fetchTableData(Object.assign(this.formParams,t))},descendingOrder:function(){this.isOrdered=!this.isOrdered,this.$refs.bTable.onRefreshTable()}}},d=u,l=(r(\"bc1c\"),r(\"2877\")),p=Object(l[\"a\"])(d,a,n,!1,null,\"41c3d0f2\",null);t[\"default\"]=p.exports},\"9a0c\":function(e,t,r){var a=r(\"342f\");e.exports=/Version\\/10\\.\\d+(\\.\\d+)?( Mobile\\/\\w+)? Safari\\//.test(a)},bc1c:function(e,t,r){\"use strict\";var a=r(\"11f2\"),n=r.n(a);n.a},d643:function(e,t,r){\"use strict\";r.d(t,\"c\",(function(){return n})),r.d(t,\"z\",(function(){return o})),r.d(t,\"a\",(function(){return i})),r.d(t,\"x\",(function(){return c})),r.d(t,\"f\",(function(){return s})),r.d(t,\"q\",(function(){return u})),r.d(t,\"r\",(function(){return d})),r.d(t,\"i\",(function(){return l})),r.d(t,\"s\",(function(){return p})),r.d(t,\"p\",(function(){return f})),r.d(t,\"e\",(function(){return h})),r.d(t,\"y\",(function(){return m})),r.d(t,\"A\",(function(){return b})),r.d(t,\"D\",(function(){return v})),r.d(t,\"B\",(function(){return y})),r.d(t,\"m\",(function(){return O})),r.d(t,\"n\",(function(){return g})),r.d(t,\"l\",(function(){return T})),r.d(t,\"o\",(function(){return D})),r.d(t,\"t\",(function(){return w})),r.d(t,\"v\",(function(){return j})),r.d(t,\"u\",(function(){return C})),r.d(t,\"w\",(function(){return S})),r.d(t,\"g\",(function(){return P})),r.d(t,\"h\",(function(){return x})),r.d(t,\"b\",(function(){return E})),r.d(t,\"d\",(function(){return _})),r.d(t,\"j\",(function(){return L})),r.d(t,\"k\",(function(){return k})),r.d(t,\"C\",(function(){return $}));var a=r(\"be3b\");function n(){return Object(a[\"b\"])({url:\"/provinceCityDistrict/baseTreeWithPowerSchool\",method:\"GET\",params:{}},\"cater\")}function o(){return Object(a[\"b\"])({url:\"/provinceCityDistrict/schoolTree\",method:\"GET\",params:{}},\"cater\")}function i(e){return Object(a[\"b\"])({url:\"/approve/order\",method:\"POST\",data:e},\"cater\")}function c(e){return Object(a[\"b\"])({url:\"/order/saveOrderAndContent\",method:\"POST\",data:e},\"cater\")}function s(e){return Object(a[\"b\"])({url:\"/order/deleteOrder/\".concat(e.orderId),method:\"POST\",data:{}},\"cater\")}function u(e){return Object(a[\"b\"])({url:\"/order/orderContentForSelect\",method:\"GET\",params:e},\"cater\")}function d(e){return Object(a[\"b\"])({url:\"/order/orderContentForSelectIngredient\",method:\"GET\",params:e},\"cater\")}function l(e){return Object(a[\"b\"])({url:\"/order/orderBase/\".concat(e.orderId),method:\"GET\",params:{}},\"cater\")}function p(e){return Object(a[\"b\"])({url:\"/order/orderStatistics\",method:\"GET\",params:e},\"cater\")}function f(e){return Object(a[\"b\"])({url:\"/order/orderContentForPage\",method:\"GET\",params:e},\"cater\")}function h(e){return Object(a[\"b\"])({url:\"/order/commonOrderContentForPage\",method:\"GET\",params:e},\"cater\")}function m(e){return Object(a[\"b\"])({url:\"/order/saveOrderBase\",method:\"POST\",data:e},\"cater\")}function b(e){return Object(a[\"b\"])({responseType:\"blob\",url:\"/export/supplierOrderContentExcel\",method:\"GET\",params:e},\"cater\")}function v(e){return Object(a[\"b\"])({url:\"/supplierOrder/supplierOrderPage\",method:\"GET\",params:e},\"cater\")}function y(e){return Object(a[\"b\"])({url:\"/supplierOrder/supplierOrderContentPage\",method:\"GET\",params:e},\"cater\")}function O(e){return Object(a[\"b\"])({url:\"/purchaseOrder/getPurchaseOrderList\",method:\"POST\",data:e},\"cater\")}function g(e){return Object(a[\"b\"])({url:\"/orderOperationRecord/getRecord\",method:\"GET\",params:e},\"cater\")}function T(e){return Object(a[\"b\"])({url:\"/purchaseOrder/getPurchaseOrderGlobal\",method:\"POST\",data:e},\"cater\")}function D(e){return Object(a[\"b\"])({url:\"/supplierOrder/supplierOrderGlobal\",method:\"GET\",params:e},\"cater\")}function w(e){return Object(a[\"b\"])({responseType:\"blob\",url:\"/purchaseOrder/purchaseExport\",method:\"POST\",data:e},\"cater\")}function j(e){return Object(a[\"b\"])({responseType:\"blob\",url:\"/export/purchaseOrderExcel\",method:\"GET\",params:e},\"cater\")}function C(e){return Object(a[\"b\"])({responseType:\"blob\",url:\"/export/purchaseOrderDetailExcel\",method:\"GET\",params:e},\"cater\")}function S(e){return Object(a[\"b\"])({responseType:\"blob\",url:\"/export/purchasePreviewExcel\",method:\"GET\",params:e},\"cater\")}function P(e){return Object(a[\"b\"])({url:\"/dictionary/getStatusInfo\",method:\"GET\",params:e},\"cater\")}function x(e){return Object(a[\"b\"])({url:\"/order/getOrderContentArrivalDateList\",method:\"GET\",params:e},\"cater\")}function E(e){return Object(a[\"b\"])({url:\"/approve/orderDetail\",method:\"POST\",data:e},\"cater\")}function _(e){return Object(a[\"b\"])({url:\"/approve/batchReceived\",method:\"POST\",data:e},\"cater\")}function L(e){return Object(a[\"b\"])({url:\"/orderContentDetail/getOrderDetailInfo\",method:\"GET\",params:e},\"cater\")}function k(e){return Object(a[\"b\"])({url:\"/order/getOrderIsWithdrawn\",method:\"GET\",params:e},\"cater\")}function $(e){return Object(a[\"b\"])({url:\"/export/supplierOrderListContentExcel\",method:\"GET\",responseType:\"blob\",params:e},\"cater\")}}}]);","extractedComments":[]}