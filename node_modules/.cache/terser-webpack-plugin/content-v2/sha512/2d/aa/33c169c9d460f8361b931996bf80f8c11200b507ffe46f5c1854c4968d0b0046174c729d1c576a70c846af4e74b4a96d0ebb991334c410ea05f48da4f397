{"code":"(window[\"webpackJsonp\"]=window[\"webpackJsonp\"]||[]).push([[\"catering-order-management-supplier\"],{\"0ccb\":function(e,t,r){var a=r(\"50c4\"),n=r(\"1148\"),o=r(\"1d80\"),i=Math.ceil,c=function(e){return function(t,r,c){var s,u,d=String(o(t)),l=d.length,p=void 0===c?\" \":String(c),f=a(r);return f<=l||\"\"==p?d:(s=f-l,u=n.call(p,i(s/p.length)),u.length>s&&(u=u.slice(0,s)),e?d+u:u+d)}};e.exports={start:c(!1),end:c(!0)}},1148:function(e,t,r){\"use strict\";var a=r(\"a691\"),n=r(\"1d80\");e.exports=\"\".repeat||function(e){var t=String(n(this)),r=\"\",o=a(e);if(o<0||o==1/0)throw RangeError(\"Wrong number of repetitions\");for(;o>0;(o>>>=1)&&(t+=t))1&o&&(r+=t);return r}},\"2ae9\":function(e,t,r){},\"4d90\":function(e,t,r){\"use strict\";var a=r(\"23e7\"),n=r(\"0ccb\").start,o=r(\"9a0c\");a({target:\"String\",proto:!0,forced:o},{padStart:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}})},\"5bfa\":function(e,t,r){\"use strict\";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r(\"div\",{staticClass:\"preview-wrapper\"},[r(\"div\",{staticClass:\"preview-header\"},[r(\"div\",{staticClass:\"preview-header-left\"},[r(\"div\",[r(\"span\",{staticStyle:{\"margin-left\":\"-7px\"}},[e._v(\"【\"+e._s(e.orderFormInfo.orderNo)+\"】\")]),e._v(\"【\"+e._s(e.getOrderStatus(e.orderFormInfo.type))+\"】\"+e._s(e.orderFormInfo.provinceName)+e._s(e.orderFormInfo.cityName)+e._s(e.orderFormInfo.districtName)+e._s(e.orderFormInfo.parentDeptName)+e._s(e.orderFormInfo.deptName)+\"的订单 \")]),r(\"div\",[e.isParent?r(\"span\",{staticClass:\"preview-date\"},[e._v(\"创建日期：\"+e._s(e.formateDate(e.orderFormInfo.createTime)))]):e._e(),r(\"span\",{staticClass:\"preview-date\"},[e._v(\"下单日期：\"+e._s(e.formateDate(e.orderFormInfo.confirmTime)))]),e.isParent?e._e():r(\"span\",{staticClass:\"preview-date\"},[e._v(\"到货日期：\"+e._s(e.formateDate(e.orderFormInfo.arrivalTime)))]),r(\"span\",{staticClass:\"preview-date\"},[e._v(\"采购人：\"+e._s(e.orderFormInfo.creatorName||\"-\"))])])]),r(\"div\",{staticClass:\"preview-header-right\"},[r(\"div\",[\"40200\"==e.orderFlag?r(\"el-button\",{on:{click:function(t){return e.handleOrder(\"-20100\")}}},[e._v(\"确认退单\")]):e._e(),r(\"el-button\",{attrs:{type:\"primary\",plain:\"\",disabled:!e.orderFormInfo.contentNum},on:{click:e.exportOrder}},[e._v(\"导出\")])],1)])]),r(\"div\",{staticClass:\"preview-bottom\"},[r(\"div\",[e.isParent?r(\"div\",[r(\"div\",{staticClass:\"tab-total-wrapper\"},[e._v(\" 净菜重量：\"),r(\"span\",{staticClass:\"tab-pane-num\"},[e._v(e._s(e.statisticsInfo.cleanVegetableWeight))]),e._v(\" kg；毛菜重量：\"),r(\"span\",{staticClass:\"tab-pane-num\"},[e._v(e._s(e.statisticsInfo.originalVegetableWeight))]),e._v(\" kg；价格：\"),r(\"span\",{staticClass:\"tab-pane-num\"},[e._v(e._s(e.statisticsInfo.costPrice))]),e._v(\" 元 \")]),r(\"el-tabs\",{attrs:{type:\"border-card\"},on:{\"tab-click\":e.handleTabClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:\"activeName\"}},e._l(e.tabs,(function(t){return r(\"el-tab-pane\",{key:t.name,attrs:{label:t.label,name:t.name}},[t.name==e.activeName?[r(\"b-table\",{ref:\"bTable\",refInFor:!0,attrs:{loading:\"\",headers:e.headers,\"row-class-name\":e.getRowCustomName,\"highlight-current-row\":!1,pageLimit:10,\"show-column\":!1,showRefresh:!1,\"ajax-get-data\":e.fetchTableData},scopedSlots:e._u([{key:\"column|cutStandard\",fn:function(t){var r=t.row;return[e._v(\" \"+e._s(r.cutMatchStandardName)+e._s(e._f(\"formatCutMatchStandard\")(r))+\" \")]}},{key:\"column|packNum\",fn:function(t){var r=t.row;return[e._v(\" \"+e._s(r.packNum)+e._s(r.packUnit)+\" \")]}},{key:\"column|arrivalDate\",fn:function(t){var r=t.row;return[e._v(\" \"+e._s(e.formateDate(r.arrivalDate,4)+\" \"+(r.arrivalTime||\"\"))+\" \")]}},{key:\"column|receiveStatus\",fn:function(t){var r=t.row;return[e._v(\" \"+e._s(e.$D(\"SUPPLIER_ORDER_DETAIL_STATUS\",\"\"+r.status))+\" \")]}}],null,!0)})]:e._e()],2)})),1)],1):r(\"div\",[r(\"el-button\",{staticClass:\"deliver-btn\",attrs:{type:\"primary\",size:\"small\",disabled:e.isOperationDisabled()},on:{click:function(t){return e.batchDeliverGoods(\"2020100\")}}},[e._v(\"批量发货\")]),r(\"b-table\",{ref:\"bTable\",attrs:{loading:\"\",headers:e.headers,\"row-class-name\":e.getRowCustomName,\"highlight-current-row\":!1,\"form-items\":e.formItems,pageLimit:10,\"show-column\":!1,showRefresh:!1,\"ajax-get-data\":e.fetchTableData},scopedSlots:e._u([{key:\"column|cutStandard\",fn:function(t){var r=t.row;return[e._v(\" \"+e._s(r.cutMatchStandardName)+e._s(e._f(\"formatCutMatchStandard\")(r))+\" \")]}},{key:\"column|packNum\",fn:function(t){var r=t.row;return[e._v(\" \"+e._s(r.packNum)+e._s(r.packUnit)+\" \")]}},{key:\"column|arrivalDate\",fn:function(t){var r=t.row;return[e._v(\" \"+e._s(e.formateDate(r.arrivalDate,4)+\" \"+(r.arrivalTime||\"\"))+\" \")]}},{key:\"column|receiveStatus\",fn:function(t){var r=t.row;return[e._v(\" \"+e._s(e.$D(\"SUPPLIER_ORDER_DETAIL_STATUS\",\"\"+r.status))+\" \")]}},{key:\"column|operation\",fn:function(t){var a=t.row;return r(\"div\",{staticClass:\"operation\"},[\"2010000\"==a.status?r(\"span\",{staticClass:\"active\",class:e.isOperationDisabled()?\"disabled\":\"\",on:{click:function(t){return e.deliverGoods(\"2020100\",a)}}},[e._v(\"发货\")]):r(\"span\",[e._v(\"--\")])])}}])})],1)]),r(\"div\",{staticClass:\"history\"},[r(\"p\",{staticClass:\"history-title\"},[e._v(\"历史记录:\")]),r(\"div\",[r(\"c-table\",e._g(e._b({ref:\"historyTable\",attrs:{size:\"small\",\"empty-text\":\"历史记录暂无数据\",\"highlight-current-row\":!1,data:e.historyTableData,headers:e.histortyHeaders,\"show-header\":!1,border:!0},scopedSlots:e._u([{key:\"column|operaName\",fn:function(t){var r=t.row;return[e._v(\" 操作人： \"+e._s(r.creatorName)+\" \")]}},{key:\"column|operaRecord\",fn:function(t){var a=t.row;return[r(\"div\",[e._v(e._s(a.remarks))]),r(\"div\",[e._v(\"接收人：\"+e._s(a.receiverName))])]}},{key:\"column|operaStatus\",fn:function(t){var a=t.row;return[r(\"div\",[e._v(e._s(e.formateDate(a.createTime,2)))]),r(\"div\",[e._v(\" [\"+e._s(a.operationName)+\"] \")])]}}])},\"c-table\",e.$props,!1),e.$listeners))],1)])])])},n=[],o=(r(\"99af\"),r(\"d3b7\"),r(\"3ca3\"),r(\"ddb0\"),r(\"d81d\"),r(\"b0c0\"),r(\"4d90\"),r(\"25f0\"),r(\"ac1f\"),r(\"1276\"),r(\"a9e3\"),r(\"159b\"),r(\"d643\")),i=r(\"9f27\"),c=r(\"05f4\"),s={10100:\"草稿\",20100:\"待审批\",30100:\"下单\",30200:\"退回\",40100:\"已发货\",40200:\"退回\",40110:\"已收货\",\"-10200\":\"审批未通过\",\"-20100\":\"已退单\"},u={\"-20100\":\"退单\",40100:\"确认发货\"},d={\"-1\":\"撤回\",20100:\"提交审批\",30100:\"下单\",30200:\"退回\",40100:\"已发货\",40200:\"退回\",40110:\"已收货\",\"-20100\":\"已退单\",\"-10200\":\"\\t审批不通过\"},l={contentNum:\"0.0\",cleanVegetableWeight:\"0.0\",originalVegetableWeight:\"0.0\",costPrice:\"0.0\",sellingPrice:\"0.0\"},p={name:\"OrderManageSupplier\",components:{BTable:i[\"a\"],CTable:c[\"a\"]},data:function(){return{statisticsInfo:l,initStatisticsInfo:l,sumData:{},orderFlag:null,statusObj:s,operaCode:u,historyCode:d,historyTableData:[],histortyHeaders:[{label:\"操作人\",prop:\"operaName\",colType:\"column\"},{label:\"操作记录\",prop:\"operaRecord\",colType:\"column\"},{label:\"操作状态\",prop:\"operaStatus\",colType:\"column\",\"show-overflow-tooltip\":!0}],orderFormInfo:{},orderId:null,orderRemark:\"\",operaType:\"preview\",queryObject:{ingredients:1,dish:2,menu:3},mealTypeList:[{label:\"早餐\",value:1},{label:\"午餐\",value:2},{label:\"晚餐\",value:3}],isParent:!0,tabs:[],activeName:\"\",params:{}}},computed:{headers:function(){var e=[{label:\"简拼\",prop:\"pinyinHeader\",\"show-overflow-tooltip\":!0},{label:\"名称\",prop:\"relationName\",minWidth:120,\"show-overflow-tooltip\":!0},{label:\"净菜重量（kg）\",prop:\"cleanVegetableWeight\",width:120},{label:\"毛菜重量（kg）\",prop:\"originalVegetableWeight\",width:120},{label:\"数量\",colType:\"column\",slotName:\"packNum\",width:120},{label:\"总重量（kg）\",prop:\"quantity\",width:120},{label:\"价格（元）\",prop:\"costPrice\",width:120},{label:\"到货时间\",prop:\"arrivalDate\",colType:\"column\",width:140}];return this.isParent?[].concat(e):[{type:\"selection\",selectable:this.selectable}].concat(e,[{label:\"状态\",colType:\"column\",slotName:\"receiveStatus\",width:100},{label:\"操作\",width:\"100px\",colType:\"column\",slotName:\"operation\"},{label:\"备注\",prop:\"remarks\",\"show-overflow-tooltip\":!0}])},formItems:function(){var e=[{type:\"input\",prop:\"nameOrPinyinHeader\",label:\"\",attrs:{placeholder:\"请输入名称、简拼\"}}];return e}},created:function(){this.orderId=this.$route.query.orderId,this.operaType=this.$route.query.orderId,this.isParent=JSON.parse(this.$route.query.isParent),Promise.all([this.getOrderContentArrivalDateList(),this.getOrderDetail(),this.getRecord()])},methods:{handleTabClick:function(){},isOperationDisabled:function(){return\"30200\"==this.orderFlag||\"40200\"==this.orderFlag||\"40100\"==this.orderFlag||\"40110\"==this.orderFlag||\"-20100\"==this.orderFlag},getOrderContentArrivalDateList:function(){var e=this;Object(o[\"h\"])({orderId:this.orderId}).then((function(t){var r=t.data||[];e.tabs=r.map((function(e){return{label:e,name:e}})),e.activeName=e.tabs[0].name}))},fetchTableData:function(e){return this.params=e,Object(o[\"B\"])(Object.assign(e,{orderId:this.orderId,arrivalDate:this.isParent?this.activeName:\"\"})).then((function(e){return new Promise((function(t){return t(e)}))}))},getOrderDetail:function(){var e=this;Object(o[\"i\"])({orderId:this.orderId}).then((function(t){e.orderFormInfo=t.data||{},e.orderFlag=e.orderFormInfo.status||null,e.orderStatistics()}))},getRowCustomName:function(e){var t=e.row;e.rowIndex;return t.outOfStock?\"table-no-production\":\"\"},getOrderStatus:function(e){var t=this.$D(\"ORDER_TYPE\",\"\"+e)||\"\";return t},handleOrder:function(e){var t=this;if(\"40100\"!=e||this.orderRemark){var r=this.operaCode[e];this.$confirm(\"您确定要\".concat(r,\"吗?\"),\"提示\",{confirmButtonText:\"确定\",cancelButtonText:\"取消\",type:\"warning\"}).then((function(){Object(o[\"a\"])({id:t.orderId,remark:t.orderRemark,code:e}).then((function(e){t.warning(\"\".concat(r,\"成功！\"),\"success\"),t.$router.push({path:\"/order/order-management\"})}))})).catch((function(){}))}else this.warning(\"请填写备注\")},formateDate:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(!e)return\"-\";var r=new Date(e),a=r.getFullYear(),n=(r.getMonth()+1).toString().padStart(2,\"0\"),o=r.getDate().toString().padStart(2,\"0\"),i=r.getHours().toString().padStart(2,\"0\"),c=r.getMinutes().toString().padStart(2,\"0\"),s=r.getSeconds().toString().padStart(2,\"0\");return 1==t?a+\"年\"+n+\"月\"+o+\"日\":2==t?a+\"-\"+n+\"-\"+o+\" \"+i+\":\"+c+\":\"+s:3==t?a+\"_\"+n+\"_\"+o+\"_\"+i+\"_\"+c+\"_\"+s:4==t?a+\"-\"+n+\"-\"+o:void 0},orderStatistics:function(){var e=this,t=this.initStatisticsInfo;this.orderId?Object(o[\"s\"])({orderId:this.orderId,districtCode:this.orderFormInfo.districtCode}).then((function(r){e.statisticsInfo=r.data||t})):this.statisticsInfo=t},getRecord:function(){var e=this;Object(o[\"n\"])({orderId:this.orderId}).then((function(t){e.historyTableData=t.data||[]}))},exportOrder:function(){var e=this,t=this.orderFormInfo,r=this.getOrderStatus,a=this.formateDate,n=t.type,i=t.provinceName,c=t.cityName,s=t.districtName,u=t.parentDeptName,d=t.deptName,l=(t.updateTime,t.auditTime,t.arrivalTime),p=t.creatorName,f=t.confirmTime,m=\"【\".concat(t.orderNo,\"】【\").concat(r(n),\"】\").concat(i).concat(c).concat(s).concat(u).concat(d,\"的订单下单日期\").concat(a(f)).concat(this.isParent?\"\":\"到货日期\"+a(l),\"采购人\").concat(p,\"_\").concat(a(Date.now(),3),\".xlsx\");Object(o[\"A\"])({orderId:this.orderId}).then((function(t){e.$util.downLoadBlob(t,m)}))},goBackModify:function(){this.$router.push({path:\"/order/edit-order\",query:{orderId:this.orderId}})},warning:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:\"warning\";this.$message({showClose:!0,message:e,type:t})},ajaxGetTableDataByPage:function(){var e=this;this.$nextTick((function(){e.$refs.bTable.ajaxGetTableDataByPage()}))},selectable:function(e,t){return\"2010000\"==e.status},deliverGoods:function(e,t){var r=this;\"40100\"!=e||this.orderRemark?this.$confirm(\"您确定要发货吗?\",\"提示\",{confirmButtonText:\"确定\",cancelButtonText:\"取消\",type:\"warning\"}).then((function(){var a=t.orderContentDetailIds.split(\",\");a=a.map((function(e){return Number(e)})),Object(o[\"b\"])({id:r.orderId,detailIds:a,remark:r.orderRemark,code:e}).then((function(e){r.warning(\"发货成功！\",\"success\"),r.ajaxGetTableDataByPage(),r.getRecord(),r.getOrderDetail()}))})).catch((function(){})):this.warning(\"请填写备注\")},batchDeliverGoods:function(e){var t=this,r=this.$refs.bTable.selectRows;0!==r.length?\"40100\"!=e||this.orderRemark?this.$confirm(\"您即将批量发货\"+r.length+\"条数据，是否继续？\",\"提示\",{confirmButtonText:\"确定\",cancelButtonText:\"取消\",type:\"warning\"}).then((function(){var a=[];r.forEach((function(e){a=a.concat(e.orderContentDetailIds.split(\",\"))})),a=a.map((function(e){return Number(e)})),Object(o[\"b\"])({id:t.orderId,detailIds:a,remark:t.orderRemark,code:e}).then((function(e){e.data;t.$message({type:\"success\",message:\"批量发货成功!\"}),t.ajaxGetTableDataByPage(),t.getRecord(),t.getOrderDetail()}))})):this.warning(\"请填写备注\"):this.$message(\"请至少选择一条数据\")}}},f=p,m=(r(\"e81c\"),r(\"2877\")),h=Object(m[\"a\"])(f,a,n,!1,null,\"2c6ab066\",null);t[\"default\"]=h.exports},\"9a0c\":function(e,t,r){var a=r(\"342f\");e.exports=/Version\\/10\\.\\d+(\\.\\d+)?( Mobile\\/\\w+)? Safari\\//.test(a)},d643:function(e,t,r){\"use strict\";r.d(t,\"c\",(function(){return n})),r.d(t,\"z\",(function(){return o})),r.d(t,\"a\",(function(){return i})),r.d(t,\"x\",(function(){return c})),r.d(t,\"f\",(function(){return s})),r.d(t,\"q\",(function(){return u})),r.d(t,\"r\",(function(){return d})),r.d(t,\"i\",(function(){return l})),r.d(t,\"s\",(function(){return p})),r.d(t,\"p\",(function(){return f})),r.d(t,\"e\",(function(){return m})),r.d(t,\"y\",(function(){return h})),r.d(t,\"A\",(function(){return b})),r.d(t,\"D\",(function(){return v})),r.d(t,\"B\",(function(){return g})),r.d(t,\"m\",(function(){return O})),r.d(t,\"n\",(function(){return T})),r.d(t,\"l\",(function(){return _})),r.d(t,\"o\",(function(){return w})),r.d(t,\"t\",(function(){return y})),r.d(t,\"v\",(function(){return I})),r.d(t,\"u\",(function(){return S})),r.d(t,\"w\",(function(){return D})),r.d(t,\"g\",(function(){return k})),r.d(t,\"h\",(function(){return j})),r.d(t,\"b\",(function(){return C})),r.d(t,\"d\",(function(){return N})),r.d(t,\"j\",(function(){return P})),r.d(t,\"k\",(function(){return x})),r.d(t,\"C\",(function(){return E}));var a=r(\"be3b\");function n(){return Object(a[\"b\"])({url:\"/provinceCityDistrict/baseTreeWithPowerSchool\",method:\"GET\",params:{}},\"cater\")}function o(){return Object(a[\"b\"])({url:\"/provinceCityDistrict/schoolTree\",method:\"GET\",params:{}},\"cater\")}function i(e){return Object(a[\"b\"])({url:\"/approve/order\",method:\"POST\",data:e},\"cater\")}function c(e){return Object(a[\"b\"])({url:\"/order/saveOrderAndContent\",method:\"POST\",data:e},\"cater\")}function s(e){return Object(a[\"b\"])({url:\"/order/deleteOrder/\".concat(e.orderId),method:\"POST\",data:{}},\"cater\")}function u(e){return Object(a[\"b\"])({url:\"/order/orderContentForSelect\",method:\"GET\",params:e},\"cater\")}function d(e){return Object(a[\"b\"])({url:\"/order/orderContentForSelectIngredient\",method:\"GET\",params:e},\"cater\")}function l(e){return Object(a[\"b\"])({url:\"/order/orderBase/\".concat(e.orderId),method:\"GET\",params:{}},\"cater\")}function p(e){return Object(a[\"b\"])({url:\"/order/orderStatistics\",method:\"GET\",params:e},\"cater\")}function f(e){return Object(a[\"b\"])({url:\"/order/orderContentForPage\",method:\"GET\",params:e},\"cater\")}function m(e){return Object(a[\"b\"])({url:\"/order/commonOrderContentForPage\",method:\"GET\",params:e},\"cater\")}function h(e){return Object(a[\"b\"])({url:\"/order/saveOrderBase\",method:\"POST\",data:e},\"cater\")}function b(e){return Object(a[\"b\"])({responseType:\"blob\",url:\"/export/supplierOrderContentExcel\",method:\"GET\",params:e},\"cater\")}function v(e){return Object(a[\"b\"])({url:\"/supplierOrder/supplierOrderPage\",method:\"GET\",params:e},\"cater\")}function g(e){return Object(a[\"b\"])({url:\"/supplierOrder/supplierOrderContentPage\",method:\"GET\",params:e},\"cater\")}function O(e){return Object(a[\"b\"])({url:\"/purchaseOrder/getPurchaseOrderList\",method:\"POST\",data:e},\"cater\")}function T(e){return Object(a[\"b\"])({url:\"/orderOperationRecord/getRecord\",method:\"GET\",params:e},\"cater\")}function _(e){return Object(a[\"b\"])({url:\"/purchaseOrder/getPurchaseOrderGlobal\",method:\"POST\",data:e},\"cater\")}function w(e){return Object(a[\"b\"])({url:\"/supplierOrder/supplierOrderGlobal\",method:\"GET\",params:e},\"cater\")}function y(e){return Object(a[\"b\"])({responseType:\"blob\",url:\"/purchaseOrder/purchaseExport\",method:\"POST\",data:e},\"cater\")}function I(e){return Object(a[\"b\"])({responseType:\"blob\",url:\"/export/purchaseOrderExcel\",method:\"GET\",params:e},\"cater\")}function S(e){return Object(a[\"b\"])({responseType:\"blob\",url:\"/export/purchaseOrderDetailExcel\",method:\"GET\",params:e},\"cater\")}function D(e){return Object(a[\"b\"])({responseType:\"blob\",url:\"/export/purchasePreviewExcel\",method:\"GET\",params:e},\"cater\")}function k(e){return Object(a[\"b\"])({url:\"/dictionary/getStatusInfo\",method:\"GET\",params:e},\"cater\")}function j(e){return Object(a[\"b\"])({url:\"/order/getOrderContentArrivalDateList\",method:\"GET\",params:e},\"cater\")}function C(e){return Object(a[\"b\"])({url:\"/approve/orderDetail\",method:\"POST\",data:e},\"cater\")}function N(e){return Object(a[\"b\"])({url:\"/approve/batchReceived\",method:\"POST\",data:e},\"cater\")}function P(e){return Object(a[\"b\"])({url:\"/orderContentDetail/getOrderDetailInfo\",method:\"GET\",params:e},\"cater\")}function x(e){return Object(a[\"b\"])({url:\"/order/getOrderIsWithdrawn\",method:\"GET\",params:e},\"cater\")}function E(e){return Object(a[\"b\"])({url:\"/export/supplierOrderListContentExcel\",method:\"GET\",responseType:\"blob\",params:e},\"cater\")}},e81c:function(e,t,r){\"use strict\";var a=r(\"2ae9\"),n=r.n(a);n.a}}]);","extractedComments":[]}