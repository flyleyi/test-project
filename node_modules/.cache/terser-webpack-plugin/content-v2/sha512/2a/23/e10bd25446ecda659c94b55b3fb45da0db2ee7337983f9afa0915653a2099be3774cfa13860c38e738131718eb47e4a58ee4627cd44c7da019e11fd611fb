{"code":"(window[\"webpackJsonp\"]=window[\"webpackJsonp\"]||[]).push([[\"catering-allot-user\"],{\"7af0\":function(t,e,a){},cbb5:function(t,e,a){},d185:function(t,e,a){\"use strict\";var s=a(\"7af0\"),i=a.n(s);i.a},e4c7:function(t,e,a){\"use strict\";a.r(e);var s,i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a(\"div\",{staticClass:\"app-container\"},[a(\"div\",{staticClass:\"header\"},[a(\"div\",{staticClass:\"header-right\"},[a(\"span\",{staticClass:\"current-role\"},[t._v(\"当前角色：\")]),a(\"el-tag\",[t._v(t._s(t.roleName))])],1),a(\"div\",{staticClass:\"header-left\"},[a(\"el-button\",{attrs:{type:\"primary\",icon:\"el-icon-arrow-left\",size:\"small\"},on:{click:function(e){return t.$router.push(\"/system/role\")}}},[t._v(\"返回\")])],1)]),a(\"div\",{directives:[{name:\"loading\",rawName:\"v-loading\",value:t.loading,expression:\"loading\"}],staticClass:\"menu-box\"},[a(\"el-col\",{staticClass:\"card-box-col\",attrs:{sm:10}},[a(\"el-card\",{staticClass:\"card-box\"},[a(\"div\",{staticClass:\"card-label tc\"},[t._v(\" 未分配用户 \")]),a(\"div\",[a(\"el-input\",{attrs:{size:\"small\",placeholder:\"输入账号或姓名搜索\"},nativeOn:{keyup:function(e){return t.search(e,0)}},model:{value:t.undist.staffName,callback:function(e){t.$set(t.undist,\"staffName\",\"string\"===typeof e?e.trim():e)},expression:\"undist.staffName\"}})],1),a(\"div\",{staticClass:\"user-list\",staticStyle:{\"overflow-y\":\"auto\",height:\"calc(100vh - 84px - 94px - 126px - 40px)\"},on:{scroll:function(e){return t.scroll(e,0)}}},[a(\"el-table\",{attrs:{size:\"small\",data:t.undist.list,border:\"\"},on:{\"selection-change\":function(e){t.undist.checked=e}}},[a(\"el-table-column\",{attrs:{type:\"selection\",align:\"center\"}}),a(\"el-table-column\",{attrs:{label:\"账号\",prop:\"staffCode\"}}),a(\"el-table-column\",{attrs:{label:\"姓名\",prop:\"staffName\"}})],1)],1)])],1),a(\"el-col\",{staticClass:\"card-box-col\",attrs:{sm:4}},[a(\"div\",{staticClass:\"card-box tb\",staticStyle:{display:\"table\",width:\"100%\"}},[a(\"div\",{staticClass:\"td\",staticStyle:{\"vertical-align\":\"middle\",\"text-align\":\"center\",display:\"table-cell\"}},[a(\"div\",{staticClass:\"item-btn\"},[a(\"el-button\",{attrs:{size:\"small\",loading:t.distLoading,type:\"primary\"},on:{click:t.add}},[t._v(\" 添加分配 \"),a(\"i\",{staticClass:\"el-icon-arrow-right\"})])],1),a(\"div\",{staticClass:\"item-btn cancelbtn\"},[a(\"el-button\",{attrs:{size:\"small\",loading:t.undistLoading},on:{click:t.remove}},[a(\"i\",{staticClass:\"el-icon-arrow-left\"}),t._v(\" 取消分配 \")])],1)])])]),a(\"el-col\",{staticClass:\"card-box-col\",attrs:{sm:10}},[a(\"el-card\",{staticClass:\"card-box\"},[a(\"div\",{staticClass:\"card-label card-label2 tc\"},[t._v(\" 已分配用户 \")]),a(\"div\",[a(\"el-input\",{attrs:{size:\"small\",placeholder:\"输入账号或姓名搜索\"},nativeOn:{keyup:function(e){return t.search(e,1)}},model:{value:t.dist.staffName,callback:function(e){t.$set(t.dist,\"staffName\",\"string\"===typeof e?e.trim():e)},expression:\"dist.staffName\"}})],1),a(\"div\",{staticClass:\"user-list\",staticStyle:{height:\"calc(100vh - 84px - 94px - 126px - 40px)\",\"overflow-y\":\"auto\",\"overflow-x\":\"hidden\"},on:{scroll:function(e){return t.scroll(e,1)}}},[a(\"el-table\",{attrs:{size:\"small\",data:t.dist.list,border:\"\"},on:{\"selection-change\":function(e){t.dist.checked=e}}},[a(\"el-table-column\",{attrs:{type:\"selection\",align:\"center\"}}),a(\"el-table-column\",{attrs:{label:\"账号\",prop:\"staffCode\"}}),a(\"el-table-column\",{attrs:{label:\"姓名\",prop:\"staffName\"}})],1)],1)])],1)],1)])},n=[],l=a(\"5530\"),c=a(\"ade3\"),r=(a(\"cbb5\"),a(\"450d\"),a(\"8bbc\")),o=a.n(r),d=(a(\"2986\"),a(\"14e9\")),u=a.n(d),f=(a(\"5466\"),a(\"ecdf\")),h=a.n(f),p=(a(\"38a0\"),a(\"ad41\")),g=a.n(p),m=(a(\"eca7\"),a(\"3787\")),b=a.n(m),v=(a(\"425f\"),a(\"4105\")),y=a.n(v),j=(a(\"1f1a\"),a(\"4e4b\")),k=a.n(j),O=(a(\"10cb\"),a(\"f3ad\")),D=a.n(O),x=(a(\"f4f9\"),a(\"c2cc\")),C=a.n(x),_=(a(\"7a0f\"),a(\"0f6c\")),w=a.n(_),I=(a(\"5e32\"),a(\"6721\")),N=a.n(I),T=(a(\"b8e0\"),a(\"a4c4\")),$=a.n(T),q=(a(\"be4f\"),a(\"896a\")),S=a.n(q),U=a(\"53ca\"),L=(a(\"d3b7\"),a(\"a434\"),a(\"99af\"),a(\"b0c0\"),a(\"3ca3\"),a(\"ddb0\"),a(\"d81d\"),a(\"2b0e\")),A=a(\"be3b\"),R=a(\"e5ad\"),z=0;function E(t,e,a,s,i,n){if(a=a||\"children\",\"[object Array]\"===!Object.prototype.toString.call(i)&&(i=i?[]:i),\"[object Array]\"===Object.prototype.toString.call(t))for(var l=0;l<t.length;l++){var c=t[l],r=1;if(e&&\"object\"==Object(U[\"a\"])(e)){for(var o in e)if(\"function\"==typeof e[o]?!e[o](o,c[o],c,t,l):c[o]!=e[o]){r=0;break}}else c!=e&&(r=0);if(r&&(i?i.push(c):(\"function\"==typeof n&&(n=n(l,c,t)),n=\"[object Array]\"==Object.prototype.toString.call(n)?n:n||[],t.splice.apply(t,[l,1].concat(n)),l--,s&&(l+=n.length)),!s))break;e&&\"object\"==Object(U[\"a\"])(e)&&E(c,e,a,s,i,n)}else t&&\"object\"==Object(U[\"a\"])(t)&&\"[object Array]\"===Object.prototype.toString.call(t[a])&&E(t[a],e,a,s,i,n);return i}L[\"default\"].use(S.a);var H={name:\"BAllotUser\",components:(s={},Object(c[\"a\"])(s,$.a.name,$.a),Object(c[\"a\"])(s,N.a.name,N.a),Object(c[\"a\"])(s,w.a.name,w.a),Object(c[\"a\"])(s,C.a.name,C.a),Object(c[\"a\"])(s,D.a.name,D.a),Object(c[\"a\"])(s,k.a.name,k.a),Object(c[\"a\"])(s,Option.name,Option),Object(c[\"a\"])(s,y.a.name,y.a),Object(c[\"a\"])(s,b.a.name,b.a),Object(c[\"a\"])(s,R[\"a\"].name,R[\"a\"]),Object(c[\"a\"])(s,g.a.name,g.a),Object(c[\"a\"])(s,h.a.name,h.a),Object(c[\"a\"])(s,u.a.name,u.a),Object(c[\"a\"])(s,o.a.name,o.a),s),props:{serverType:{type:String,default:\"\"}},data:function(){return{roleName:\"\",listLoading:!1,dist:{pagin:{roleId:this.$route.query.roleId,limit:50,page:1,offset:0},staffName:\"\",checked:[],list:[]},undist:{pagin:{roleId:this.$route.query.roleId,limit:50,page:1,offset:0},staffName:\"\",checked:[],list:[]},saveData:{add:[],remove:[]},distLoading:!1,undistLoading:!1,loading:!1,lastRequest1:null,lastRequest2:null}},created:function(){var t=this,e=this.$route.query.roleId;if(!e)return this.$router.go(-1);this.loading=!0,Promise.all([this.getUndist(),this.getDist()]).then((function(){return Object(A[\"b\"])({method:\"GET\",url:\"/usergw/admin/roleAuth/getRoleName/\".concat(e)},t.serverType)})).then((function(e){t.roleName=e.data,t.loading=!1})).catch((function(){t.loading=!1}))},methods:{lock:function(t){var e=this;setTimeout((function(){e[\"_lock\"+t]=!1}),50)},queryUser:function(t,e,a){return Object(A[\"b\"])({method:\"GET\",url:\"/usergw/admin/edusysStaff/selectUserByRoleId\",params:Object(l[\"a\"])(Object(l[\"a\"])({type:t},e),{},{staffName:a})},this.serverType)},getUndist:function(t){var e=this,a=this.lastRequest1=++z;return this.queryUser(1,this.undist.pagin,this.undist.staffName).then((function(t){if(a===e.lastRequest1){var s=t.data.records||[];e.undist.list=e.undist.list.concat(s),e.$nextTick((function(){e._el&&(e._el.scrollTop=e._scrollTop),e.lock(0)}))}})).catch((function(){}))},getDist:function(t){var e=this,a=this.lastRequest2=++z;return this.queryUser(0,this.dist.pagin,this.dist.staffName).then((function(t){if(a===e.lastRequest2){var s=t.data.records||[];e.dist.list=e.dist.list.concat(s),e.$nextTick((function(){e._el&&(e._el.scrollTop=e._scrollTop),e.lock(1)}))}})).catch((function(){}))},search:function(t,e){13==t.which&&(e?(this.dist.pagin.page=1,this.dist.pagin.offset=0,this.dist.list=[],this.getDist()):(this.undist.pagin.page=1,this.undist.pagin.offset=0,this.undist.list=[],this.getUndist()))},scroll:function(t,e){var a=this,s=t.target||t.srcElement,i=s.scrollHeight-Math.max(s.clientHeight,s.offsetHeight);if(i-s.scrollTop<=10){if(this[\"_lock\"+e])return;this[\"_lock\"+e]=!0,this.$nextTick((function(){a._el=s,a._scrollTop=s.scrollTop,e?a.dist.pagin.page++:a.undist.pagin.page++,e?a.dist.pagin.offset=(a.dist.pagin.page-1)*a.dist.pagin.limit:a.undist.pagin.offset=(a.undist.pagin.page-1)*a.undist.pagin.limit,e?a.getDist():a.getUndist()}))}},add:function(){var t=this;if(!(this.undist.checked&&this.undist.checked.length>0))return this.$message.warning(\"请至少选择一个未分配用户\");this.distLoading=!0,this.updateDistData(this.undist.checked.map((function(t){return t.staffId})),[]).then((function(){for(var e in t.distLoading=!1,t.undist.checked){var a=t.undist.checked[e];t.dist.list.unshift(a),E(t.undist.list,a,\"\",0),E(t.saveData.remove,a.staffId,\"\",0);var s=E(t.saveData.add,a.staffId,\"\",0,1);s.length<1&&t.saveData.add.push(a.staffId)}t.refresh(0),t.refresh(1)})).catch((function(){t.distLoading=!1}))},remove:function(){var t=this;if(!(this.dist.checked&&this.dist.checked.length>0))return this.$message.warning(\"请至少选择一个已分配用户\");this.undistLoading=!0,this.updateDistData([],this.dist.checked.map((function(t){return t.staffId}))).then((function(){for(var e in t.undistLoading=!1,t.dist.checked){var a=t.dist.checked[e];t.undist.list.unshift(a),E(t.dist.list,a,\"\",0),E(t.saveData.add,a.staffId,\"\",0);var s=E(t.saveData.remove,a.staffId,\"\",0,1);s.length<1&&t.saveData.remove.push(a.staffId)}t.refresh(0),t.refresh(1)})).catch((function(){t.undistLoading=!1}))},saveAllotData:function(t){return Object(A[\"b\"])({method:\"POST\",url:\"/usergw/admin/roleUser/roleAddUser\",data:t},this.serverType)},handleSave:function(){var t=this;return this.saveAllotData(Object(l[\"a\"])(Object(l[\"a\"])({},this.saveData),{},{roleId:this.$route.query.roleId})).then((function(e){t.saveData.add=[],t.saveData.remove=[],t.$message.success(\"保存成功\")}))},updateDistData:function(t,e){var a=this;return this.saveAllotData({add:t,remove:e,roleId:this.$route.query.roleId}).then((function(t){a.saveData.add=[],a.saveData.remove=[],a.$message.success(\"保存成功\")}))},refresh:function(t){var e=t?this.getDist:this.getUndist,a=t?this.dist:this.undist;this.$refs[t?\"dist\":\"undist\"];if(a.list.length){var s=a.pagin.offset,i=a.pagin.limit;a.pagin.offset=0,a.pagin.limit=a.list.length;var n=function(){a.pagin.offset=s,a.pagin.limit=i};a.list=[],e().then((function(){n()})).catch(n)}else a.pagin.offset=0,e()}}},B=H,G=(a(\"d185\"),a(\"2877\")),J=Object(G[\"a\"])(B,i,n,!1,null,\"afc28e0e\",null);e[\"default\"]=J.exports}}]);","extractedComments":[]}