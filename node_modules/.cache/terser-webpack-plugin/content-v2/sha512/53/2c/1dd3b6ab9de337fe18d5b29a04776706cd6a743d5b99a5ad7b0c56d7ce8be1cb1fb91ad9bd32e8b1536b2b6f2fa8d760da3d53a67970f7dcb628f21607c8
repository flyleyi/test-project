{"code":"(window[\"webpackJsonp\"]=window[\"webpackJsonp\"]||[]).push([[\"catering-user-permission\"],{\"00bb\":function(t,e){t.exports=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAt1BMVEUAAABPhPZJffFJfPFJffFJfPBLffBMfvBNf/BSgvBSg/BUhPBZh/FaiPFijvJkj/JulvNvl/NwmPNxmfNzmvN1m/N7oPR8oPSBpPSDpvSFp/WKq/WMrPWRsPaWs/aYtfabt/adufeowPesw/iuxPivxfi5zfm+0Pm/0fnA0vnO3PvP3fvb5fzc5fzc5vzm7f3n7v3w9P3y9v72+P73+f75+v76+/77/P78/P78/f79/f7+/v7///+U4lsgAAAABXRSTlMAHafm7WqwCLkAAACqSURBVDjLzZO3FsIwDEVlO4+a0HvvLbTQIfr/72LhHBgceeVNHu4gXesRKW2QEKMVkfIgxFOkIUaTkQFDcOSPAT8cikB2y1MJSG84zEjAivc5aYYZHwNpyBFHRWmLbnwpW9YMqp9H4/5o2jwsuQ8AKJ3jnlVU/fZsAShEPE4w2Xlda/APPE9UPeBTZcdr4S8mHH8FWtdc/Ai0Aql2/k9PzlkcZ/Wc5XXV/w0tTR1d77YjrgAAAABJRU5ErkJggg==\"},\"4f40\":function(t,e,c){},\"9a10\":function(t,e){t.exports=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAG1BMVEUAAACNsP+Iqf+Hqv+Iqv+Hqf+qwv/y9v////+NUaisAAAABXRSTlMAHafm7WqwCLkAAAA4SURBVCjPY2BUDkUCRgIMIqEowJFBNb0DCZQFMZhWIAu0BzOEdqCA0FGBwSGAEVEYUYkR2ejJAQCtG/RhhxRTQAAAAABJRU5ErkJggg==\"},b3ca:function(t,e,c){\"use strict\";c.r(e);var i=function(){var t=this,e=t.$createElement,c=t._self._c||e;return c(\"div\",{staticClass:\"permission-wrapper\"},[c(\"div\",{staticClass:\"btn-wrapper\"},[c(\"el-button\",{attrs:{size:\"small\",type:\"primary\"},on:{click:t.handleSave}},[t._v(\"保存\")])],1),c(\"div\",{staticClass:\"role-list-wrapper\"},[c(\"div\",{staticClass:\"left\"},[t._v(t._s(t.$route.query.staffName))]),c(\"div\",{staticClass:\"right\"},[c(\"ul\",t._l(t.roleList,(function(e){return c(\"li\",{key:e.roleId},[c(\"div\",{on:{click:function(c){return t.checkRole(e)}}},[c(\"img\",{staticClass:\"checkImg\",attrs:{src:e.enable?t.selectedCheckboxIcon:t.normalCheckboxIcon,alt:\"\"}}),c(\"span\",[t._v(\" \"+t._s(e.roleName))])])])})),0)])]),c(\"el-table\",{attrs:{data:t.tableData}},[c(\"el-table-column\",{attrs:{prop:\"province\",label:\"省份\"},scopedSlots:t._u([{key:\"default\",fn:function(e){return[e.row.provinceHidden?t._e():c(\"span\",{staticClass:\"table-item\",on:{click:function(c){return t.checkProvince(e.$index)}}},[c(\"img\",{staticClass:\"checkImg\",attrs:{src:e.row.provinceSelected?t.selectedCheckboxIcon:t.normalCheckboxIcon,alt:\"\"}}),t._v(\" \"+t._s(e.row.province)+\" \")])]}}])}),c(\"el-table-column\",{attrs:{prop:\"date\",label:\"市\"},scopedSlots:t._u([{key:\"default\",fn:function(e){return[e.row.cityHidden?t._e():c(\"span\",{staticClass:\"table-item\",on:{click:function(c){return t.checkCity(e.$index)}}},[c(\"img\",{staticClass:\"checkImg\",attrs:{src:e.row.citySelected?t.selectedCheckboxIcon:t.normalCheckboxIcon,alt:\"\"}}),t._v(\" \"+t._s(e.row.city)+\" \")])]}}])}),c(\"el-table-column\",{attrs:{prop:\"date\",label:\"区县\"},scopedSlots:t._u([{key:\"default\",fn:function(e){return[e.row.districtHidden?t._e():c(\"span\",{staticClass:\"table-item\",on:{click:function(c){return t.checkDistrict(e.$index)}}},[c(\"img\",{staticClass:\"checkImg\",attrs:{src:e.row.districtSelected?t.selectedCheckboxIcon:t.normalCheckboxIcon,alt:\"\"}}),t._v(\" \"+t._s(e.row.district)+\" \")])]}}])}),c(\"el-table-column\",{attrs:{prop:\"school\",label:\"学校\"},scopedSlots:t._u([{key:\"default\",fn:function(e){return[c(\"span\",{staticClass:\"table-item\",on:{click:function(c){return t.checkSchool(e.$index)}}},[c(\"img\",{staticClass:\"checkImg\",attrs:{src:e.row.schoolSelected?t.selectedCheckboxIcon:t.normalCheckboxIcon,alt:\"\"}}),t._v(\" \"+t._s(e.row.school)+\" \")])]}}])}),c(\"el-table-column\",{attrs:{prop:\"school\",label:\"学部\"},scopedSlots:t._u([{key:\"default\",fn:function(e){return t._l(e.row.schoolBranchList,(function(i,a){return c(\"span\",{key:i.schoolBranchId,staticClass:\"table-item\",on:{click:function(c){return t.checkSchoolBranch(e.$index,a)}}},[c(\"img\",{staticClass:\"checkImg\",attrs:{src:i.selected?t.selectedCheckboxIcon:t.normalCheckboxIcon,alt:\"\"}}),t._v(\" \"+t._s(i.schoolBranchName)+\" \")])}))}}])})],1)],1)},a=[],s=c(\"ade3\"),o=(c(\"d4df\"),c(\"450d\"),c(\"7fc1\")),l=c.n(o),n=(c(\"b0c0\"),c(\"4de4\"),c(\"c740\"),c(\"d81d\"),c(\"d3b7\"),c(\"3ca3\"),c(\"ddb0\"),c(\"9a10\")),r=c.n(n),h=c(\"00bb\"),d=c.n(h),u=c(\"eb34\"),f={name:\"PermissionAssign\",components:Object(s[\"a\"])({},l.a.name,l.a),data:function(){return{normalCheckboxIcon:r.a,selectedCheckboxIcon:d.a,tableData:[],roleList:[]}},beforeRouteEnter:function(t,e,c){c((function(t){t.getTableData(),t.getUserRoles()}))},created:function(){},methods:{getTableData:function(){var t=this;this.$route.query.staffCode&&Object(u[\"a\"])({staffCode:this.$route.query.staffCode}).then((function(e){var c=e.data||[];t.transformData(c)}))},transformData:function(t){for(var e=[],c=0;c<t.length;c++)for(var i=0;i<t[c].childList.length;i++)for(var a=0;a<t[c].childList[i].childList.length;a++)for(var s=0;s<t[c].childList[i].childList[a].schoolList.length;s++){for(var o=[],l=0;l<t[c].childList[i].childList[a].schoolList[s].schoolBranchRespDtoList.length;l++)o.push({schoolBranchName:t[c].childList[i].childList[a].schoolList[s].schoolBranchRespDtoList[l].name,schoolBranchId:t[c].childList[i].childList[a].schoolList[s].schoolBranchRespDtoList[l].id,selected:t[c].childList[i].childList[a].schoolList[s].schoolBranchRespDtoList[l].isSelected});e.push({province:t[c].name,provinceId:t[c].id,provinceSelected:t[c].childList[i].childList[a].schoolList[s].isSelected,provinceHidden:0!==i||0!==a||0!=s,city:t[c].childList[i].name,cityId:t[c].childList[i].id,cityHidden:0!==a||0!=s,citySelected:t[c].childList[i].childList[a].schoolList[s].isSelected,district:t[c].childList[i].childList[a].name,districtId:t[c].childList[i].childList[a].id,districtHidden:0!=s,districtSelected:t[c].childList[i].childList[a].schoolList[s].isSelected,school:t[c].childList[i].childList[a].schoolList[s].name,schoolId:t[c].childList[i].childList[a].schoolList[s].id,schoolSelected:t[c].childList[i].childList[a].schoolList[s].isSelected,schoolBranchList:o})}e.forEach((function(t){t.provinceSelected=e.filter((function(e){return t.provinceId===e.provinceId})).some((function(t){return t.provinceSelected})),t.citySelected=e.filter((function(e){return t.cityId===e.cityId})).some((function(t){return t.citySelected})),t.districtSelected=e.filter((function(e){return t.districtId===e.districtId})).some((function(t){return t.districtSelected}))})),this.tableData=e},checkProvince:function(t){for(var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],c=!this.tableData[t].provinceSelected,i=this.tableData[t].province,a=0;a<this.tableData.length;a++)if(this.tableData[a].province===i&&(this.tableData[a].provinceSelected=c,e)){this.tableData[a].citySelected=c,this.tableData[a].districtSelected=c,this.tableData[a].schoolSelected=c;for(var s=0;s<this.tableData[a].schoolBranchList.length;s++)this.tableData[a].schoolBranchList[s].selected=c}},checkCity:function(t){for(var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],c=!this.tableData[t].citySelected,i=this.tableData[t].provinceId,a=this.tableData[t].cityId,s=this.tableData.findIndex((function(t){return t.provinceId===i})),o=0;o<this.tableData.length;o++)if(this.tableData[o].provinceId===i&&this.tableData[o].cityId===a&&(this.tableData[o].citySelected=c,e)){this.tableData[o].districtSelected=c,this.tableData[o].schoolSelected=c;for(var l=0;l<this.tableData[o].schoolBranchList.length;l++)this.tableData[o].schoolBranchList[l].selected=c}if(c)this.tableData[s].provinceSelected||this.checkProvince(s,!1);else{var n=this.tableData.filter((function(t){return t.provinceId===i})),r=n.every((function(t){return!t.citySelected}));r&&this.checkProvince(s,!1)}},checkDistrict:function(t){for(var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],c=!this.tableData[t].districtSelected,i=this.tableData[t].provinceId,a=this.tableData[t].cityId,s=this.tableData[t].districtId,o=this.tableData.findIndex((function(t){return t.cityId===a})),l=0;l<this.tableData.length;l++)if(this.tableData[l].provinceId===i&&this.tableData[l].cityId===a&&this.tableData[l].districtId===s&&(this.tableData[l].districtSelected=c,e)){this.tableData[l].schoolSelected=c;for(var n=0;n<this.tableData[l].schoolBranchList.length;n++)this.tableData[l].schoolBranchList[n].selected=c}if(c)this.tableData[o].citySelected||this.checkCity(o,!1);else{var r=this.tableData.filter((function(t){return t.cityId===a})),h=r.every((function(t){return!t.districtSelected}));h&&this.checkCity(o,!1)}},checkSchool:function(t){for(var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],c=!this.tableData[t].schoolSelected,i=this.tableData[t].provinceId,a=this.tableData[t].cityId,s=this.tableData[t].districtId,o=this.tableData[t].schoolId,l=this.tableData.findIndex((function(t){return t.districtId===s})),n=0;n<this.tableData.length;n++)if(this.tableData[n].provinceId===i&&this.tableData[n].cityId===a&&this.tableData[n].districtId===s&&this.tableData[n].schoolId===o&&(this.tableData[n]=Object.assign(this.tableData[n],{schoolSelected:c}),e))for(var r=0;r<this.tableData[n].schoolBranchList.length;r++)this.tableData[n].schoolBranchList[r].selected=c;if(c)this.tableData[l].districtSelected||this.checkDistrict(l,!1);else{var h=this.tableData.filter((function(t){return t.districtId===s})),d=h.every((function(t){return!t.schoolSelected}));d&&this.checkDistrict(l,!1)}},checkSchoolBranch:function(t,e){var c=!this.tableData[t].schoolBranchList[e].selected;this.tableData[t].districtId,this.tableData[t].cityId,this.tableData[t].provinceId;if(this.tableData[t].schoolBranchList[e].selected=c,c)this.tableData[t].schoolSelected||this.checkSchool(t,!1);else{var i=this.tableData[t].schoolBranchList.every((function(t){return!t.selected}));i&&this.checkSchool(t,!1)}},saveRole:function(){var t=this,e=this.roleList,c=e.map((function(e){return{roleId:e.roleId,staffId:t.$route.query.staffId,deleted:!e.enable}}));Object(u[\"i\"])(c).then((function(t){}))},savePermission:function(){for(var t=this,e=[],c=0;c<this.tableData.length;c++)for(var i=0;i<this.tableData[c].schoolBranchList.length;i++){var a=this.tableData[c].schoolBranchList.filter((function(t){return!t.selected}));this.tableData[c].schoolBranchList[i].selected&&e.push({schoolId:this.tableData[c].schoolId,schoolBranchId:this.tableData[c].schoolBranchList[i].schoolBranchId,allSelected:a.length?0:1})}Object(u[\"g\"])({staffCode:this.$route.query.staffCode,subList:e}).then((function(e){t.$message({type:\"success\",message:\"保存成功!\"})}))},handleSave:function(){Promise.all([this.saveRole(),this.savePermission()])},checkRole:function(t){t.enable=1===t.enable?0:1},getUserRoles:function(){var t=this;Object(u[\"c\"])({staffCode:this.$route.query.staffCode}).then((function(e){t.roleList=e.data}))}}},b=f,v=(c(\"f55b\"),c(\"2877\")),p=Object(v[\"a\"])(b,i,a,!1,null,\"0da29c20\",null);e[\"default\"]=p.exports},d4df:function(t,e,c){},eb34:function(t,e,c){\"use strict\";c.d(e,\"f\",(function(){return a})),c.d(e,\"h\",(function(){return s})),c.d(e,\"d\",(function(){return o})),c.d(e,\"e\",(function(){return l})),c.d(e,\"a\",(function(){return n})),c.d(e,\"g\",(function(){return r})),c.d(e,\"c\",(function(){return h})),c.d(e,\"b\",(function(){return d})),c.d(e,\"i\",(function(){return u}));c(\"a15b\");var i=c(\"be3b\");function a(t){return Object(i[\"b\"])({url:\"/common/getUserList\",method:\"GET\",params:t},\"cater\")}function s(t){return Object(i[\"b\"])({url:\"/dataAuth/userDataAuthSetUp\",method:\"POST\",data:t||{}},\"cater\")}function o(t){return Object(i[\"b\"])({url:\"/class-api/classApi/queryAllClassForAuth\",method:\"GET\",params:t},\"cater\")}function l(t){return Object(i[\"b\"])({url:\"/class-api/classApi/queryClassByCodeList\",method:\"GET\",params:{classCodes:Array.isArray(t)?t.join(\",\"):\"\"}},\"cater\")}function n(t){return Object(i[\"b\"])({url:\"/provinceCityDistrict/baseTreeWithSchool\",method:\"GET\",params:t},\"cater\")}function r(t){return Object(i[\"b\"])({url:\"/userSchoolPower/saveUserSchoolPower\",method:\"POST\",data:t},\"cater\")}function h(t){return Object(i[\"b\"])({url:\"/common/getUserRoles\",method:\"GET\",params:t},\"cater\")}function d(t){return Object(i[\"b\"])({url:\"/userSchoolPower/batchSaveUserSchoolPower\",method:\"POST\",data:t},\"cater\")}function u(t){return Object(i[\"b\"])({url:\"/common/updateUserRole\",method:\"POST\",data:t},\"cater\")}},f55b:function(t,e,c){\"use strict\";var i=c(\"4f40\"),a=c.n(i);a.a}}]);","extractedComments":[]}