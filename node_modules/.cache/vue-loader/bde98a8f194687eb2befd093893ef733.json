{"remainingRequest":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/fuyueyi/Desktop/practice/mutilwap/src/pages/teaching-points-h5/views/teaching-activity/planDetailsAdd.vue?vue&type=style&index=0&id=3dfb364d&lang=less&scoped=true&","dependencies":[{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/src/pages/teaching-points-h5/views/teaching-activity/planDetailsAdd.vue","mtime":1627979214415},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/less-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/style-resources-loader/lib/index.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKDQouY29udGFpbmVyIHsNCiAgYmFja2dyb3VuZDogI2Y2ZjZmNjsNCiAgcGFkZGluZy10b3A6IDAuMnJlbTsNCiAgaGVpZ2h0OiAxMDAlOw0KfQ0KDQovZGVlcC8gLnZhbi1jZWxsIHsNCiAgcG9zaXRpb246IHJlbGF0aXZlOw0KICBkaXNwbGF5OiAtd2Via2l0LWJveDsNCiAgZGlzcGxheTogLXdlYmtpdC1mbGV4Ow0KICBkaXNwbGF5OiBmbGV4Ow0KICBib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICB3aWR0aDogMTAwJTsNCiAgcGFkZGluZzogMCAwOw0KICBvdmVyZmxvdzogaGlkZGVuOw0KICBjb2xvcjogIzMyMzIzMzsNCiAgZm9udC1zaXplOiAwLjI4cmVtOw0KICBsaW5lLWhlaWdodDogMC40OHJlbTsNCiAgYmFja2dyb3VuZC1jb2xvcjogI2ZmZjsNCn0NCg0KLmNlbnRlci1jb250ZW50IHsNCiAgYmFja2dyb3VuZDogI2ZmZmZmZjsNCiAgcGFkZGluZy1sZWZ0OiAwLjMycmVtOw0KICBwYWRkaW5nLXJpZ2h0OiAwLjMycmVtOw0KICAucGxhbi1pdGVtIHsNCiAgICBoZWlnaHQ6IDAuOTZyZW07DQogICAgZm9udC1zaXplOiAwLjI4cmVtOw0KICAgIGZvbnQtZmFtaWx5OiBQaW5nRmFuZ1NDLVJlZ3VsYXIsIFBpbmdGYW5nIFNDOw0KICAgIGZvbnQtd2VpZ2h0OiA0MDA7DQoNCiAgICAmLWxhYmVsIHsNCiAgICAgIHdpZHRoOiBmaXQtY29udGVudDsNCiAgICAgIGxpbmUtaGVpZ2h0OiAwLjQ0cmVtOw0KICAgICAgY29sb3I6IHJnYmEoMCwgMCwgMCwgMC40NSk7DQogICAgfQ0KICAgICYtdmxhdWUgew0KICAgICAgd2lkdGg6IGZpdC1jb250ZW50Ow0KICAgICAgbGluZS1oZWlnaHQ6IDAuNDRyZW07DQogICAgICBjb2xvcjogcmdiYSgwLCAwLCAwKTsNCiAgICB9DQogIH0NCn0NCg0KLmRldGFpbC1hcnJvdyB7DQogIHdpZHRoOiAwLjMycmVtOw0KICBoZWlnaHQ6IDAuMzJyZW07DQogIG1hcmdpbi1sZWZ0OiBhdXRvOw0KICBtYXJnaW4tcmlnaHQ6IDA7DQogIGJhY2tncm91bmQ6IHVybCgnLi4vLi4vYXNzZXRzL2ltYWdlcy9pY29uL2ljb24tYXJyb3ctZGV0YWlscy5wbmcnKSBuby1yZXBlYXQ7DQogIGJhY2tncm91bmQtc2l6ZTogMTAwJTsNCn0NCg0KLnNpbmdsZS1saW5lIHsNCiAgd2hpdGUtc3BhY2U6IG5vd3JhcDsNCiAgdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7DQogIG92ZXJmbG93OiBoaWRkZW47DQp9DQouZGFzaC1saW5lIHsNCiAgd2lkdGg6IDEwMCU7DQogIGhlaWdodDogMnB4Ow0KICBiYWNrZ3JvdW5kOiByZ2JhKDI1LCAzMSwgMzcsIDAuMDgpOw0KICB0cmFuc2Zvcm06IHNjYWxlWSgwLjUpOw0KfQ0KLmdyZWVuLWNpcmNsZSB7DQogIHdpZHRoOiAwLjEycmVtOw0KICBoZWlnaHQ6IDAuMTJyZW07DQogIGJvcmRlci1yYWRpdXM6IDUwJTsNCiAgYmFja2dyb3VuZDogIzUyYzQxYTsNCn0NCg0KLmV4dHJhLWZpbGVMaXN0IHsNCiAgZGlzcGxheTogZmxleDsNCiAgd2lkdGg6IDEwMCU7DQogIGZsZXgtd3JhcDogd3JhcDsNCiAgPiBsaSB7DQogICAgZGlzcGxheTogZmxleDsNCiAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOw0KICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQogICAgd2lkdGg6IDMzLjMlOw0KICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOw0KICAgIHAgew0KICAgICAgdGV4dC1hbGlnbjogY2VudGVyOw0KICAgICAgaGVpZ2h0OiAwLjRyZW07DQogICAgICBsaW5lLWhlaWdodDogMC40cmVtOw0KICAgICAgd2lkdGg6IDEwMCU7DQogICAgICBvdmVyZmxvdzogaGlkZGVuOw0KICAgICAgdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7DQogICAgICB3aGl0ZS1zcGFjZTogbm93cmFwOw0KICAgIH0NCiAgfQ0KICBpbWcgew0KICAgIHdpZHRoOiAxLjZyZW07DQogICAgaGVpZ2h0OiAxLjZyZW07DQogIH0NCn0NCg0KLnJlZC1zaWduIHsNCiAgd2lkdGg6IDAuMjRyZW07DQogIGNvbG9yOiAjZjI1NjQzOw0KfQ0KDQovZGVlcC8gLmVkaXRvci10ZXh0IHsNCiAgaGVpZ2h0OiBhdXRvOw0KICBtaW4taGVpZ2h0OiA0cmVtOw0KICBiYWNrZ3JvdW5kOiAjZmZmOw0KICB6LWluZGV4OiAxMDAwICFpbXBvcnRhbnQ7DQp9DQovZGVlcC8gLnZhbi1waWNrZXIgew0KICBwb3NpdGlvbjogZml4ZWQ7DQogIGJvdHRvbTogMDsNCiAgd2lkdGg6IDEwMCU7DQogIHotaW5kZXg6IDk5OTk5Ow0KfQ0KL2RlZXAvIC52YW4tb3ZlcmxheSB7DQogIHotaW5kZXg6IDEwMDU7DQp9DQovZGVlcC8gLnZhbi11cGxvYWRlcl9fcHJldmlldy1kZWxldGUtaWNvbiB7DQogIGNvbG9yOiAjZmZmOw0KICBsaW5lLWhlaWdodDogMC4zMnJlbTsNCn0NCi9kZWVwLyAudy1lLXRleHQgew0KICB1bCwNCiAgbGksDQogIG9sIHsNCiAgICBsaXN0LXN0eWxlOiByZXZlcnQ7DQogIH0NCn0NCi9kZWVwLyAudy1lLXBhbmVsLXRhYi10aXRsZSAudy1lLWl0ZW06bGFzdC1vZi10eXBlIHsNCiAgZGlzcGxheTogbm9uZTsNCn0NCltjbGFzcyo9J3Zhbi1oYWlybGluZSddOjphZnRlciB7DQogIGJvcmRlcjogbm9uZTsNCn0NCi9kZWVwLyAuZWRpdG9yLXRleHQgew0KICBoZWlnaHQ6IGF1dG87DQogIG1pbi1oZWlnaHQ6IDVyZW07DQogIGJhY2tncm91bmQ6ICNmZmY7DQogIHotaW5kZXg6IDEwMDAgIWltcG9ydGFudDsNCn0NCi5wLWVkaXQgew0KICBwYWRkaW5nLWJvdHRvbTogMC4zcmVtOw0KfQ0KL2RlZXAvIC5lZGl0b3Igew0KICBwb3NpdGlvbjogcmVsYXRpdmU7DQogIHotaW5kZXg6IDEwMDA7DQogIGJvcmRlci10b3A6IDFweCBzb2xpZCAjY2RjZGNkOw0KfQ0K"},{"version":3,"sources":["planDetailsAdd.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+iBA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"planDetailsAdd.vue","sourceRoot":"src/pages/teaching-points-h5/views/teaching-activity","sourcesContent":["<template>\r\n  <div class=\"container\">\r\n    <van-form @submit=\"onSubmit\">\r\n      <div\r\n        style=\"padding-left:0.32rem;padding-right:0.32rem;background:#ffffff;\"\r\n      >\r\n        <van-field\r\n          v-model=\"detail.activeName\"\r\n          rows=\"3\"\r\n          autosize\r\n          type=\"textarea\"\r\n          maxlength=\"50\"\r\n          placeholder=\"添加计划标题（必填）\"\r\n          show-word-limit\r\n        />\r\n      </div>\r\n      <div class=\"center-content\" style=\"margin-top:0.2rem;\">\r\n        <van-field name=\"semester\">\r\n          <template #input>\r\n            <div style=\"width:100%\" @click=\"selectSchool\">\r\n              <div class=\"flex flex-m plan-item\">\r\n                <div class=\"red-sign\">*</div>\r\n                <div class=\"plan-item-label\">添加学校：</div>\r\n                <div\r\n                  class=\"flex flex-m\"\r\n                  style=\"margin-left:auto;margin-right:0;\"\r\n                >\r\n                  <div class=\"plan-item-value\" style=\"margin-right:0.2rem;\">\r\n                    {{ detail.schoolName }}\r\n                  </div>\r\n                  <div class=\"detail-arrow\"></div>\r\n                </div>\r\n              </div>\r\n              <div class=\"dash-line\"></div>\r\n            </div>\r\n          </template>\r\n        </van-field>\r\n\r\n        <van-field name=\"semester\">\r\n          <template #input>\r\n            <div style=\"width:100%\" @click=\"selectSubject\">\r\n              <div class=\"flex flex-m plan-item\">\r\n                <div class=\"red-sign\">*</div>\r\n                <div class=\"plan-item-label\">添加学科：</div>\r\n                <div\r\n                  class=\"flex flex-m\"\r\n                  style=\"margin-left:auto;margin-right:0;\"\r\n                >\r\n                  <div class=\"plan-item-value\" style=\"margin-right:0.2rem;\">\r\n                    {{ detail.subjectName }}\r\n                  </div>\r\n                  <div class=\"detail-arrow\"></div>\r\n                </div>\r\n              </div>\r\n              <div class=\"dash-line\"></div>\r\n            </div>\r\n          </template>\r\n        </van-field>\r\n\r\n        <van-field name=\"semester\">\r\n          <template #input>\r\n            <div style=\"width:100%\" @click=\"selectSemester\">\r\n              <div class=\"flex flex-m plan-item\">\r\n                <div class=\"red-sign\">*</div>\r\n                <div class=\"plan-item-label\">添加学期：</div>\r\n                <div\r\n                  class=\"flex flex-m\"\r\n                  style=\"margin-left:auto;margin-right:0;\"\r\n                >\r\n                  <div class=\"plan-item-value\" style=\"margin-right:0.2rem;\">\r\n                    {{ detail.semester }}\r\n                  </div>\r\n                  <div class=\"detail-arrow\"></div>\r\n                </div>\r\n              </div>\r\n              <div class=\"dash-line\"></div>\r\n            </div>\r\n          </template>\r\n        </van-field>\r\n\r\n        <van-field name=\"semester\">\r\n          <template #input>\r\n            <div style=\"width:100%\">\r\n              <div class=\"flex flex-m plan-item\">\r\n                <div class=\"red-sign\">*</div>\r\n                <div class=\"plan-item-label\">计划描述：</div>\r\n              </div>\r\n              <div class=\"p-edit\">\r\n                <wangEdit v-model=\"detail.planDescribe\"></wangEdit>\r\n              </div>\r\n            </div>\r\n          </template>\r\n        </van-field>\r\n\r\n        <div v-if=\"fileList && fileList.length > 0\" style=\"margin-top:0.1rem;\">\r\n          <div class=\"text-label\">\r\n            自定义成果：<span>(附件上传与编辑请到电脑端操作) </span>\r\n          </div>\r\n          <ul class=\"extra-fileList\">\r\n            <li\r\n              v-for=\"(item, index) in fileList\"\r\n              @click=\"toPdfPreview(item)\"\r\n              :key=\"index\"\r\n            >\r\n              <img :src=\"item | ComputedImg\" alt=\"\" />\r\n              <p>{{ item.name }}</p>\r\n            </li>\r\n          </ul>\r\n        </div>\r\n\r\n        <!-- <van-field name=\"uploader\">\r\n          <template #input>\r\n            <div>\r\n              <div\r\n                class=\"plan-item-label\"\r\n                style=\"margin-bottom:0.24rem;margin-top:0.26rem;\"\r\n              >\r\n                添加照片:\r\n              </div>\r\n              <van-uploader\r\n                :after-read=\"afterRead\"\r\n                :max-count=\"9\"\r\n                :before-delete=\"deleteRead\"\r\n                v-model=\"fileList\"\r\n                multiple\r\n              />\r\n            </div>\r\n          </template>\r\n        </van-field> -->\r\n      </div>\r\n    </van-form>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport eventBus from '../../plugins/common/eventBus.js';\r\nimport { mapGetters } from 'vuex';\r\n// import VHtml from '../../components/common/VHtml/index';\r\nimport wangEdit from '../../components/common/wangEdit';\r\nimport { Field, Form, Uploader, Toast, Overlay, Loading } from 'vant';\r\nimport { uploadGeturl } from '../../api/base/types-all';\r\nimport { savePlanActive, getPlanInfo } from '../../api/teaching-activity/plan';\r\nimport { toPreview } from '../../plugins/common/utils';\r\nexport default {\r\n  components: {\r\n    // ['preparation']: Preparation, // 筛选\r\n    // ['d-select']: DSelect, // 下拉选择\r\n    // 'v-dateDialog': DatePicker,\r\n    [Field.name]: Field,\r\n    [Form.name]: Form,\r\n    [Toast.name]: Toast,\r\n    [Uploader.name]: Uploader,\r\n    [Overlay.name]: Overlay,\r\n    [Loading.name]: Loading,\r\n    wangEdit\r\n    // 'r-html': VHtml\r\n  },\r\n  data() {\r\n    return {\r\n      id: '',\r\n      detail: {\r\n        id: '',\r\n        activeName: '',\r\n        schoolName: '',\r\n        schoolCode: '',\r\n        subjectName: '',\r\n        subjectCode: '',\r\n        semester: '',\r\n        planDescribe: '',\r\n        url: ''\r\n      },\r\n      uploader: [{}],\r\n      selectList: [],\r\n      fileList: [],\r\n      getSemesterOptionList: []\r\n    };\r\n  },\r\n  computed: {\r\n    ...mapGetters([\r\n      'getSchoolOptions',\r\n      'getSubjectOptions',\r\n      'getAllSchoolOptions',\r\n      'getAllSubjectOptions',\r\n      'getSemesterOptions'\r\n    ])\r\n  },\r\n  filters: {\r\n    ComputedImg(val) {\r\n      let url;\r\n      switch (val.type) {\r\n        case 'zip':\r\n          url = require('../../assets/images/zip.png');\r\n          break;\r\n        case 'avi':\r\n          url = require('../../assets/images/avi.png');\r\n          break;\r\n        case 'mp4':\r\n          url = require('../../assets/images/mp4.png');\r\n          break;\r\n        case 'doc':\r\n        case 'docx':\r\n        case 'DOC':\r\n        case 'DOCX':\r\n          url = require('../../assets/images/word.png');\r\n          break;\r\n        case 'xlsx':\r\n        case 'xls':\r\n        case 'XLSX':\r\n        case 'XLS':\r\n          url = require('../../assets/images/excel.png');\r\n          break;\r\n        case 'ppt':\r\n        case 'pptx':\r\n        case 'PPT':\r\n        case 'PPTX':\r\n          url = require('../../assets/images/ppt.png');\r\n          break;\r\n        case 'pdf':\r\n        case 'PDF':\r\n          url = require('../../assets/images/pdf.png');\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n      return url;\r\n    }\r\n  },\r\n  async created() {\r\n    // this.init();\r\n  },\r\n  mounted() {},\r\n  watch: {},\r\n  activated() {\r\n    //根据key名获取传递回来的参数，data就是map\r\n    let self = this;\r\n    this.$dd.biz.navigation.setRight({\r\n      show: true, //控制按钮显示， true 显示， false 隐藏， 默认true\r\n      // bug: HQAQ-365\r\n      control: true, //是否控制点击事件，true 控制，false 不控制， 默认false\r\n      text: '完成', //控制显示文本，空字符串表示显示默认文本\r\n      onSuccess: function(result) {\r\n        //如果control为true，则onSuccess将在发生按钮点击事件被回调\r\n        return self.savePlanDetails();\r\n      },\r\n      onFail: function(err) {\r\n        console.error(err);\r\n      }\r\n    });\r\n    // 获取selectPage 返回的数据\r\n    eventBus.$on(\r\n      'selectList',\r\n      function(data, item, keyType) {\r\n        console.log('activated  selectList', data);\r\n        if (keyType === 'school') {\r\n          console.log('selectList data', item.label);\r\n          // this.detail.schoolName = item.label;\r\n          for (let index = 0; index < data.length; index++) {\r\n            const element = data[index];\r\n            this.getSchoolOptions[index].isChosed = element.isChosed;\r\n            this.getSchoolOptions[index].label = element.label;\r\n          }\r\n          this.$set(this.detail, 'schoolName', item.label);\r\n          this.detail.schoolCode = item.code;\r\n\r\n          // console.log('schoolName', this.detail.schoolName);\r\n        } else if (keyType === 'subject') {\r\n          for (let index = 0; index < data.length; index++) {\r\n            const element = data[index];\r\n            this.getSubjectOptions[index].isChosed = element.isChosed;\r\n            this.getSubjectOptions[index].label = element.label;\r\n          }\r\n          this.$set(this.detail, 'subjectName', item.label);\r\n          this.detail.subjectCode = item.code;\r\n        } else if (keyType === 'semester') {\r\n          for (let index = 0; index < data.length; index++) {\r\n            const element = data[index];\r\n            this.getSemesterOptionList[index].isChosed = element.isChosed;\r\n            this.getSemesterOptionList[index].label = element.label;\r\n          }\r\n          this.$set(this.detail, 'semester', item.label);\r\n        }\r\n      }.bind(this)\r\n    );\r\n  },\r\n\r\n  methods: {\r\n    // 初始化\r\n    async init() {\r\n      this.id = this.$route.query.id;\r\n      if (this.$route.name === 'planDetailsEdit') {\r\n        this.detail.id = this.id;\r\n        this.getPlanInfo();\r\n      }\r\n      // await this.getTypeOptions('SCHOOL_CODE', 'SET_ALL_SCHOOL_OPTIONS');\r\n      // await this.getTypeOptions('XK', 'SET_ALL_SUBJECT_OPTIONS');\r\n\r\n      this.$store.dispatch('loadSchoolOptions', {\r\n        staffCode: this.$store.getters.staffCode\r\n      });\r\n      this.$store.dispatch('loadSubjectOptions', {\r\n        staffCode: this.$store.getters.staffCode\r\n      });\r\n      await this.getSemesterList();\r\n      // 学校\r\n      this.getSchoolOptions.forEach(element => {\r\n        element.isChosed = false;\r\n      });\r\n      // 学科\r\n      this.getSubjectOptions.forEach(element => {\r\n        element.isChosed = false;\r\n      });\r\n      // 学期\r\n      this.getSemesterOptionList = [];\r\n      this.getSemesterOptions.forEach(element => {\r\n        let a = {};\r\n        a.code = element;\r\n        a.isChosed = false;\r\n        a.label = element;\r\n        this.getSemesterOptionList.push(a);\r\n      });\r\n    },\r\n\r\n    toPdfPreview(item) {\r\n      toPreview(item);\r\n    },\r\n\r\n    // 获取计划详情\r\n    getPlanInfo() {\r\n      let loading = Toast.loading({\r\n        message: '加载中...',\r\n        forbidClick: true\r\n      });\r\n      let params = {\r\n        id: this.id\r\n      };\r\n\r\n      getPlanInfo(params).then(res => {\r\n        if (res.data) {\r\n          // for (const key in this.detail) {\r\n          //   if (Object.hasOwnProperty.call(res.data, key)) {\r\n          //     const element = res.data[key];\r\n          //     this.detail[key] = element;\r\n          //   }\r\n          // }\r\n          this.detail = res.data;\r\n          if (this.detail.url) {\r\n            // this.fileList = this.detail.url.split(',').map(item => {\r\n            //   let arr = item.split('.');\r\n            //   return Object.assign({}, { type: arr[arr.length - 1] });\r\n            // });\r\n\r\n            let resultTitle;\r\n            if (this.detail.urlName) {\r\n              resultTitle = this.detail.urlName.split(',');\r\n            }\r\n            this.fileList = this.detail.url.split(',').map((item, index) => {\r\n              let arr = item.split('.');\r\n              return Object.assign(\r\n                {},\r\n                {\r\n                  type: arr[arr.length - 1],\r\n                  url: item,\r\n                  name: resultTitle ? resultTitle[index] : ''\r\n                }\r\n              );\r\n            });\r\n          }\r\n        } else {\r\n          this.detail = {};\r\n          this.fileList = [];\r\n        }\r\n        loading.clear();\r\n        return res;\r\n      });\r\n    },\r\n    // 保存计划\r\n    savePlanDetails() {\r\n      // this.$router.push({name:'seacher',params:{id:flg}}) // bug：刷新后params里的数据就是空的\r\n      // this.$router.push(`/secher/${flg}`);\r\n\r\n      if (!this.detail.activeName) {\r\n        Toast.fail('请添加计划标题');\r\n      } else if (!this.detail.schoolName) {\r\n        Toast.fail('请选择学校');\r\n      } else if (!this.detail.subjectName) {\r\n        Toast.fail('请选择学科');\r\n      } else if (!this.detail.semester) {\r\n        Toast.fail('请选择学期');\r\n      } else if (!this.detail.planDescribe) {\r\n        Toast.fail('请填写计划描述');\r\n      } else {\r\n        // console.log('params:', this.detail);\r\n        let params = this.detail;\r\n        let loading = Toast.loading({\r\n          message: '正在提交...',\r\n          forbidClick: true\r\n        });\r\n        savePlanActive(params)\r\n          .then(res => {\r\n            loading.clear();\r\n            if (res.success) {\r\n              this.$router.push({\r\n                name: 'teachingActivity'\r\n              });\r\n            } else {\r\n              Toast.fail(res.message | '服务器返回错误');\r\n            }\r\n            return res;\r\n          })\r\n          .catch(err => {\r\n            loading.clear();\r\n          });\r\n      }\r\n    },\r\n\r\n    getTypeOptions(code, type) {\r\n      let payload = {\r\n        params: { parentKey: code },\r\n        types: type\r\n      };\r\n      return this.$store.dispatch('loadChildrenOptions', payload);\r\n    },\r\n\r\n    getSemesterList() {\r\n      return this.$store.dispatch('loadSemesterOptions', {});\r\n    },\r\n\r\n    // 选择学校\r\n    selectSchool() {\r\n      this.selectList = JSON.parse(JSON.stringify(this.getSchoolOptions));\r\n      // console.log('selectList', this.selectList);\r\n      this.selectList.forEach(element => {\r\n        element.label = element.DICTIONARY_TEXT;\r\n      });\r\n\r\n      this.selectList.forEach(element => {\r\n        element.code = element.DICTIONARY_KEY;\r\n        element.label = element.DICTIONARY_TEXT;\r\n      });\r\n      this.$router.push({\r\n        name: 'selectPage',\r\n        query: {\r\n          title: '选择学校'\r\n        },\r\n        params: {\r\n          selectList: this.selectList,\r\n          keyType: 'school',\r\n          currentCode: this.detail.schoolCode\r\n        }\r\n      });\r\n    },\r\n    // 选择学科\r\n    selectSubject() {\r\n      // this.selectList = Object.assign([], this.getSubjectOptions);\r\n      this.selectList = JSON.parse(JSON.stringify(this.getSubjectOptions));\r\n      this.selectList.forEach(element => {\r\n        element.code = element.DICTIONARY_KEY;\r\n        element.label = element.DICTIONARY_TEXT;\r\n      });\r\n      this.$router.push({\r\n        name: 'selectPage',\r\n        query: {\r\n          title: '选择学科'\r\n        },\r\n        params: {\r\n          selectList: this.selectList,\r\n          keyType: 'subject',\r\n          currentCode: this.detail.subjectCode\r\n        }\r\n      });\r\n    },\r\n    // 选择学期\r\n    selectSemester() {\r\n      // this.selectList = Object.assign([], this.getSemesterOptions);\r\n      this.selectList = JSON.parse(JSON.stringify(this.getSemesterOptionList));\r\n      this.getSemesterOptionList.forEach(element => {\r\n        element.code = element.label;\r\n      });\r\n      this.$router.push({\r\n        name: 'selectPage',\r\n        query: {\r\n          title: '选择学期'\r\n        },\r\n        params: {\r\n          selectList: this.selectList,\r\n          keyType: 'semester',\r\n          currentCode: this.detail.semester\r\n        }\r\n      });\r\n    },\r\n    onSubmit(values) {\r\n      console.log('submit', values);\r\n    }\r\n  },\r\n  // 导航离开该组件的对应路由时调用[可以访问组件实例 `this`]\r\n  beforeRouteLeave(to, from, next) {\r\n    // 销毁组件，避免通过vue-router再次进入时，仍是上次的history缓存的状态\r\n    // console.log('to', to.name);\r\n    // if (to.name !== 'selectPage') {\r\n    //   this.$destroy(true);\r\n    // }\r\n\r\n    next();\r\n  },\r\n  beforeRouteEnter(to, from, next) {\r\n    next(vm => {\r\n      if (from.name === 'planDetails' && to.name == 'planDetailsEdit') {\r\n        //一定是从A进到B页面才刷新\r\n        // console.log('to22222,');\r\n        vm.detail = {\r\n          id: '',\r\n          activeName: '',\r\n          schoolName: '',\r\n          schoolCode: '',\r\n          subjectName: '',\r\n          subjectCode: '',\r\n          semester: '',\r\n          planDescribe: '',\r\n          url: ''\r\n        };\r\n\r\n        vm.id = '';\r\n\r\n        vm.uploader = [{}];\r\n        vm.selectList = [];\r\n        vm.fileList = [];\r\n        vm.getSemesterOptionList = [];\r\n        vm.init();\r\n      } else if (\r\n        from.name === 'teachingActivity' &&\r\n        to.name === 'planDetailsAdd'\r\n      ) {\r\n        vm.detail = {\r\n          id: '',\r\n          activeName: '',\r\n          schoolName: '',\r\n          schoolCode: '',\r\n          subjectName: '',\r\n          subjectCode: '',\r\n          semester: '',\r\n          planDescribe: '',\r\n          url: ''\r\n        };\r\n\r\n        vm.id = '';\r\n\r\n        vm.uploader = [{}];\r\n        vm.selectList = [];\r\n        vm.fileList = [];\r\n        vm.getSemesterOptionList = [];\r\n\r\n        vm.init();\r\n      }\r\n    });\r\n  }\r\n};\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.container {\r\n  background: #f6f6f6;\r\n  padding-top: 0.2rem;\r\n  height: 100%;\r\n}\r\n\r\n/deep/ .van-cell {\r\n  position: relative;\r\n  display: -webkit-box;\r\n  display: -webkit-flex;\r\n  display: flex;\r\n  box-sizing: border-box;\r\n  width: 100%;\r\n  padding: 0 0;\r\n  overflow: hidden;\r\n  color: #323233;\r\n  font-size: 0.28rem;\r\n  line-height: 0.48rem;\r\n  background-color: #fff;\r\n}\r\n\r\n.center-content {\r\n  background: #ffffff;\r\n  padding-left: 0.32rem;\r\n  padding-right: 0.32rem;\r\n  .plan-item {\r\n    height: 0.96rem;\r\n    font-size: 0.28rem;\r\n    font-family: PingFangSC-Regular, PingFang SC;\r\n    font-weight: 400;\r\n\r\n    &-label {\r\n      width: fit-content;\r\n      line-height: 0.44rem;\r\n      color: rgba(0, 0, 0, 0.45);\r\n    }\r\n    &-vlaue {\r\n      width: fit-content;\r\n      line-height: 0.44rem;\r\n      color: rgba(0, 0, 0);\r\n    }\r\n  }\r\n}\r\n\r\n.detail-arrow {\r\n  width: 0.32rem;\r\n  height: 0.32rem;\r\n  margin-left: auto;\r\n  margin-right: 0;\r\n  background: url('../../assets/images/icon/icon-arrow-details.png') no-repeat;\r\n  background-size: 100%;\r\n}\r\n\r\n.single-line {\r\n  white-space: nowrap;\r\n  text-overflow: ellipsis;\r\n  overflow: hidden;\r\n}\r\n.dash-line {\r\n  width: 100%;\r\n  height: 2px;\r\n  background: rgba(25, 31, 37, 0.08);\r\n  transform: scaleY(0.5);\r\n}\r\n.green-circle {\r\n  width: 0.12rem;\r\n  height: 0.12rem;\r\n  border-radius: 50%;\r\n  background: #52c41a;\r\n}\r\n\r\n.extra-fileList {\r\n  display: flex;\r\n  width: 100%;\r\n  flex-wrap: wrap;\r\n  > li {\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: center;\r\n    width: 33.3%;\r\n    justify-content: center;\r\n    p {\r\n      text-align: center;\r\n      height: 0.4rem;\r\n      line-height: 0.4rem;\r\n      width: 100%;\r\n      overflow: hidden;\r\n      text-overflow: ellipsis;\r\n      white-space: nowrap;\r\n    }\r\n  }\r\n  img {\r\n    width: 1.6rem;\r\n    height: 1.6rem;\r\n  }\r\n}\r\n\r\n.red-sign {\r\n  width: 0.24rem;\r\n  color: #f25643;\r\n}\r\n\r\n/deep/ .editor-text {\r\n  height: auto;\r\n  min-height: 4rem;\r\n  background: #fff;\r\n  z-index: 1000 !important;\r\n}\r\n/deep/ .van-picker {\r\n  position: fixed;\r\n  bottom: 0;\r\n  width: 100%;\r\n  z-index: 99999;\r\n}\r\n/deep/ .van-overlay {\r\n  z-index: 1005;\r\n}\r\n/deep/ .van-uploader__preview-delete-icon {\r\n  color: #fff;\r\n  line-height: 0.32rem;\r\n}\r\n/deep/ .w-e-text {\r\n  ul,\r\n  li,\r\n  ol {\r\n    list-style: revert;\r\n  }\r\n}\r\n/deep/ .w-e-panel-tab-title .w-e-item:last-of-type {\r\n  display: none;\r\n}\r\n[class*='van-hairline']::after {\r\n  border: none;\r\n}\r\n/deep/ .editor-text {\r\n  height: auto;\r\n  min-height: 5rem;\r\n  background: #fff;\r\n  z-index: 1000 !important;\r\n}\r\n.p-edit {\r\n  padding-bottom: 0.3rem;\r\n}\r\n/deep/ .editor {\r\n  position: relative;\r\n  z-index: 1000;\r\n  border-top: 1px solid #cdcdcd;\r\n}\r\n</style>\r\n"]}]}