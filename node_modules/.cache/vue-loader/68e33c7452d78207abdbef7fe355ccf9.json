{"remainingRequest":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/fuyueyi/Desktop/practice/mutilwap/src/pages/share-platform-front/views/message/index.vue?vue&type=style&index=1&lang=css&","dependencies":[{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/src/pages/share-platform-front/views/message/index.vue","mtime":1645176309828},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKLmVsLXRhYmxlIC53YXJuaW5nLXJvdyB7CiAgLyogYmFja2dyb3VuZDogcmdiKDIwMiwgMjAxLCAyMDEpOyAqLwogIGNvbG9yOiByZ2IoMjA2LCAyMDIsIDIwMik7Cn0KLmVsLXRvb2x0aXBfX3BvcHBlciB7CiAgbWF4LXdpZHRoOiA0MCU7Cn0gLyrorr7nva7mmL7npLrpmpDol4/pg6jliIblhoXlrrnvvIzmjIk1MCXmmL7npLoqLwo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqZA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/pages/share-platform-front/views/message","sourcesContent":["<template>\n  <div class=\"loginRole\">\n    <div class=\"head-background\">\n      <div class=\"logo-img\">\n        <a href=\"#\">\n          <img :src=\"imagelogo\" alt=\"\" @click=\"goPage('1')\" />\n        </a>\n      </div>\n      <div class=\"nav\">\n        <a href=\"#\">\n          <img\n            :src=\"imgSrcHome\"\n            alt=\"返回首页\"\n            title=\"返回首页\"\n            @click=\"goPage('1')\"\n          />\n        </a>\n        <a href=\"#\">\n          <img\n            :src=\"imgSrcOne\"\n            alt=\"我的需求\"\n            title=\"我的需求\"\n            @click=\"goPage('2')\"\n          />\n        </a>\n        <el-badge :is-dot=\"ismessageDot\">\n          <a href=\"#\">\n            <img\n              :src=\"imgSrcTwo\"\n              alt=\"我的消息\"\n              title=\"我的消息\"\n              @click=\"goPage('3')\"\n            />\n          </a>\n        </el-badge>\n        <el-badge :is-dot=\"isDot\">\n          <a href=\"#\">\n            <img\n              :src=\"imgSrcThree\"\n              alt=\"个人中心\"\n              title=\"个人中心\"\n              @click=\"goPage('4')\"\n            />\n          </a>\n        </el-badge>\n        <el-button type=\"primary\" size=\"mini\" @click.native=\"logOut\"\n          >退出</el-button\n        >\n      </div>\n    </div>\n    <div class=\"menu\">\n      <el-card>\n        <el-form label-width=\"180px\" style=\"\" label-position=\"left\">\n          <span class=\"el-span\">我的消息</span>\n          <el-button\n            size=\"small\"\n            style=\"float:right;margin-top:15px;margin-left:10px;\"\n            @click=\"signReaded\"\n            >标记已读</el-button\n          >\n          <el-button\n            size=\"small\"\n            style=\"float:right;margin-top:15px;\"\n            @click=\"signAllReaded\"\n            >全部已读</el-button\n          >\n          <el-divider></el-divider\n        ></el-form>\n        <el-table\n          ref=\"multipleTable\"\n          :data=\"messageData.records\"\n          style=\"width:100%\"\n          tooltip-effect=\"dark\"\n          :row-class-name=\"tableRowClassName\"\n          @selection-change=\"changeFun\"\n        >\n          <el-table-column type=\"selection\" width=\"40\" :selectable=\"selectable\">\n          </el-table-column>\n          <el-table-column\n            prop=\"messageContent\"\n            label=\"消息内容\"\n            show-overflow-tooltip\n            min-width=\"400\"\n            ><template slot-scope=\"prop\">\n              <span v-if=\"!prop.row.extra\">{{ prop.row.messageContent }}</span>\n              <span v-else\n                >{{ prop.row.messageContent.split('|')[0]\n                }}<el-link type=\"primary\" @click=\"linkBtn(prop.row)\">{{\n                  prop.row.extraData\n                }}</el-link\n                >{{ prop.row.messageContent.split('|')[1] }}</span\n              >\n            </template>\n          </el-table-column>\n          <el-table-column label=\"日期\" prop=\"createTime\" width=\"150\">\n          </el-table-column>\n          <el-table-column\n            prop=\"messageType\"\n            :formatter=\"stateFormatter\"\n            label=\"类型\"\n            width=\"120\"\n          ></el-table-column>\n        </el-table>\n        <el-pagination\n          style=\"text-align:right;margin-top:10px;\"\n          @size-change=\"handleSizeChange\"\n          @current-change=\"handleCurrentChange\"\n          :current-page=\"currentPage\"\n          :page-sizes=\"[10, 20, 50, 100]\"\n          :page-size=\"pageSize\"\n          background\n          layout=\"total, sizes, prev, pager, next, jumper\"\n          :total=\"messageData.total\"\n        >\n        </el-pagination>\n      </el-card>\n    </div>\n  </div>\n</template>\n\n<script>\nimport {\n  messageQuery,\n  postUpdataSign\n} from '@/pages/share-platform-front/api/message';\nimport {\n  getLabelAdjusted,\n  getReadMessage\n} from '@/pages/share-platform-front/api/user';\nimport {\n  Pagination,\n  Collapse,\n  CollapseItem,\n  TimePicker,\n  Badge,\n  Link\n} from 'element-ui';\nexport default {\n  name: 'Message',\n  components: {\n    [Pagination.name]: Pagination,\n    [Collapse.name]: Collapse,\n    [CollapseItem.name]: CollapseItem,\n    [TimePicker.name]: TimePicker,\n    [Badge.name]: Badge,\n    [Link.name]: Link\n  },\n  data() {\n    return {\n      imagelogo: require('../../assets/images/newlogo.png'),\n      imgSrcHome: require('../../assets/images/home.webp'),\n      imgSrcOne: require('../../assets/images/need.webp'),\n      imgSrcTwo: require('../../assets/images/message.webp'),\n      imgSrcThree: require('../../assets/images/personal.webp'),\n      messageData: {},\n      multipleSelection: [], //选中的列的数组集合\n      accountType: '',\n      isActive: true,\n      isDot: false,\n      ismessageDot: false,\n      currentPage: 1, //当前页码\n      pageSize: 10 //每页的数据数量\n    };\n  },\n  created() {\n    this.accountType = window.sessionStorage.getItem('accountType');\n    this.getmessageQuery();\n    this.getSignTip();\n  },\n  methods: {\n    linkBtn(val) {\n      console.log('跳转', val);\n      window.sessionStorage.setItem('linkData', JSON.stringify(val));\n      this.$router.push('/Demand');\n    },\n    //点击图标跳转页面\n    goPage(key) {\n      switch (key) {\n        case '1':\n          this.$router.push('/Search');\n          break;\n        case '2':\n          this.$router.push('/Demand');\n          break;\n        case '3':\n          this.$router.push('/Message');\n          break;\n        case '4':\n          this.$router.push('/Personal');\n          break;\n      }\n    },\n    //获取个人中心是否有待办事项\n    getSignTip() {\n      getLabelAdjusted(this.accountType).then(res => {\n        if (res.data == '0') {\n          this.isDot = false;\n        } else {\n          this.isDot = true;\n        }\n      });\n      getReadMessage(this.accountType).then(res => {\n        if (res.data.length) {\n          this.ismessageDot = true;\n        }\n      });\n    },\n    //退出登录\n    async logOut() {\n      window.localStorage.clear();\n      window.sessionStorage.clear();\n      await this.$store.dispatch('user/logout');\n      this.$router.push(`/login?redirect=${this.$route.fullPath}`);\n    },\n    //已读消息置灰\n    tableRowClassName({ row, rowIndex }) {\n      if (row.readState === 0) {\n        return 'warning-row';\n      }\n      return '';\n    },\n    //状态为0不可勾选\n    selectable(row, rowIndex) {\n      if (row.readState === 0) {\n        return false;\n      } else {\n        return true;\n      }\n    },\n    //列表勾选事件\n    changeFun(row, rowIndex) {\n      let rowData = [];\n      row.forEach((item, index) => {\n        rowData.push(item.id);\n      });\n      this.multipleSelection = rowData; // 返回的是选中的列的数组集合\n    },\n    //分页切换每页总条数\n    handleSizeChange(pagesize) {\n      this.pageSize = pagesize;\n      this.currentPage = 1;\n      const params = {\n        limit: this.pageSize,\n        offset: this.currentPage,\n        accountType: this.accountType\n      };\n      messageQuery(params).then(res => {\n        this.messageData = res.data;\n      });\n    },\n    //分页切换页码\n    handleCurrentChange(currentPage) {\n      this.currentPage = currentPage;\n      const params = {\n        limit: this.pageSize,\n        offset: (this.currentPage - 1) * this.pageSize,\n        accountType: this.accountType\n      };\n      messageQuery(params).then(res => {\n        this.messageData = res.data;\n      });\n    },\n    // 消息列表查询\n    getmessageQuery() {\n      const item = {\n        accountType: this.accountType,\n        limit: this.pageSize,\n        offset: this.currentPage\n      };\n      messageQuery(item).then(res => {\n        this.messageData = res.data;\n        // 遍历数组，判断是否有未读消息\n        const checkee = this.messageData.records.every(function(item) {\n          return item.readState === 0;\n        });\n        if (checkee) {\n          this.ismessageDot = false;\n        }\n      });\n    },\n    stateFormatter(row) {\n      return '站内消息'; //目前仅有该一种类型，后续可能做修改则用数据字典的接口\n    },\n    //标记已读消息\n    signReaded() {\n      const checkee = this.messageData.records.every(function(item) {\n        return item.readState == '0';\n      });\n      if (checkee) {\n        this.$message({\n          type: 'info',\n          message: '无未读消息!'\n        });\n      } else {\n        if (this.multipleSelection == '') {\n          this.$message({\n            type: 'info',\n            message: '请勾选未读消息!'\n          });\n        } else {\n          let queryData = {\n            accountType: this.accountType,\n            messageIds: this.multipleSelection\n          };\n          postUpdataSign(queryData)\n            .then(res => {\n              this.$message({\n                type: 'success',\n                message: '操作成功!'\n              });\n              this.multipleSelection = [];\n              this.getmessageQuery();\n            })\n            .catch(() => {\n              this.$message({\n                type: 'error',\n                message: '操作失败!'\n              });\n              this.multipleSelection = [];\n            });\n        }\n      }\n    },\n    signAllReaded() {\n      const checkee = this.messageData.records.every(function(item) {\n        return item.readState == '0';\n      });\n      if (checkee) {\n        this.$message({\n          type: 'info',\n          message: '无未读消息!'\n        });\n      } else {\n        let queryData = {\n          accountType: this.accountType,\n          messageIds: []\n        };\n        postUpdataSign(queryData)\n          .then(res => {\n            this.$message({\n              type: 'success',\n              message: '操作成功!'\n            });\n            this.ismessageDot = false;\n            this.multipleSelection = [];\n            this.getmessageQuery();\n          })\n          .catch(() => {\n            this.$message({\n              type: 'error',\n              message: '操作失败!'\n            });\n            this.multipleSelection = [];\n          });\n      }\n    }\n  }\n};\n</script>\n\n<style lang=\"less\" scoped>\n.loginRole {\n  margin: 0;\n  padding: 0;\n}\n.head-background {\n  min-width: 800px;\n  background: url('../../assets/images/navbg.webp') no-repeat;\n  background-size: cover;\n}\n.logo-img {\n  display: inline-block;\n  margin-left: 20px;\n  padding: 10px 0;\n}\n.nav {\n  width: 350px;\n  display: flex;\n  justify-content: space-evenly;\n  margin-top: 15px;\n  float: right;\n}\n.nav img {\n  width: 25px;\n  height: 25px;\n}\n.menu {\n  padding-top: 20px;\n  width: 80vw;\n  min-width: 800px;\n  margin: auto;\n}\n.el-divider {\n  margin: 0;\n  padding: 0;\n}\n.el-span {\n  display: inline-block;\n  font-size: 1rem;\n  font-weight: bold;\n  margin-top: 15px;\n  margin-bottom: 20px;\n}\n</style>\n<style>\n.el-table .warning-row {\n  /* background: rgb(202, 201, 201); */\n  color: rgb(206, 202, 202);\n}\n.el-tooltip__popper {\n  max-width: 40%;\n} /*设置显示隐藏部分内容，按50%显示*/\n</style>\n"]}]}