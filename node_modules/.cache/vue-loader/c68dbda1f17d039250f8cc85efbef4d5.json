{"remainingRequest":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/fuyueyi/Desktop/practice/mutilwap/src/pages/charity-foundation/views/student/components/ReportDialog/index.vue?vue&type=style&index=0&id=54fdaac0&lang=less&scoped=true&","dependencies":[{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/src/pages/charity-foundation/views/student/components/ReportDialog/index.vue","mtime":1627979214291},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/less-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/style-resources-loader/lib/index.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgouaW1wb3J0LWRhdGEtY29udGVudCB7CiAgLnJlcG9ydGJveCB7CiAgICBkaXNwbGF5OiBmbGV4OwogICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICB3aWR0aDogMTAwJTsKICAgIGltZyB7CiAgICAgIHdpZHRoOiAxMDAlOwogICAgfQogIH0KICAuYXJyb3cgc3BhbiB7CiAgICBjdXJzb3I6IHBvaW50ZXI7CiAgfQogIC5ub3RoYXZJbWcgewogICAgY29sb3I6ICM5MDkzOTk7CiAgICBkaXNwbGF5OiBmbGV4OwogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOwogICAgbWluLWhlaWdodDogODBweDsKICAgIGZvbnQtc2l6ZTogMTRweDsKICB9CiAgLmJ0bmJveCB7CiAgICBtYXJnaW4tdG9wOiAyMHB4OwogICAgZGlzcGxheTogZmxleDsKICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOwogICAgLmF2YXRhci11cGxvYWRlciB7CiAgICAgIG1hcmdpbjogMCAyMHB4OwogICAgfQogIH0KfQo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/pages/charity-foundation/views/student/components/ReportDialog","sourcesContent":["<template>\n  <el-dialog\n    :visible.sync=\"visible\"\n    :title=\"title || ''\"\n    center\n    :close-on-click-modal=\"false\"\n    :close-on-press-escape=\"false\"\n    v-on=\"$listeners\"\n    @closed=\"onClosed\"\n    width=\"60%\"\n  >\n    <div class=\"import-data-content\">\n      <div\n        class=\"reportbox\"\n        v-if=\"\n          imgUrl &&\n            (imgType === 'jpg' ||\n              imgType === 'JPG' ||\n              imgType === 'png' ||\n              imgType === 'PNG' ||\n              imgType === 'gif' ||\n              imgType === 'GIF' ||\n              imgType === 'jpeg' ||\n              imgType === 'JPEG' ||\n              imgType === 'bmp' ||\n              imgType === 'BMP')\n        \"\n      >\n        <img :src=\"imgUrl ? imgUrl : ''\" alt=\"\" />\n      </div>\n      <div v-else-if=\"pdfUrl && (imgType === 'pdf' || imgType === 'PDF')\">\n        <p class=\"arrow\">\n          <span\n            @click=\"changePdfPage(0)\"\n            class=\"turn\"\n            :class=\"{ grey: currentPage == 1 }\"\n            >上一页</span\n          >\n          {{ currentPage }} / {{ pageCount }}\n          <span\n            @click=\"changePdfPage(1)\"\n            class=\"turn\"\n            :class=\"{ grey: currentPage == pageCount }\"\n            >下一页</span\n          >\n        </p>\n        <pdf\n          :src=\"pdfUrl\"\n          :page=\"currentPage\"\n          @num-pages=\"pageCount = $event\"\n          @page-loaded=\"currentPage = $event\"\n          @loaded=\"loadPdfHandler\"\n        ></pdf>\n      </div>\n      <div\n        class=\"reportbox\"\n        v-else-if=\"\n          imgUrl &&\n            (imgType === 'xls' ||\n              imgType === 'xlsx' ||\n              imgType === 'doc' ||\n              imgType === 'docx' ||\n              imgType === 'XLS' ||\n              imgType === 'XLSX' ||\n              imgType === 'DOC' ||\n              imgType === 'DOCX')\n        \"\n      >\n        文件\"{{ imgName }}\"不支持在线查看，请\n        <p\n          style=\"color: #409EFF;cursor: pointer;padding:0 5px\"\n          @click=\"exportBtn\"\n        >\n          下载\n        </p>\n        后观看\n      </div>\n      <div v-else class=\"nothavImg\">暂无数据，请导入后查看</div>\n      <!-- <div v-else class=\"nothavImg\">暂无图片</div> -->\n      <div class=\"btnbox\">\n        <el-upload\n          class=\"avatar-uploader\"\n          action=\"\"\n          :show-file-list=\"false\"\n          :multiple=\"false\"\n          :before-upload=\"beforeAvatarUpload\"\n          :http-request=\"ajaxUploadSingle\"\n          accept=\".jpg,.jpeg,.png,.bmp,.doc,.docx,.xls,.xlsx,.wps,.pdf,.JPG,.JPEG,.PBG,.BMP,.DOC,.DOCX,.XLS,.XLSX,.WPS,.PDF\"\n        >\n          <el-button type=\"primary\">导入</el-button>\n        </el-upload>\n        <el-button\n          type=\"primary\"\n          @click=\"exportBtn\"\n          :disabled=\"imgUrl.length <= 0\"\n          >导出</el-button\n        >\n      </div>\n    </div>\n  </el-dialog>\n</template>\n\n<script>\nimport axios from '@/plugins/axios';\nimport { Button, Dialog, Upload } from 'element-ui';\nimport { ajaxUploadSingle } from '@/pages/charity-foundation/api/file/index';\nimport {\n  updateStudentById,\n  downloadFile\n} from '@/pages/charity-foundation/api/sutdent/index';\nimport pdf from 'vue-pdf';\nexport default {\n  name: 'ReportDialog',\n  components: {\n    [Button.name]: Button,\n    [Dialog.name]: Dialog,\n    [Upload.name]: Upload,\n    pdf\n  },\n  props: {\n    /**\n     * 成功回调\n     */\n    onSuccess: {\n      type: Function\n    }\n  },\n  data() {\n    return {\n      visible: false, // 是否显示模态框\n      preservationBtn: true,\n      title: '',\n      editItem: null,\n      imgUrl: '',\n      imgName: '',\n      pdfUrl: '',\n      imgType: '',\n      currentPage: 0, // pdf文件页码\n      pageCount: 0, // pdf文件总页数\n      loading: false\n    };\n  },\n  watch: {},\n  methods: {\n    /**\n     * 显示模态框动画结束\n     *  @param {Object}} editItem 修改项\n     *  @param {String}} imgUrlKey 图片URl键值\n     *  @param {String}} imgNameKey 图片名称键值\n     */\n    show(editItem, imgUrlKey, imgNameKey) {\n      this.editItem = JSON.parse(JSON.stringify(editItem));\n      this.visible = true;\n      this.imgUrl = this.editItem[imgUrlKey] ? this.editItem[imgUrlKey] : '';\n      this.imgName = this.editItem[imgNameKey] ? this.editItem[imgNameKey] : '';\n      let type = this.imgUrl.split('.');\n      this.imgType = type[type.length - 1];\n      // pdf做特殊处理\n      if (this.imgType === 'PDF' || this.imgType === 'pdf') {\n        let str = this.imgUrl.indexOf('/');\n        for (let i = 0; i < 2; i++) {\n          str = this.imgUrl.indexOf('/', str + 1);\n        }\n        this.pdfUrl = `/pdf${this.imgUrl.substring(str)}`;\n      }\n      console.log(editItem, this.imgUrl.length, this.imgUrl, this.imgName);\n    },\n    //初始化新建表单的数据默认值\n    initDialogFormData() {\n      this.editItem = null;\n      this.imgUrl = '';\n      this.imgName = '';\n      this.imgType = '';\n      this.pdfUrl = '';\n    },\n    /**\n     * 关闭模态框动画结束\n     */\n    onClosed() {\n      this.initDialogFormData();\n      this.visible = false;\n      this.$emit('close');\n    },\n    closed() {\n      this.visible = false;\n    },\n    preservation() {\n      let params = {\n        id: this.editItem.id,\n        healthReport: this.imgUrl,\n        healthName: this.imgName\n      };\n      updateStudentById(params).then(res => {\n        this.$message({\n          type: 'success',\n          message: '上传成功'\n        });\n      });\n    },\n    exportBtn() {\n      // window.open(this.imgUrl);\n      let params = {\n        fileName: this.imgName,\n        filePath: this.imgUrl\n      };\n      downloadFile(params).then(res => {\n        const blob = new Blob([res], {\n          type: 'application/vnd.ms-excel'\n        });\n        let link = document.createElement('a');\n        link.href = URL.createObjectURL(blob);\n        link.setAttribute('download', `${this.imgName}`);\n        link.click();\n        link = null;\n        this.$message.success('下载成功');\n      });\n    },\n    /**\n     * 上传图片限制\n     */\n    beforeAvatarUpload(file) {\n      const isLimt = file.size / 1024 / 1024;\n      if (!isLimt) {\n        this.$message.error('上传文件不能超过1M!');\n      }\n      return isLimt;\n    },\n    ajaxUploadSingle(file) {\n      let formData = new FormData();\n      formData.append('file', file.file);\n      formData.append('appid', 'oss54y7iu');\n      formData.append('appsecret', '1k58q6iw');\n      ajaxUploadSingle(formData).then(async res => {\n        if (Number(res.code) === 8200) {\n          this.imgUrl = res.data[0].url;\n          this.imgName = res.data[0].originalName;\n          let type = this.imgUrl.split('.');\n          this.imgType = type[type.length - 1];\n          // pdf做特殊处理\n          if (this.imgType === 'PDF' || this.imgType === 'pdf') {\n            let str = this.imgUrl.indexOf('/');\n            for (let i = 0; i < 2; i++) {\n              str = this.imgUrl.indexOf('/', str + 1);\n            }\n            this.pdfUrl = `/pdf${this.imgUrl.substring(str)}`;\n          }\n          await this.preservation();\n          // this.preservationBtn = false;\n        }\n      });\n    },\n    // 改变PDF页码,val传过来区分上一页下一页的值,0上一页,1下一页\n    changePdfPage(val) {\n      // console.log(val)\n      if (val === 0 && this.currentPage > 1) {\n        this.currentPage--;\n        // console.log(this.currentPage)\n      }\n      if (val === 1 && this.currentPage < this.pageCount) {\n        this.currentPage++;\n        // console.log(this.currentPage)\n      }\n    },\n\n    // pdf加载时\n    loadPdfHandler(e) {\n      this.loading = true;\n      this.currentPage = 1; // 加载的时候先加载第一页\n      this.loading = false;\n    }\n  }\n};\n</script>\n\n<style lang=\"less\" scoped>\n.import-data-content {\n  .reportbox {\n    display: flex;\n    justify-content: center;\n    width: 100%;\n    img {\n      width: 100%;\n    }\n  }\n  .arrow span {\n    cursor: pointer;\n  }\n  .nothavImg {\n    color: #909399;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    min-height: 80px;\n    font-size: 14px;\n  }\n  .btnbox {\n    margin-top: 20px;\n    display: flex;\n    justify-content: center;\n    .avatar-uploader {\n      margin: 0 20px;\n    }\n  }\n}\n</style>\n"]}]}