{"remainingRequest":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/fuyueyi/Desktop/practice/mutilwap/src/pages/school-book/views/messageManage/MessageReply.vue?vue&type=style&index=0&id=7e2a3090&lang=less&scoped=true&","dependencies":[{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/src/pages/school-book/views/messageManage/MessageReply.vue","mtime":1627979214328},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/less-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/style-resources-loader/lib/index.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoucmVhc29uLWlucHV0IHsKICB3aWR0aDogMTk4cHg7Cn0K"},{"version":3,"sources":["MessageReply.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwqBA;AACA;AACA","file":"MessageReply.vue","sourceRoot":"src/pages/school-book/views/messageManage","sourcesContent":["<template>\n  <div class=\"app-container\">\n    <b-table\n      ref=\"bTable\"\n      loading\n      empty-text=\"留言回复暂无数据\"\n      :headers=\"headers\"\n      :initialFormData=\"initialFormData\"\n      :form-items=\"formItems\"\n      @reset-form=\"resetForm\"\n      :ajax-get-data=\"ajaxGetData\"\n      :toolbars=\"toolbars\"\n      :show-column=\"false\"\n      :header-cell-style=\"{ 'text-align': 'center' }\"\n    >\n      <template slot=\"column|status\" slot-scope=\"{ row }\">\n        <span>{{\n          ($D('SHZT').find(item => item.value == row.status) &&\n            $D('SHZT').find(item => item.value == row.status)['label']) ||\n            '-'\n        }}</span>\n      </template>\n      <template slot=\"column|content\" slot-scope=\"{ row }\">\n        <span v-if=\"row.content\" v-html=\"row.content\"></span>\n        <span v-else>-</span>\n      </template>\n      <template slot=\"column|image\" slot-scope=\"{ row }\">\n        <span\n          class=\"custom-column\"\n          v-if=\"row.images && getFileList(row.images)['list'].length > 0\"\n        >\n          <el-image\n            style=\"width: 100px; height: 100px\"\n            :src=\"getFileList(row.images)['list'][0].url\"\n            :preview-src-list=\"getFileList(row.images)['urlList']\"\n            fit=\"contain\"\n          >\n          </el-image>\n          <span class=\"custom-number\">\n            {{ getFileList(row.images)['list'].length }}\n          </span>\n        </span>\n        <span v-else>\n          -\n        </span>\n      </template>\n      <template slot=\"column|file\" slot-scope=\"{ row }\">\n        <span v-if=\"row.files && getFileList(row.files)['list'].length > 0\">\n          <span class=\"custom-file text-decoration\">\n            <!-- <el-button\n              size=\"mini\"\n              type=\"text\"\n              @click=\"downloadFile(getFileList(row.files)['list'][0])\"\n            > -->\n            {{ getFileList(row.files)['list'][0].name }}\n            <!-- </el-button> -->\n          </span>\n          <!-- <el-popover placement=\"right\" trigger=\"click\">\n            <div\n              v-for=\"item in getFileList(row.files)['list']\"\n              :key=\"item.name + item.url\"\n            >\n              <span\n                class=\"custom-number text-decoration\"\n                @click=\"downloadFile(item)\"\n              >\n                {{ item.name }}</span\n              >\n            </div>\n            <span slot=\"reference\">\n              <span class=\"custom-number text-decoration\">\n                {{ getFileList(row.files)['list'].length }}</span\n              >\n            </span>\n          </el-popover> -->\n        </span>\n        <span v-else>\n          -\n        </span>\n      </template>\n      <template slot=\"column|commentCount\" slot-scope=\"{ row }\">\n        <el-button size=\"mini\" type=\"text\" @click.stop=\"toReply(row)\">\n          {{ row.commentCount || 0 }}条回复</el-button\n        >\n      </template>\n      <template slot=\"column|unreviewedCommentCount\" slot-scope=\"{ row }\">\n        <el-button\n          size=\"mini\"\n          type=\"text\"\n          @click.stop=\"toReply(row, 'unreview')\"\n        >\n          {{ row.unreviewedCommentCount || 0 }}条回复</el-button\n        >\n      </template>\n      <template slot=\"column|opera\" slot-scope=\"{ row }\">\n        <div>\n          <el-button\n            v-auth=\"['check-message']\"\n            size=\"small\"\n            type=\"text\"\n            :disabled=\"row.status != 0\"\n            @click.stop=\"onExamineQuest(row)\"\n            >审核</el-button\n          >\n          <el-button\n            v-auth=\"['reply-message']\"\n            size=\"small\"\n            type=\"text\"\n            @click.stop=\"onReplyQuest(row, 'preview')\"\n            >回复</el-button\n          >\n          <el-button\n            v-auth=\"['delete-message']\"\n            size=\"small\"\n            type=\"text\"\n            @click.stop=\"deleteQuest(row, 'delete')\"\n            >删除</el-button\n          >\n        </div>\n      </template>\n    </b-table>\n    <!-- 审核弹窗 -->\n    <el-dialog\n      width=\"560px\"\n      center\n      :visible.sync=\"dialogForm.visible\"\n      :title=\"dialogTitle\"\n      :close-on-click-modal=\"false\"\n      :close-on-press-escape=\"false\"\n      :before-close=\"onBeforeClose\"\n      @close=\"onCloseForm\"\n    >\n      <c-dynamic-form\n        ref=\"elForm\"\n        :form-data=\"dialogFormData\"\n        :form-items=\"dialogFormItems\"\n        :form-attrs=\"dialogFormAttrs\"\n        @change-model=\"model => (dialogFormData = model)\"\n      ></c-dynamic-form>\n      <span slot=\"footer\" class=\"dialog-footer\">\n        <el-button\n          size=\"small\"\n          :loading=\"dialogForm.loading\"\n          @click=\"onCloseForm\"\n        >\n          取消\n        </el-button>\n        <el-button\n          size=\"small\"\n          type=\"primary\"\n          :loading=\"dialogForm.loading\"\n          @click.stop.prevent=\"onSubmitForm\"\n        >\n          确定\n        </el-button>\n      </span>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport BTable from '@/components/business/BTable';\nimport CDynamicForm from '@/components/common/CDynamicForm/index';\nimport { Dialog, Button, Message } from 'element-ui';\nimport config from './../../config';\nimport {\n  getMessageList,\n  examMessage,\n  deleteMessage,\n  replyMessage\n} from './../../api/data';\nexport default {\n  name: 'MessageReply',\n  components: {\n    BTable,\n    CDynamicForm,\n    [Dialog.name]: Dialog,\n    [Button.name]: Button\n  },\n  props: {},\n\n  data() {\n    return {\n      //图片前缀\n      // 表单列\n      headers: [\n        {\n          type: 'selection'\n        },\n        {\n          type: 'index',\n          label: '序号'\n        },\n        {\n          label: '回复内容',\n          prop: 'content',\n          fixed: 'left',\n          width: '150',\n          'show-overflow-tooltip': true,\n          colType: 'column'\n        },\n        {\n          label: '图片',\n          prop: 'image',\n          width: '150',\n          colType: 'column'\n        },\n        {\n          label: '附件',\n          prop: 'file',\n          colType: 'column'\n        },\n        {\n          label: '点赞数',\n          prop: 'likeCount'\n        },\n        {\n          label: '管理员回复',\n          prop: 'replyContent'\n        },\n        {\n          label: '编辑时间',\n          width: '160',\n          prop: 'createTime',\n          'value-format': 'yyyy-MM-dd'\n        },\n        {\n          label: '审核时间',\n          width: '160',\n          prop: 'reviewTime'\n        },\n        {\n          label: '回复时间',\n          width: '160',\n          prop: 'adminAnswerTime'\n        },\n        {\n          label: '状态',\n          prop: 'status',\n          colType: 'column'\n        },\n        {\n          label: '操作',\n          width: '120',\n          fixed: 'right',\n          slotName: 'opera',\n          colType: 'column'\n          // colType: 'btns',\n          // btns: [\n          //   {\n          //     label: '审核',\n          //     type: 'text',\n          //     size: 'mini',\n          //     click: this.onExamineQuest\n          //   },\n          //   {\n          //     label: '回复',\n          //     type: 'text',\n          //     size: 'mini',\n          //     click: this.onReplyQuest\n          //   },\n          //   {\n          //     label: '删除',\n          //     type: 'text',\n          //     size: 'mini',\n          //     click: this.deleteQuest\n          //   }\n          // ]\n        }\n      ],\n      // 查询表单配置\n      formItems: [\n        {\n          type: 'input',\n          prop: 'content',\n          label: '回复内容：',\n          attrs: [\n            {\n              placeholder: '回复内容'\n            }\n          ]\n        },\n        // {\n        //   type: 'select',\n        //   prop: 'isImg',\n        //   label: '是否有图片：',\n        //   options: [\n        //     { label: '是', value: true },\n        //     { label: '否', value: false }\n        //   ]\n        // },\n        // {\n        //   type: 'select',\n        //   prop: 'isFiled',\n        //   label: '是否有附件：',\n        //   options: [\n        //     { label: '是', value: true },\n        //     { label: '否', value: false }\n        //   ]\n        // },\n        {\n          type: 'select',\n          prop: 'status',\n          label: '状态：',\n          options: this.$D('SHZT')\n        },\n        {\n          type: 'date-picker',\n          prop: 'editTime',\n          label: '编辑时间：',\n          attrs: {\n            type: 'daterange',\n            'value-format': 'yyyy-MM-dd',\n            // TODO 时间格式\n            'start-placeholder': '开始日期',\n            'end-placeholder': '结束日期'\n          }\n        },\n        {\n          type: 'date-picker',\n          prop: 'reviewTime',\n          label: '审核时间：',\n          attrs: {\n            type: 'daterange',\n            'value-format': 'yyyy-MM-dd',\n            // TODO 时间格式\n            'start-placeholder': '开始日期',\n            'end-placeholder': '结束日期'\n          }\n        }\n      ],\n      dialogTitle: '',\n      dialogType: '',\n      // 工具栏\n      toolbars: [\n        {\n          label: '批量审核',\n          click: this.onExamineQuest,\n          hidden: () => !this.$has(['check-message-batch'])\n        },\n        {\n          label: '批量删除',\n          click: this.deleteQuest,\n          hidden: () => !this.$has(['delete-message-batch'])\n        }\n      ],\n      //弹窗表单\n      dialogForm: {\n        visible: false,\n        loading: false\n      },\n      replyId: null,\n      //弹窗表单属性\n      dialogFormAttrs: {\n        'label-position': 'right',\n        'label-width': '130px',\n        rules: {\n          code: [\n            {\n              required: true,\n              trigger: 'change',\n              message: '请选择审核结果'\n            }\n          ],\n          nopassKey: [\n            {\n              required: true,\n              trigger: 'change',\n              message: '请选择审核不通过原因'\n            }\n          ],\n          nopassReason: [\n            {\n              required: true,\n              trigger: 'change',\n              message: '请输入原因'\n            }\n          ],\n          answer: [\n            {\n              required: true,\n              trigger: 'change',\n              message: '请输入回复'\n            }\n          ]\n        }\n      },\n      //弹窗表单默认值（编辑时传入）\n      dialogFormData: {},\n      initialFormData: {},\n      //表格选中行数\n      selectedRows: null\n    };\n  },\n  computed: {\n    dialogFormItems() {\n      let dialogType = this.dialogType;\n      let result;\n      switch (dialogType) {\n        case 'exam':\n          result = [\n            {\n              type: 'select',\n              prop: 'code',\n              label: '审核结果：',\n              options: this.$D('SHZT').filter(item => item.value != '0'),\n              attrs: {}\n            }\n            // {\n            //   type: 'select',\n            //   prop: 'nopassKey',\n            //   hidden:\n            //     !this.dialogFormData.code || this.dialogFormData.code != '1',\n            //   label: '审核不通过原因：',\n            //   options: this.$D('BTGYY'),\n            //   attrs: {}\n            // },\n            // {\n            //   type: 'input',\n            //   prop: 'nopassReason',\n            //   hidden:\n            //     !this.dialogFormData.code ||\n            //     this.dialogFormData.code == 2 ||\n            //     !this.dialogFormData.nopassKey ||\n            //     this.dialogFormData.nopassKey != '4',\n            //   label: '自定义原因：',\n            //   attrs: {\n            //     placderholder: '15字以内',\n            //     maxlength: '15'\n            //   }\n            // }\n          ];\n          break;\n        case 'reply':\n          result = [\n            {\n              type: 'input',\n              prop: 'answer',\n              label: '回复内容：',\n              attrs: {\n                placderholder: '30字以内',\n                maxlength: 30\n              }\n            }\n          ];\n          break;\n      }\n      return result;\n    }\n  },\n  watch: {},\n  created() {\n    const { replyId, unreview } = this.$route.query;\n    this.replyId = replyId;\n    if (unreview) {\n      this.initialFormData = {\n        status: unreview\n      };\n    }\n  },\n  mounted() {},\n  methods: {\n    //重置表单并查询\n    resetForm() {\n      this.$refs['bTable'].onQueryForm();\n    },\n    /**\n     * 请求table数据\n     */\n    ajaxGetData(data) {\n      const {\n        // pageNum,\n        // pageSize,\n        // content,\n        // status,\n        // isImg,\n        // isFiled,\n        editTime,\n        reviewTime\n      } = data;\n      // const params = {\n      //   current: pageNum,\n      //   size: pageSize,\n      //   startDate: (editTime && editTime[0]) || null,\n      //   endDate: (editTime && editTime[1]) || null,\n      //   startReviewTime: (reviewTime && reviewTime[0]) || null,\n      //   endReviewTime: (reviewTime && reviewTime[1]) || null,\n      //   content: content,\n      //   status: status,\n      //   isImg: isImg,\n      //   isFiled: isFiled\n      // };\n      const params = Object.assign(\n        {\n          startDate: (editTime && editTime[0]) || null,\n          endDate: (editTime && editTime[1]) || null,\n          startReviewTime: (reviewTime && reviewTime[0]) || null,\n          endReviewTime: (reviewTime && reviewTime[1]) || null\n        },\n        data,\n        { editTime: null, reviewTime: null, id: this.replyId }\n      );\n      return getMessageList(params);\n      // return new Promise(resolve => {\n      //   setTimeout(() => {\n      //     let list = [];\n      //     for (let i = 0; i < 10; i++) {\n      //       list.push({\n      //         id: i,\n      //         num: i,\n      //         typeCode: 'typeCode' + i,\n      //         typeName: '分类名称' + i,\n      //         sort: '排序值' + i,\n      //         time: '编辑时间'\n      //       });\n      //     }\n      //     resolve({\n      //       status: 200,\n      //       data: {\n      //         total: 10,\n      //         records: list\n      //       }\n      //     });\n      //   }, 500);\n      // });\n    },\n    //处理图片文件\n    getFileList(data) {\n      const list = JSON.parse(data);\n      let urlList = [];\n      for (let i = 0; i < list.length; i++) {\n        list[i].url = config.FILE_PREFIX + list[i].url;\n        urlList.push(list[i].url);\n      }\n      return {\n        list: list,\n        urlList: urlList\n      };\n    },\n    //下载文件\n    downloadFile(item) {\n      window.open(item.url);\n    },\n    /**\n     * 初始化新建表单的数据默认值\n     */\n    initDialogFormData() {\n      this.dialogFormData = {};\n    },\n    /**\n     * 关闭窗口前处理\n     */\n    onBeforeClose(done) {\n      if (this.dialogForm.loading) return;\n      done();\n    },\n    /**\n     * 表单关闭前清除校验并重置数据\n     */\n    onCloseForm() {\n      this.dialogForm.visible = false;\n      this.dialogForm.loading = false;\n      // this.$refs['dialogForm'].resetFields();\n      this.initDialogFormData();\n      this.$refs['elForm'].resetFields();\n    },\n    /**\n     * 提交表单\n     */\n    onSubmitForm() {\n      this.$refs['elForm'].validate().then(() => {\n        if (this.dialogType === 'exam') {\n          examMessage(\n            Object.assign({ ids: this.gerSelectIds() }, this.dialogFormData)\n          ).then(res => {\n            this.submitDone();\n          });\n        } else if (this.dialogType === 'reply') {\n          replyMessage(\n            Object.assign({ id: this.gerSelectIds() }, this.dialogFormData)\n          ).then(res => {\n            this.submitDone();\n          });\n        }\n      });\n\n      // this.$refs['elForm'].validate().then(() => {\n      //   // 校验成功\n      //   examMessage({\n      //     ids: this.gerSelectIds(),\n      //     code: this.dialogFormData.result,\n      //     nopassReason: ''\n      //   });\n      //   this.dialogForm.loading = false;\n      //   this.$refs.bTable.ajaxGetTableDataByPage();\n      // });\n    },\n    submitDone() {\n      this.dialogForm.visible = false;\n      this.dialogForm.loading = false;\n      this.selectedRows = [];\n      this.initDialogFormData();\n      this.$refs.bTable.ajaxGetTableDataByPage();\n    },\n    //获取选中 Id\n    gerSelectIds() {\n      let rows = '';\n      if (!this.selectedRows) {\n        return;\n      }\n      if (Array.isArray(this.selectedRows)) {\n        for (let i = 0; i < this.selectedRows.length; i++) {\n          rows += this.selectedRows[i].id + ',';\n        }\n      } else {\n        rows = this.selectedRows.id;\n      }\n      return rows;\n    },\n    /**\n     * 审核问题\n     */\n    onExamineQuest(rows) {\n      this.dialogType = 'exam';\n      this.dialogTitle = '审核';\n      this.selectedRows = rows;\n      if (!rows || rows.length === 0) {\n        this.$message('至少选择一个留言');\n        return;\n      }\n      this.dialogFormData = {\n        nopassReason: ''\n      };\n      this.dialogForm.visible = true;\n    },\n    onReplyQuest(rows) {\n      this.dialogType = 'reply';\n      this.dialogTitle = '回复';\n      this.selectedRows = rows;\n      console.log('rows', rows);\n      if (!rows || rows.length === 0) {\n        this.$message('至少选择一个留言');\n        return;\n      }\n      this.dialogForm.visible = true;\n    },\n    /**\n     * 删除问题\n     */\n    deleteQuest(rows) {\n      console.log(rows);\n      if (!rows || rows.length === 0) {\n        this.$message('至少选择一个留言');\n        return;\n      }\n      this.$confirm('确定要删除当前留言?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        this.selectedRows = rows;\n        deleteMessage({ ids: this.gerSelectIds() }).then(res => {\n          this.$refs.bTable.ajaxGetTableDataByPage();\n          this.selectedRows = [];\n          this.$message({\n            type: 'success',\n            message: '删除成功!'\n          });\n        });\n      });\n    },\n    //跳转回复\n    toReply() {\n      console.log('reply');\n    }\n  }\n};\n</script>\n\n<style lang=\"less\" scoped>\n.reason-input {\n  width: 198px;\n}\n</style>\n"]}]}