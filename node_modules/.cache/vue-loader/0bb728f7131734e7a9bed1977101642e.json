{"remainingRequest":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/fuyueyi/Desktop/practice/mutilwap/src/pages/executive-serveh5/views/filler/Fill.vue?vue&type=style&index=0&id=0ae46895&lang=less&scoped=true&","dependencies":[{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/src/pages/executive-serveh5/views/filler/Fill.vue","mtime":1627979214302},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/less-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/style-resources-loader/lib/index.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoudGlwcyB7CiAgcG9zaXRpb246IHJlbGF0aXZlOwogIGJhY2tncm91bmQ6ICNmZWZjZWM7CiAgYm94LXNpemluZzogYm9yZGVyLWJveDsKICBwYWRkaW5nOiAwLjJyZW0gMC42MnJlbTsKICBjb2xvcjogI2Y4NmUyMTsKICBsaW5lLWhlaWdodDogMC4zMnJlbTsKICBmb250LXNpemU6IDAuMjhyZW07Cn0KLnRpcHMtaXRlbSB7CiAgcGFkZGluZy1sZWZ0OiAwLjM2cmVtOwogIHBvc2l0aW9uOiByZWxhdGl2ZTsKfQoudGlwcy1pdGVtLW51bWJlciB7CiAgcG9zaXRpb246IGFic29sdXRlOwogIGxlZnQ6IDA7Cn0KLndhcm5pbmcgewogIHdpZHRoOiAwLjMycmVtOwogIGhlaWdodDogMC4zMnJlbTsKICBib3JkZXItcmFkaXVzOiA1MCU7CiAgYmFja2dyb3VuZDogI2Y4NmUyMTsKICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgcG9zaXRpb246IGFic29sdXRlOwogIGxlZnQ6IDAuMnJlbTsKfQoud2FybmluZzo6YmVmb3JlIHsKICBjb250ZW50OiAnISc7CiAgZm9udC1zaXplOiAwLjE4cmVtOwogIGNvbG9yOiAjZmZmOwp9Ci5jbG9zZS10aXBzIHsKICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgdG9wOiAwLjJyZW07CiAgcmlnaHQ6IDAuMnJlbTsKfQouc2VydmUtY29tcGFueSB7CiAgbWFyZ2luLXRvcDogMC4ycmVtOwp9Ci5zZXJ2ZS1uYW1lIHsKICBoZWlnaHQ6IDQ0cHg7CiAgYmFja2dyb3VuZDogI2ZmZjsKICBtYXJnaW4tdG9wOiAwLjJyZW07CiAgL2RlZXAvLnZhbi1maWVsZF9fY29udHJvbCB7CiAgICBmb250LXNpemU6IDAuMjhyZW07CiAgICBsaW5lLWhlaWdodDogMjRweDsKICB9Cn0KLnNlcnZlLWFkZCB7CiAgbWFyZ2luLXRvcDogMC4ycmVtOwogIC8vIHBhZGRpbmc6IDAuMXJlbSAwOwogIC9kZWVwLy52YW4tZmllbGRfX2NvbnRyb2wgewogICAgaGVpZ2h0OiAzLjI2cmVtOwogICAgYmFja2dyb3VuZDogI2Y2ZjZmNjsKICAgIGJvcmRlci1yYWRpdXM6IDRweDsKICAgIHBhZGRpbmc6IDAuMnJlbTsKICAgIGZvbnQtc2l6ZTogMC4yOHJlbTsKICAgIGxpbmUtaGVpZ2h0OiAwLjMycmVtOwogIH0KfQouc2VydmUtZmlsZSB7CiAgcGFkZGluZzogMC4zcmVtOwogIGJhY2tncm91bmQ6ICNmZmY7CiAgbWFyZ2luLXRvcDogMC4ycmVtOwp9Ci5zZXJ2ZS1maWxlLWFkZCB7CiAgZGlzcGxheTogaW5saW5lLWJsb2NrOwogIHdpZHRoOiAxLjU4cmVtOwogIGhlaWdodDogMS41OHJlbTsKICBsaW5lLWhlaWdodDogMS41OHJlbTsKICBib3JkZXI6IDFweCBzb2xpZCAjZGRkZGRkOwogIGJvcmRlci1yYWRpdXM6IDZweDsKICBkaXNwbGF5OiBmbGV4OwogIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7Cn0KLnBsdXMgewogIGZvbnQtc2l6ZTogMC42NHJlbTsKICBjb2xvcjogI2NjYzsKfQouYXBwbHktYnRuLXdyYXBwZXIgewogIHBhZGRpbmc6IDAuM3JlbTsKfQouYXBwbHktYnRuIHsKICBoZWlnaHQ6IDAuOTRyZW07CiAgbGluZS1oZWlnaHQ6IDAuOTRyZW07CiAgdGV4dC1hbGlnbjogY2VudGVyOwogIGNvbG9yOiAjZmZmOwogIGJvcmRlci1yYWRpdXM6IDAuMXJlbTsKICBiYWNrZ3JvdW5kOiAjZmY5ODAwOwp9Ci5wbGFjZWhvbGRlciB7CiAgY29sb3I6ICNjOWNhY2Q7Cn0KL2RlZXAvLnZhbi1maWVsZF9fY29udHJvbCB7CiAgY29sb3I6IHJnYmEoMCwgMCwgMCwgMC42NCk7Cn0KL2RlZXAvLmNsb3NlLXRpcHMgewogIGNvbG9yOiByZ2JhKDAsIDAsIDAsIDAuNjQpOwp9Ci9kZWVwLy52YW4tY2VsbF9fdmFsdWUtLWFsb25lIHsKICBjb2xvcjogcmdiYSgwLCAwLCAwLCAwLjY0KTsKfQo="},{"version":3,"sources":["Fill.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4RA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Fill.vue","sourceRoot":"src/pages/executive-serveh5/views/filler","sourcesContent":["<template>\n  <div>\n    <div class=\"tips\" v-if=\"showTips\">\n      <div class=\"warning\"></div>\n      <div class=\"tips-item\">\n        <span class=\"tips-item-number\">1、</span>\n        需求指下属公司和机构在业务开展中遇到的问题或困难，所在板块内部无法自行消化解决，或集团总部能够更高效协调解决\n      </div>\n      <div class=\"tips-item\">\n        <span class=\"tips-item-number\">2、</span>\n        描述需求关键点即可，具体情况由抢单人与下单人详细对接；\n      </div>\n      <div class=\"tips-item\">\n        <span class=\"tips-item-number\">3、</span>\n        订单提交后，先由各版块总负责人或下属公司、机构负责人审核。审核通过后，方能进入总部高层抢单池\n      </div>\n      <van-icon name=\"cross\" @click=\"closeTips\" class=\"close-tips\" />\n    </div>\n    <div class=\"serve-company\">\n      <van-cell\n        v-if=\"plateList.length > 1\"\n        class=\"fill-content\"\n        is-link\n        @click=\"showPicker = true\"\n      >\n        <div :class=\"{ placeholder: !this.plateId }\">\n          {{ this.plateId ? this.plateName : '请选择所属公司' }}\n        </div>\n      </van-cell>\n    </div>\n    <van-popup v-model=\"showPicker\" position=\"bottom\">\n      <van-picker\n        title=\"所属公司\"\n        show-toolbar\n        :columns=\"columns\"\n        @confirm=\"onConfirm\"\n        @cancel=\"onCancel\"\n      />\n    </van-popup>\n    <div class=\"serve-name\">\n      <van-field\n        v-model=\"serveName\"\n        label=\"\"\n        @blur=\"cancelInput\"\n        maxlength=\"20\"\n        placeholder=\"一句话概括需求\"\n      />\n    </div>\n    <div class=\"serve-add\">\n      <van-field\n        type=\"textarea\"\n        v-model=\"addContent\"\n        @blur=\"cancelInput\"\n        placeholder=\"补充说明\"\n        maxlength=\"500\"\n      />\n    </div>\n    <div class=\"serve-file\">\n      <van-uploader\n        :max-size=\"5 * 1024 * 1024\"\n        accept=\"image/gif,image/jpeg,image/png,image/jpg\"\n        @oversize=\"onOversize\"\n        :beforeRead=\"beforeRead\"\n        :after-read=\"afterRead\"\n        v-model=\"fileList\"\n      >\n        <span class=\"serve-file-add\">\n          <van-icon class=\"plus\" name=\"plus\" />\n        </span>\n      </van-uploader>\n    </div>\n    <div class=\"apply-btn-wrapper\">\n      <div class=\"apply-btn\" @click=\"applyServe\">\n        下单\n      </div>\n    </div>\n  </div>\n</template>\n<script>\nimport { handleServe, getServeDetail } from './../../api/serve.js';\nimport { getPlateList } from './../../api/user.js';\nimport axios from 'axios';\nimport config from './../../config';\nexport default {\n  name: 'fill',\n  data() {\n    return {\n      showTips: true,\n      serveName: '',\n      addContent: '',\n      canApply: true,\n      serveDetail: {},\n      fileList: [],\n      //测试上传文件地址\n      //uploadUrl: 'http://172.17.15.42:7501/oss/material/serve/uploadMaterial'\n      uploadUrl: config.UPLOAD_FILE_URL,\n      config: config,\n      plateId: '',\n      plateList: [],\n      showPicker: false,\n      columns: [],\n      plateName: ''\n    };\n  },\n  created() {\n    this.serveId = this.$route.query.serveId || '';\n    if (this.serveId) {\n      this.getServeDetail(this.serveId);\n    } else {\n      this.getPlateList();\n    }\n  },\n  methods: {\n    closeTips() {\n      this.showTips = false;\n    },\n    cancelInput() {\n      document.querySelector('body').scrollIntoView(true);\n    },\n    getPlateList() {\n      getPlateList().then(res => {\n        this.plateList = res.data || [];\n        this.columns = this.plateList.map(item => {\n          return `${item.cybkName}-${item.company}`;\n        });\n        if (this.plateList.length === 1) {\n          this.plateId = this.plateList[0].id;\n          this.plateName = this.columns[0];\n        } else {\n          if (this.plateId) {\n            const index = this.plateList.findIndex(\n              item => item.id == this.plateId\n            );\n            this.plateName = this.columns[index];\n          }\n        }\n      });\n    },\n    getServeDetail(id) {\n      getServeDetail(id).then(res => {\n        this.serveDetail = (res && res.data) || {};\n        this.fileList = this.serveDetail.attachments || [];\n        this.serveName = this.serveDetail.serveName || '';\n        this.addContent = this.serveDetail.serveDesc || '';\n        this.plateId = this.serveDetail.cybkNo || '';\n        for (let i = 0; i < this.fileList.length; i++) {\n          this.fileList[i].name = this.fileList[i].fileName;\n          if (this.getItemTypeImage(this.fileList[i].name)) {\n            this.fileList[i].isImage = true;\n          }\n        }\n        this.getPlateList();\n      });\n    },\n    applyServe() {\n      const { serveName, addContent } = this;\n      if (!serveName) {\n        this.$toast('请填写服务标题');\n        return;\n      } else if (serveName.length < 6 || serveName.length > 20) {\n        this.$toast('服务标题请输入 6-20 字');\n        return;\n      }\n      if (addContent && (addContent.length < 6 || addContent.length > 500)) {\n        this.$toast('服务补充请输入 6-500 字');\n        return;\n      }\n      let files = [];\n\n      for (let i = 0; i < this.fileList.length; i++) {\n        files.push({\n          fileName: this.fileList[i].name || '',\n          url: this.fileList[i].url || this.fileList[i].response.data[0].url\n        });\n      }\n      if (!this.canApply) {\n        return;\n      }\n      let params = {\n        id: this.serveId,\n        processType: 0,\n        serveName: serveName.trim(),\n        serveDesc: addContent.trim(),\n        attachments: files,\n        cybkNo: this.plateId\n      };\n      this.canApply = false;\n      handleServe(params)\n        .then(res => {\n          this.$router.push({\n            path: '/fill'\n          });\n          this.canApply = true;\n          this.$toast('提交成功');\n          return;\n        })\n        .catch(e => {\n          this.canApply = true;\n        });\n    },\n    onConfirm(value, index) {\n      this.showPicker = false;\n      this.plateId = this.plateList[index].id;\n      this.plateName = value;\n    },\n    onOversize() {\n      this.$toast('文件大小不能超过 5 M');\n    },\n    beforeRead(file) {\n      const fileType = ['image/gif', 'image/jpeg', 'image/png', 'image/jpg'];\n      if (!fileType.includes(file.type)) {\n        this.$toast('仅支持 jpg, png, jpeg, gif 格式图片！');\n        return false;\n      }\n      if (file.size / 1024 / 1024 > 5) {\n        this.$toast('文件大小不能超过 5 M');\n        return false;\n      }\n      if (this.fileList.length >= 5) {\n        this.$toast('最多上传 5 张图片！');\n        return false;\n      }\n      return true;\n    },\n    afterRead(file) {\n      file.status = 'uploading';\n      file.message = '上传中';\n      let formData = new FormData();\n      formData.append('appid', config.appid);\n      formData.append('appsecret', config.appsecret);\n      formData.append('file', this.dataURLtoBlob(file.content));\n      axios({\n        method: 'POST',\n        headers: {\n          'Content-Type': 'multipart/form-data'\n        },\n        data: formData,\n        //测试环境\n        // url: 'http://172.17.15.42:7501/oss/material/serve/uploadMaterial'\n        url: this.uploadUrl\n      }).then(res => {\n        if (res.data.code == 8200) {\n          this.fileList[this.fileList.length - 1].status = 'success';\n          this.fileList[this.fileList.length - 1].url = res.data.data[0].url;\n          this.fileList[this.fileList.length - 1].name =\n            (file.file && file.file.name) || '';\n        } else {\n          this.fileList[this.fileList.length - 1].status = 'failed';\n          this.fileList[this.fileList.length - 1].message = '上传失败';\n        }\n      });\n    },\n    getItemTypeImage(item) {\n      const name = item.fileName || item.name;\n      const imageList = ['jpg', 'png', 'gif', 'jpeg'];\n      const type = this.getFileType(name);\n      console.log('type', type);\n      return imageList.includes(type.toLowerCase());\n    },\n    getFileType(name) {\n      if (!name) return 'png';\n      return name.slice(name.lastIndexOf('.') + 1);\n    },\n    onCancel() {\n      this.showPicker = false;\n    },\n\n    dataURLtoBlob(dataurl) {\n      var arr = dataurl.split(','),\n        mime = arr[0].match(/:(.*?);/)[1],\n        bstr = atob(arr[1]),\n        n = bstr.length,\n        u8arr = new Uint8Array(n);\n      while (n--) {\n        u8arr[n] = bstr.charCodeAt(n);\n      }\n      return new Blob([u8arr], {\n        type: mime\n      });\n    }\n  }\n};\n</script>\n<style lang=\"less\" scoped>\n.tips {\n  position: relative;\n  background: #fefcec;\n  box-sizing: border-box;\n  padding: 0.2rem 0.62rem;\n  color: #f86e21;\n  line-height: 0.32rem;\n  font-size: 0.28rem;\n}\n.tips-item {\n  padding-left: 0.36rem;\n  position: relative;\n}\n.tips-item-number {\n  position: absolute;\n  left: 0;\n}\n.warning {\n  width: 0.32rem;\n  height: 0.32rem;\n  border-radius: 50%;\n  background: #f86e21;\n  text-align: center;\n  position: absolute;\n  left: 0.2rem;\n}\n.warning::before {\n  content: '!';\n  font-size: 0.18rem;\n  color: #fff;\n}\n.close-tips {\n  position: absolute;\n  top: 0.2rem;\n  right: 0.2rem;\n}\n.serve-company {\n  margin-top: 0.2rem;\n}\n.serve-name {\n  height: 44px;\n  background: #fff;\n  margin-top: 0.2rem;\n  /deep/.van-field__control {\n    font-size: 0.28rem;\n    line-height: 24px;\n  }\n}\n.serve-add {\n  margin-top: 0.2rem;\n  // padding: 0.1rem 0;\n  /deep/.van-field__control {\n    height: 3.26rem;\n    background: #f6f6f6;\n    border-radius: 4px;\n    padding: 0.2rem;\n    font-size: 0.28rem;\n    line-height: 0.32rem;\n  }\n}\n.serve-file {\n  padding: 0.3rem;\n  background: #fff;\n  margin-top: 0.2rem;\n}\n.serve-file-add {\n  display: inline-block;\n  width: 1.58rem;\n  height: 1.58rem;\n  line-height: 1.58rem;\n  border: 1px solid #dddddd;\n  border-radius: 6px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n.plus {\n  font-size: 0.64rem;\n  color: #ccc;\n}\n.apply-btn-wrapper {\n  padding: 0.3rem;\n}\n.apply-btn {\n  height: 0.94rem;\n  line-height: 0.94rem;\n  text-align: center;\n  color: #fff;\n  border-radius: 0.1rem;\n  background: #ff9800;\n}\n.placeholder {\n  color: #c9cacd;\n}\n/deep/.van-field__control {\n  color: rgba(0, 0, 0, 0.64);\n}\n/deep/.close-tips {\n  color: rgba(0, 0, 0, 0.64);\n}\n/deep/.van-cell__value--alone {\n  color: rgba(0, 0, 0, 0.64);\n}\n</style>\n"]}]}