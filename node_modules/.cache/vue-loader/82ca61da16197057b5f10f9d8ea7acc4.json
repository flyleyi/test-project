{"remainingRequest":"/Users/fuyueyi/Desktop/yjy-projects/multi-project/mutilwap/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/fuyueyi/Desktop/yjy-projects/multi-project/mutilwap/src/pages/bonus-tool-admin/views/newTask/index.vue?vue&type=style&index=0&id=1be9a056&lang=less&scoped=true&","dependencies":[{"path":"/Users/fuyueyi/Desktop/yjy-projects/multi-project/mutilwap/src/pages/bonus-tool-admin/views/newTask/index.vue","mtime":1627979214256},{"path":"/Users/fuyueyi/Desktop/yjy-projects/multi-project/mutilwap/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/yjy-projects/multi-project/mutilwap/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/yjy-projects/multi-project/mutilwap/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/yjy-projects/multi-project/mutilwap/node_modules/less-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/yjy-projects/multi-project/mutilwap/node_modules/style-resources-loader/lib/index.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/yjy-projects/multi-project/mutilwap/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/yjy-projects/multi-project/mutilwap/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKLy8g5Y675o6JaW5wdXTovrnmoYbnur8KL2RlZXAvLmVsLWlucHV0X19pbm5lciB7CiAgYm9yZGVyOiAwOwp9Ci8vIOWOu+aOiWZvcm0taXRlbeeahOS4i+i+uei3nQovZGVlcC8gLmVsLWZvcm0taXRlbS0tbWluaS5lbC1mb3JtLWl0ZW0gewogIG1hcmdpbi1ib3R0b206IDA7Cn0KLm15LWJ0biB7CiAgd2lkdGg6IDExOHB4Owp9Cg=="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/pages/bonus-tool-admin/views/newTask","sourcesContent":["<template>\n  <!-- 新建任务 -->\n  <div>\n    <div class=\"app-container\">\n      <div class=\"common-title\">{{ taskName }}</div>\n      <div class=\"common-container\">\n        <!-- 头部 -->\n        <div class=\"common-header\">\n          <div class=\"common-header-left\">\n            <el-button\n              type=\"primary\"\n              size=\"medium\"\n              @click=\"onChooseRole\"\n              class=\"common-btn my-btn\"\n            >\n              参与角色选择\n            </el-button>\n            <el-button\n              type=\"primary\"\n              size=\"medium\"\n              @click=\"onRelease\"\n              :disabled=\"isReleased\"\n            >\n              发布\n            </el-button>\n          </div>\n          <div class=\"common-header-right\"></div>\n        </div>\n        <div>\n          <el-form\n            v-loading=\"dataLoading\"\n            ref=\"elForm\"\n            :model=\"formData\"\n            size=\"mini\"\n          >\n            <c-table :headers=\"headers\" :data=\"formData.tableData\" border>\n              <template slot=\"column|bonus\" slot-scope=\"{ row, $index }\">\n                <el-form-item\n                  :prop=\"`tableData.${$index}.bonus`\"\n                  :key=\"`tableData.${$index}.bonus`\"\n                >\n                  <el-input\n                    v-model=\"row.bonus\"\n                    maxlength=\"8\"\n                    placeholder=\"手动输入\"\n                    :disabled=\"isReleased\"\n                    @blur=\"blurInput($event, row, $index)\"\n                    @focus=\"foucusInput($event, row, $index)\"\n                  ></el-input>\n                </el-form-item>\n              </template>\n            </c-table>\n          </el-form>\n        </div>\n      </div>\n      <choose-role\n        ref=\"chooseRole\"\n        :task-name=\"taskName\"\n        @checkedSchool=\"getCheckedSchool\"\n      ></choose-role>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { Form, FormItem, Input } from 'element-ui';\nimport CTable from '@/components/common/CTable';\nimport ChooseRole from './components/ChooseRole.vue';\nimport { releaseTask } from '../../api/task/index';\nexport default {\n  name: 'NewTask',\n  components: {\n    [Form.name]: Form,\n    [FormItem.name]: FormItem,\n    [Input.name]: Input,\n    ChooseRole,\n    CTable\n  },\n  props: {},\n  data() {\n    return {\n      dataLoading: false, // 数据提交时loading\n      formData: {}, // 提交数据\n      isReleased: false, // 默认还未发布\n      headers: [\n        {\n          label: '序号',\n          type: 'index',\n          width: 80\n        },\n        {\n          label: '校方名称',\n          prop: 'schoolName'\n        },\n        {\n          label: '关联账号',\n          prop: 'associatedAccount'\n        },\n        {\n          label: '奖金池额度',\n          prop: 'bonus',\n          colType: 'column',\n          slotName: 'bonus'\n        }\n      ]\n    };\n  },\n  computed: {\n    taskName() {\n      return this.$route.query.taskName;\n    }\n  },\n  watch: {},\n  created() {},\n  mounted() {},\n  methods: {\n    /**\n     * 角色选择\n     */\n    onChooseRole() {\n      if (!this.isReleased) {\n        this.$refs.chooseRole.show();\n      } else {\n        this.$alert('已发布，不可重复操作！', '提醒', {\n          cancelButtonText: '确定',\n          center: true,\n          showClose: false\n        });\n      }\n    },\n    /**\n     * 获取学校\n     */\n    getCheckedSchool(val) {\n      this.$set(this.formData, 'tableData', val);\n    },\n    /**\n     * 发布\n     */\n    onRelease() {\n      if (this.formData.tableData && this.formData.tableData.length > 0) {\n        let reg = /^(0|[1-9][0-9]{0,8})$/;\n        let data = [];\n        let bool = this.formData.tableData.every(item => {\n          if (\n            item.bonus === null ||\n            (typeof item.bonus === 'string' && item.bonus.length === 0)\n          ) {\n            this.$alert('奖金池额度不可为空！', '提醒', {\n              cancelButtonText: '确定',\n              center: true,\n              showClose: false\n            });\n            return false;\n          }\n          let bonus = Number(this.delcommafy(item.bonus));\n          if (!reg.test(bonus)) {\n            this.$alert('奖金池额度需在0-99,999,999之间！', '提醒', {\n              cancelButtonText: '确定',\n              center: true,\n              showClose: false\n            });\n            return false;\n          }\n          data.push({\n            ...item,\n            bonus: bonus\n          });\n          return true;\n        });\n        bool &&\n          this.$confirm(\n            '确定发布该任务至各单位？<br>发布后奖金池额度将无法修改',\n            '提醒',\n            {\n              confirmButtonText: '确认',\n              cancelButtonText: '取消',\n              center: true,\n              showClose: false,\n              dangerouslyUseHTMLString: true\n            }\n          ).then(() => {\n            this.dataLoading = true;\n            releaseTask(data).then(() => {\n              this.$message({\n                type: 'success',\n                message: '发布成功!'\n              });\n              this.dataLoading = false;\n              this.isReleased = true;\n            });\n          });\n      } else {\n        this.$alert('请先选择参与角色！', '提醒', {\n          cancelButtonText: '确定',\n          center: true,\n          showClose: false\n        });\n      }\n    },\n    /**\n     * 金额添加千分位\n     */\n    comdify(n) {\n      if (!n) return n;\n      let str = n.split('.');\n      let re = /\\d{1,3}(?=(\\d{3})+$)/g;\n      let n1 = str[0].replace(re, '$&,');\n      return str.length > 1 && str[1] ? `${n1}.${str[1]}` : `${n1}`;\n    },\n    /**\n     * 金额删除千分位\n     */\n    delcommafy(num) {\n      if (!num) return num;\n      num = num.toString();\n      num = num.replace(/,/gi, '');\n      return num;\n    },\n    /**\n     * 失焦input\n     */\n    blurInput(el, row, index) {\n      let inputVal = el.target.value || '';\n      this.formData.tableData[index].bonus = this.comdify(\n        this.delcommafy(inputVal)\n      );\n    },\n    /**\n     * 聚焦input\n     */\n    foucusInput(el, row, index) {\n      let inputVal = el.target.value || '';\n      this.formData.tableData[index].bonus = this.delcommafy(inputVal);\n    }\n  }\n};\n</script>\n\n<style lang=\"less\" scoped>\n// 去掉input边框线\n/deep/.el-input__inner {\n  border: 0;\n}\n// 去掉form-item的下边距\n/deep/ .el-form-item--mini.el-form-item {\n  margin-bottom: 0;\n}\n.my-btn {\n  width: 118px;\n}\n</style>\n"]}]}