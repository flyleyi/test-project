{"remainingRequest":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/fuyueyi/Desktop/practice/mutilwap/src/pages/logistics-data/views/UserManage/user-permission.vue?vue&type=style&index=0&id=1b5cb7ac&lang=less&scoped=true&","dependencies":[{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/src/pages/logistics-data/views/UserManage/user-permission.vue","mtime":1627979214320},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/less-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/style-resources-loader/lib/index.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoNCi5mLWwgew0KICBmbG9hdDogbGVmdDsNCn0NCi5mLWM6YWZ0ZXIgew0KICB2aXNpYmlsaXR5OiBoaWRkZW47DQogIGRpc3BsYXk6IGJsb2NrOw0KICBmb250LXNpemU6IDA7DQogIGNvbnRlbnQ6ICcgJzsNCiAgY2xlYXI6IGJvdGg7DQogIGhlaWdodDogMDsNCn0NCi51c2VyUGVybWlzc2lvbiB7DQogIGJhY2tncm91bmQ6ICNmZmY7DQogIGJvcmRlci1yYWRpdXM6IDJweDsNCiAgcGFkZGluZzogMzhweCAzMnB4Ow0KDQogIGZvbnQtZmFtaWx5OiAnUGluZ0ZhbmdTQy1NZWRpdW0nLCAnUGluZ0ZhbmcgU0MnOw0KICAmLW1haW4gew0KICAgIHBhZGRpbmctdG9wOiAxM3B4Ow0KICAgICYtaW5mbyB7DQogICAgICBmb250LXNpemU6IDE1cHg7DQogICAgICBmb250LXdlaWdodDogNTAwOw0KICAgICAgY29sb3I6IHJnYmEoMCwgMCwgMCwgMC44NSk7DQogICAgICBsaW5lLWhlaWdodDogMzNweDsNCiAgICAgIGRpdiB7DQogICAgICAgIG1hcmdpbi1yaWdodDogNDJweDsNCiAgICAgIH0NCiAgICB9DQogIH0NCiAgJi1idG5zIHsNCiAgICBtYXJnaW46IDE3cHggMCAzMnB4Ow0KICAgIGJ1dHRvbiB7DQogICAgICB3aWR0aDogODhweDsNCiAgICAgIG1hcmdpbi1yaWdodDogMzBweDsNCiAgICB9DQogIH0NCiAgJi1jaGVja2JveCB7DQogICAgbWFyZ2luLWxlZnQ6IDE4cHg7DQogICAgJi1hbGwgew0KICAgICAgbWFyZ2luOiAwIDAgNnB4IDZweDsNCiAgICB9DQogICAgL2RlZXAvLmVsLWNoZWNrYm94X19sYWJlbCB7DQogICAgICBmb250LXNpemU6IDEycHg7DQogICAgICBjb2xvcjogIzMwMzEzMzsNCiAgICB9DQogICAgL2RlZXAvLmVsLXRyZWUtbm9kZV9fbGFiZWwgew0KICAgICAgZm9udC1zaXplOiAxMnB4Ow0KICAgICAgY29sb3I6ICMzMDMxMzM7DQogICAgfQ0KICAgIC9kZWVwLyAuZWwtdHJlZS1ub2RlOmZvY3VzID4gLmVsLXRyZWUtbm9kZV9fY29udGVudCB7DQogICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmZmOw0KICAgIH0NCiAgICAvZGVlcC8gLmVsLXRyZWUtbm9kZV9fY29udGVudDpob3ZlciB7DQogICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmZmOw0KICAgIH0NCiAgfQ0KfQ0K"},{"version":3,"sources":["user-permission.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"user-permission.vue","sourceRoot":"src/pages/logistics-data/views/UserManage","sourcesContent":["<template>\r\n  <!-- 分配数据配置页面 -->\r\n  <div class=\"userPermission\">\r\n    <div class=\"userPermission-main \">\r\n      <div class=\"f-c userPermission-main-info\">\r\n        <div class=\"f-l\">姓名：{{ formData.staffInfo.staffName }}</div>\r\n        <div class=\"f-l\">工号：{{ formData.staffInfo.staffCode }}</div>\r\n      </div>\r\n    </div>\r\n    <div class=\"userPermission-btns\">\r\n      <el-button size=\"medium\" icon=\"el-icon-d-arrow-left\" @click=\"goBack\"\r\n        >返回</el-button\r\n      >\r\n      <el-button\r\n        size=\"medium\"\r\n        type=\"primary\"\r\n        @click=\"savePermission\"\r\n        v-loading=\"confirmLoading\"\r\n        >确认</el-button\r\n      >\r\n    </div>\r\n    <div class=\"userPermission-checkbox\">\r\n      <el-checkbox\r\n        v-model=\"checkAll\"\r\n        class=\"userPermission-checkbox-all\"\r\n        @change=\"handleCheckAllChange\"\r\n        >全选</el-checkbox\r\n      >\r\n      <el-tree\r\n        :data=\"formData.tree\"\r\n        @check=\"change\"\r\n        :props=\"defaultProps\"\r\n        :default-checked-keys=\"selectIds\"\r\n        node-key=\"id\"\r\n        ref=\"tree\"\r\n        class=\"userPermission-checkbox-tree\"\r\n        show-checkbox\r\n      ></el-tree>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport axios from '@/plugins/axios';\r\nimport { Button, Checkbox, Tree } from 'element-ui';\r\n\r\nexport default {\r\n  name: 'userPermission',\r\n  // 注册组件\r\n  components: {\r\n    [Button.name]: Button,\r\n    [Checkbox.name]: Checkbox,\r\n    [Tree.name]: Tree\r\n  },\r\n  props: {\r\n    /**\r\n     * 服务器类型\r\n     */\r\n    serverType: {\r\n      type: String,\r\n      default: ''\r\n    }\r\n  },\r\n  // 定义数据\r\n  data() {\r\n    return {\r\n      confirmLoading: false, //加载状态\r\n      checkAll: false, //是否全选\r\n      formData: {\r\n        //详情信息\r\n        staffInfo: {\r\n          //用户信息\r\n          staffName: '',\r\n          staffCode: ''\r\n        },\r\n        tree: [] //树形数据\r\n      },\r\n      defaultProps: {\r\n        //更改tree键值名\r\n        children: 'children',\r\n        label: 'name'\r\n      },\r\n      savaData: {\r\n        //保存数据\r\n        staffCode: this.$route.query.staffCode,\r\n        authList: []\r\n      },\r\n      selectIds: [] //回显id数组\r\n    };\r\n  },\r\n  // 计算属性\r\n  computed: {},\r\n  // 侦听器\r\n  watch: {\r\n    '$route.query'(now, old) {\r\n      if (!now.staffCode || !this.selectIds) {\r\n        return;\r\n      }\r\n      this.checkAll = false;\r\n      this.getData();\r\n    }\r\n  },\r\n  // 创建完成钩子\r\n  created() {\r\n    this.getData();\r\n  },\r\n  // 挂在完成钩子\r\n  mounted() {},\r\n  // 方法定义\r\n  methods: {\r\n    getData() {\r\n      axios(\r\n        {\r\n          url: '/department/tree4School'\r\n        },\r\n        this.serverType\r\n      )\r\n        .then(res => {\r\n          this.formData.tree = res.data;\r\n          //this.selectIds = this.findPathByLeafId(this.formData.orgTreeInfo)\r\n          return axios(\r\n            {\r\n              url: `/userManage/selectUserAuth/${this.$route.query.staffCode}`\r\n            },\r\n            this.serverType\r\n          );\r\n        })\r\n        .then(res => {\r\n          this.formData.staffInfo = res.data.staffInfo || {};\r\n          this.selectIds = res.data.staffAuthSet || [];\r\n          this.$refs.tree.setCheckedKeys(this.selectIds);\r\n        });\r\n    },\r\n    savePermission() {\r\n      //保存权限\r\n      this.confirmLoading = true;\r\n      let savaData = {\r\n        ...this.savaData,\r\n        ...this.formData.staffInfo\r\n      };\r\n      axios\r\n        .post('/userManage/editUserAuth', savaData, {}, this.serverType)\r\n        .then(({ data }) => {\r\n          this.confirmLoading = false;\r\n          this.$message({\r\n            type: 'success',\r\n            message: '配置成功'\r\n          });\r\n          this.goBack();\r\n        })\r\n        .catch(() => {\r\n          this.confirmLoading = false;\r\n        });\r\n    },\r\n    goBack() {\r\n      //返回用户管理列表页\r\n      this.$router.push({\r\n        name: 'BUserManage'\r\n      });\r\n    },\r\n    change() {\r\n      //节点变化时\r\n      this.savaData.authList = this.$refs.tree.getCheckedKeys(); //.join(',')\r\n    },\r\n    handleCheckAllChange(val) {\r\n      //全选或者取消全选\r\n      if (this.checkAll) {\r\n        this.$refs.tree.setCheckedNodes(this.formData.tree);\r\n      } else {\r\n        this.$refs.tree.setCheckedKeys([]);\r\n      }\r\n      this.savaData.authList = this.$refs.tree.getCheckedKeys(); //.join(',')\r\n    },\r\n    findPathByLeafId(nodes) {\r\n      //选中节点回显筛选id nodes所有节点 返回id数组\r\n      var idArr = [];\r\n      nodes.forEach((item, i, arr) => {\r\n        item.childlist.forEach((item2, j, arr2) => {\r\n          item2.childlist.forEach((item3, k, arr3) => {\r\n            if (item3.checked == '1') {\r\n              idArr.push(item3.id);\r\n            }\r\n          });\r\n        });\r\n      });\r\n      return idArr;\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.f-l {\r\n  float: left;\r\n}\r\n.f-c:after {\r\n  visibility: hidden;\r\n  display: block;\r\n  font-size: 0;\r\n  content: ' ';\r\n  clear: both;\r\n  height: 0;\r\n}\r\n.userPermission {\r\n  background: #fff;\r\n  border-radius: 2px;\r\n  padding: 38px 32px;\r\n\r\n  font-family: 'PingFangSC-Medium', 'PingFang SC';\r\n  &-main {\r\n    padding-top: 13px;\r\n    &-info {\r\n      font-size: 15px;\r\n      font-weight: 500;\r\n      color: rgba(0, 0, 0, 0.85);\r\n      line-height: 33px;\r\n      div {\r\n        margin-right: 42px;\r\n      }\r\n    }\r\n  }\r\n  &-btns {\r\n    margin: 17px 0 32px;\r\n    button {\r\n      width: 88px;\r\n      margin-right: 30px;\r\n    }\r\n  }\r\n  &-checkbox {\r\n    margin-left: 18px;\r\n    &-all {\r\n      margin: 0 0 6px 6px;\r\n    }\r\n    /deep/.el-checkbox__label {\r\n      font-size: 12px;\r\n      color: #303133;\r\n    }\r\n    /deep/.el-tree-node__label {\r\n      font-size: 12px;\r\n      color: #303133;\r\n    }\r\n    /deep/ .el-tree-node:focus > .el-tree-node__content {\r\n      background-color: #fff;\r\n    }\r\n    /deep/ .el-tree-node__content:hover {\r\n      background-color: #fff;\r\n    }\r\n  }\r\n}\r\n</style>\r\n"]}]}