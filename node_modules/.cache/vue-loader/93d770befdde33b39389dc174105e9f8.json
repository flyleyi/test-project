{"remainingRequest":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/fuyueyi/Desktop/practice/mutilwap/src/pages/catering-h5/views/DingLogin.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/src/pages/catering-h5/views/DingLogin.vue","mtime":1645176309702},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/fuyueyi/Desktop/practice/mutilwap/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IERpYWxvZywgVG9hc3QgfSBmcm9tICd2YW50JzsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICdkaW5nLWxvZ2luJywKICBwcm9wczogewogICAgLyoqCiAgICAgKiDnmbvlvZXmiJDlip/ph43lrprlkJHlnLDlnYAKICAgICAqLwogICAgcmVkaXJlY3Q6IHsKICAgICAgdHlwZTogU3RyaW5nLAogICAgICBkZWZhdWx0OiAnJwogICAgfQogIH0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIHJvbGVUeXBlOiAnJywKICAgICAgZGV0YWlsSWQ6IG51bGwKICAgIH07CiAgfSwKICBjcmVhdGVkKCkgewogICAgdGhpcy5pbml0KCk7CiAgICBjb25zdCB7IHJvbGVUeXBlLCBpZCB9ID0gdGhpcy4kcm91dGUucXVlcnk7CiAgICB0aGlzLnJvbGVUeXBlID0gcm9sZVR5cGU7CiAgICB0aGlzLmRldGFpbElkID0gaWQ7CiAgfSwKICBtZXRob2RzOiB7CiAgICBpbml0KCkgewogICAgICAvLyDmo4DmtYvnjq/looMKICAgICAgaWYgKCF0aGlzLiRkZC52ZXJzaW9uKSB7CiAgICAgICAgRGlhbG9nLmFsZXJ0KHsKICAgICAgICAgIHRpdGxlOiAn5o+Q56S6JywKICAgICAgICAgIG1lc3NhZ2U6ICfor7fkvb/nlKjpkonpkonmiZPlvIAnCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIC8vIOaYvuekuueZu+W9leS4rQogICAgICBjb25zdCBsb2FkaW5nID0gdGhpcy4kdG9hc3QubG9hZGluZyh7CiAgICAgICAgbWVzc2FnZTogJ+WKoOi9veS4rS4uLicsCiAgICAgICAgZm9yYmlkQ2xpY2s6IHRydWUsCiAgICAgICAgbG9hZGluZ1R5cGU6ICdzcGlubmVyJwogICAgICB9KTsKICAgICAgdGhpcy4kc3RvcmUKICAgICAgICAuZGlzcGF0Y2goJ3VzZXIvRERMb2dpbicpCiAgICAgICAgLnRoZW4oKCkgPT4gewogICAgICAgICAgLy/kuI3lkIzmnYPpmZDot7PovazkuI3lkIzpobXpnaLvvIzlpJrph43ouqvku73liJ3lp4vljJblhYjpgInmi6nouqvku70KICAgICAgICAgIGNvbnN0IHJvbGVUeXBlID0gdGhpcy4kc3RvcmUuZ2V0dGVyc1sndXNlci9yb2xlVHlwZUluaXQnXSB8fCB7fTsKICAgICAgICAgIGNvbnN0IHJvbGVEZXRhaWxQYXRoID0KICAgICAgICAgICAgdGhpcy4kc3RvcmUuZ2V0dGVyc1sndXNlci9yb2xlRGV0YWlsUGF0aCddIHx8IHt9OwogICAgICAgICAgaWYgKAogICAgICAgICAgICAhcm9sZVR5cGUubGVuZ3RoIHx8CiAgICAgICAgICAgICh0aGlzLnJvbGVUeXBlICYmICFyb2xlVHlwZS5pbmNsdWRlcyhOdW1iZXIodGhpcy5yb2xlVHlwZSkpKQogICAgICAgICAgKSB7CiAgICAgICAgICAgIERpYWxvZy5hbGVydCh7CiAgICAgICAgICAgICAgbWVzc2FnZTogJ+aaguaXoOadg+mZkCcKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChyb2xlVHlwZS5sZW5ndGggPiAxICYmICF0aGlzLnJlZGlyZWN0KSB7CiAgICAgICAgICAgIHRoaXMuJHJvdXRlci5yZXBsYWNlKHsKICAgICAgICAgICAgICBwYXRoOiAnL2Nob29zZS1pZGVudGl0eScKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7CiAgICAgICAgICAgICAgcGF0aDogdGhpcy4kc3RvcmUuZ2V0dGVyc1sndXNlci9yb2xlUGF0aCddW3JvbGVUeXBlWzBdXQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIC8v6ZKJ6ZKJ5raI5oGv6Lez6L2sCiAgICAgICAgICBpZiAodGhpcy5yZWRpcmVjdCkgewogICAgICAgICAgICB0aGlzLiRkZC5iaXoubmF2aWdhdGlvbi5zZXRSaWdodCh7CiAgICAgICAgICAgICAgc2hvdzogZmFsc2UsIC8v5o6n5Yi25oyJ6ZKu5pi+56S677yMIHRydWUg5pi+56S677yMIGZhbHNlIOmakOiXj++8jCDpu5jorqR0cnVlCiAgICAgICAgICAgICAgY29udHJvbDogdHJ1ZSwgLy/mmK/lkKbmjqfliLbngrnlh7vkuovku7bvvIx0cnVlIOaOp+WItu+8jGZhbHNlIOS4jeaOp+WItu+8jCDpu5jorqRmYWxzZQogICAgICAgICAgICAgIHRleHQ6ICfliIfmjaLop5LoibInLCAvL+aOp+WItuaYvuekuuaWh+acrO+8jOepuuWtl+espuS4suihqOekuuaYvuekuum7mOiupOaWh+acrAogICAgICAgICAgICAgIG9uU3VjY2VzczogcmVzdWx0ID0+IHsKICAgICAgICAgICAgICAgIC8v5aaC5p6cY29udHJvbOS4unRydWXvvIzliJlvblN1Y2Nlc3PlsIblnKjlj5HnlJ/mjInpkq7ngrnlh7vkuovku7booqvlm57osIMKICAgICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgICB7fQogICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHsKICAgICAgICAgICAgICAgICAgcGF0aDogJy9jaG9vc2UtaWRlbnRpdHknCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIG9uRmFpbDogZnVuY3Rpb24oZXJyKSB7fQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgbGV0IHF1ZXJ5ID0geyBvcmRlcklkOiB0aGlzLmRldGFpbElkIH07CiAgICAgICAgICAgIGlmICh0aGlzLnJvbGVUeXBlID09ICc4JykgewogICAgICAgICAgICAgIHF1ZXJ5ID0gewogICAgICAgICAgICAgICAgb3JkZXJJZDogdGhpcy5kZXRhaWxJZAogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5yb2xlVHlwZSA9PSAnOScpIHsKICAgICAgICAgICAgICBxdWVyeSA9IHsKICAgICAgICAgICAgICAgIGFwcGx5SWQ6IHRoaXMuZGV0YWlsSWQKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuJHJvdXRlci5yZXBsYWNlKHsKICAgICAgICAgICAgICBwYXRoOiByb2xlRGV0YWlsUGF0aFt0aGlzLnJvbGVUeXBlXSwKICAgICAgICAgICAgICBxdWVyeQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgICB0aGlzLiRkaWFsb2cKICAgICAgICAgICAgLmFsZXJ0KHsKICAgICAgICAgICAgICB0aXRsZTogJ+aOiOadg+eZu+W9leWksei0pScsCiAgICAgICAgICAgICAgbWVzc2FnZTogZXJyb3IuZXJyb3JNZXNzYWdlIHx8IGVycm9yLm1lc3NhZ2UsCiAgICAgICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICfph43mlrDmjojmnYMnCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC50aGVuKCgpID0+IHsKICAgICAgICAgICAgICB0aGlzLmluaXQoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSkKICAgICAgICAuZmluYWxseSgoKSA9PiB7CiAgICAgICAgICBsb2FkaW5nLmNsZWFyKCk7CiAgICAgICAgfSk7CiAgICB9CiAgfQp9Owo="},{"version":3,"sources":["DingLogin.vue"],"names":[],"mappings":";;;;;;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"DingLogin.vue","sourceRoot":"src/pages/catering-h5/views","sourcesContent":["<template>\n  <!-- 钉钉免登 -->\n  <div></div>\n</template>\n\n<script>\nimport { Dialog, Toast } from 'vant';\nexport default {\n  name: 'ding-login',\n  props: {\n    /**\n     * 登录成功重定向地址\n     */\n    redirect: {\n      type: String,\n      default: ''\n    }\n  },\n  data() {\n    return {\n      roleType: '',\n      detailId: null\n    };\n  },\n  created() {\n    this.init();\n    const { roleType, id } = this.$route.query;\n    this.roleType = roleType;\n    this.detailId = id;\n  },\n  methods: {\n    init() {\n      // 检测环境\n      if (!this.$dd.version) {\n        Dialog.alert({\n          title: '提示',\n          message: '请使用钉钉打开'\n        });\n        return;\n      }\n      // 显示登录中\n      const loading = this.$toast.loading({\n        message: '加载中...',\n        forbidClick: true,\n        loadingType: 'spinner'\n      });\n      this.$store\n        .dispatch('user/DDLogin')\n        .then(() => {\n          //不同权限跳转不同页面，多重身份初始化先选择身份\n          const roleType = this.$store.getters['user/roleTypeInit'] || {};\n          const roleDetailPath =\n            this.$store.getters['user/roleDetailPath'] || {};\n          if (\n            !roleType.length ||\n            (this.roleType && !roleType.includes(Number(this.roleType)))\n          ) {\n            Dialog.alert({\n              message: '暂无权限'\n            });\n            return;\n          }\n          if (roleType.length > 1 && !this.redirect) {\n            this.$router.replace({\n              path: '/choose-identity'\n            });\n          } else {\n            this.$router.push({\n              path: this.$store.getters['user/rolePath'][roleType[0]]\n            });\n          }\n          //钉钉消息跳转\n          if (this.redirect) {\n            this.$dd.biz.navigation.setRight({\n              show: false, //控制按钮显示， true 显示， false 隐藏， 默认true\n              control: true, //是否控制点击事件，true 控制，false 不控制， 默认false\n              text: '切换角色', //控制显示文本，空字符串表示显示默认文本\n              onSuccess: result => {\n                //如果control为true，则onSuccess将在发生按钮点击事件被回调\n                /*\n                {}\n                */\n                this.$router.push({\n                  path: '/choose-identity'\n                });\n              },\n              onFail: function(err) {}\n            });\n            let query = { orderId: this.detailId };\n            if (this.roleType == '8') {\n              query = {\n                orderId: this.detailId\n              };\n            } else if (this.roleType == '9') {\n              query = {\n                applyId: this.detailId\n              };\n            }\n            this.$router.replace({\n              path: roleDetailPath[this.roleType],\n              query\n            });\n          }\n        })\n        .catch(error => {\n          this.$dialog\n            .alert({\n              title: '授权登录失败',\n              message: error.errorMessage || error.message,\n              confirmButtonText: '重新授权'\n            })\n            .then(() => {\n              this.init();\n            });\n        })\n        .finally(() => {\n          loading.clear();\n        });\n    }\n  }\n};\n</script>\n\n<style></style>\n"]}]}